<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Floresta dos Iniciantes - Blaze and Steel</title>
    <link rel="stylesheet" href="../css/game.css">
    <style>
        body {
            background: #0a1a0a url('../assets/maps/floresta-bg.jpg') no-repeat center center fixed;
            background-size: cover;
            color: #fff;
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
        }

        #battle-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .back-button {
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #4a7c59;
            color: #fff;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: rgba(74, 124, 89, 0.5);
            transform: scale(1.05);
        }

        .battle-area {
            display: flex;
            flex: 1;
            justify-content: space-around;
            align-items: center;
            gap: 20px;
        }

        .player, .enemy {
            text-align: center;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #4a7c59;
            border-radius: 10px;
            padding: 20px;
            width: 300px;
        }

        .character-image {
            width: 150px;
            height: 150px;
            margin: 0 auto;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        .health-bar-container {
            width: 100%;
            height: 20px;
            background: #333;
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }

        .health-bar {
            height: 100%;
            background: #4CAF50;
            width: 100%;
            transition: width 0.3s;
        }

        .actions {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .action-button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
        }

        .attack-btn {
            background: #e74c3c;
            color: white;
        }

        .defend-btn {
            background: #3498db;
            color: white;
        }

        .item-btn {
            background: #9b59b6;
            color: white;
        }

        .flee-btn {
            background: #f39c12;
            color: white;
        }

        .battle-log {
            margin-top: 20px;
            height: 150px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #4a7c59;
            border-radius: 5px;
            padding: 10px;
            font-family: monospace;
        }

        .log-entry {
            margin: 5px 0;
            padding: 3px 0;
            border-bottom: 1px solid #333;
        }
    </style>
</head>
<body>
    <div id="battle-container">
        <div class="header">
            <button class="back-button" id="back-button">Voltar ao Mapa</button>
            <h1>Floresta dos Iniciantes</h1>
            <div id="player-level">Nível: 1</div>
        </div>

        <div class="battle-area">
            <div class="player">
                <h2 id="player-name">Jogador</h2>
                <div class="character-image" id="player-image" style="background-image: url('../assets/player.png');"></div>
                <div class="health-bar-container">
                    <div class="health-bar" id="player-health-bar"></div>
                </div>
                <div id="player-health-text">100/100 HP</div>
            </div>

            <div class="vs">VS</div>

            <div class="enemy">
                <h2 id="enemy-name">Lobo</h2>
                <div class="character-image" id="enemy-image" style="background-image: url('../assets/monstros/Lobo.png');"></div>
                <div class="health-bar-container">
                    <div class="health-bar" id="enemy-health-bar"></div>
                </div>
                <div id="enemy-health-text">50/50 HP</div>
            </div>
        </div>

        <div class="actions">
            <button class="action-button attack-btn" id="attack-btn">Atacar</button>
            <button class="action-button defend-btn" id="defend-btn">Defender</button>
            <button class="action-button item-btn" id="item-btn">Itens</button>
            <button class="action-button flee-btn" id="flee-btn">Fugir</button>
        </div>

        <div class="battle-log" id="battle-log">
            <div class="log-entry">Um Lobo selvagem apareceu!</div>
        </div>
    </div>

    <script>
        // Estado do jogo
        const gameState = JSON.parse(localStorage.getItem('gameState')) || {
            player: {
                name: 'Jogador',
                level: 1,
                maxHealth: 100,
                health: 100,
                attack: 10,
                defense: 5,
                experience: 0,
                nextLevelExp: 100,
                inventory: []
            },
            currentEnemy: {
                name: 'Lobo',
                maxHealth: 50,
                health: 50,
                attack: 8,
                defense: 3,
                experience: 25,
                gold: 10
            },
            battleLog: ['Um Lobo selvagem apareceu!']
        };

        // Elementos da interface
        const elements = {
            playerName: document.getElementById('player-name'),
            playerHealthBar: document.getElementById('player-health-bar'),
            playerHealthText: document.getElementById('player-health-text'),
            enemyName: document.getElementById('enemy-name'),
            enemyHealthBar: document.getElementById('enemy-health-bar'),
            enemyHealthText: document.getElementById('enemy-health-text'),
            battleLog: document.getElementById('battle-log'),
            playerLevel: document.getElementById('player-level')
        };

        // Inicialização do jogo
        function init() {
            updateUI();
            setupEventListeners();
        }

        // Atualiza a interface do usuário
        function updateUI() {
            const { player, currentEnemy } = gameState;
            
            // Atualiza informações do jogador
            elements.playerName.textContent = player.name;
            elements.playerHealthBar.style.width = `${(player.health / player.maxHealth) * 100}%`;
            elements.playerHealthText.textContent = `${player.health}/${player.maxHealth} HP`;
            elements.playerLevel.textContent = `Nível: ${player.level}`;
            
            // Atualiza informações do inimigo
            elements.enemyName.textContent = currentEnemy.name;
            elements.enemyHealthBar.style.width = `${(currentEnemy.health / currentEnemy.maxHealth) * 100}%`;
            elements.enemyHealthText.textContent = `${currentEnemy.health}/${currentEnemy.maxHealth} HP`;
            
            // Atualiza o log de batalha
            updateBattleLog();
        }

        // Configura os ouvintes de eventos
        function setupEventListeners() {
            // Botão de voltar
            document.getElementById('back-button').addEventListener('click', () => {
                if (confirm('Deseja mesmo sair da batalha?')) {
                    window.location.href = 'mapa-mundi.html';
                }
            });

            // Ações de batalha
            document.getElementById('attack-btn').addEventListener('click', playerAttack);
            document.getElementById('defend-btn').addEventListener('click', playerDefend);
            document.getElementById('item-btn').addEventListener('click', openInventory);
            document.getElementById('flee-btn').addEventListener('click', tryToFlee);
        }

        // Ataque do jogador
        function playerAttack() {
            const { player, currentEnemy } = gameState;
            const damage = Math.max(1, player.attack - Math.floor(Math.random() * currentEnemy.defense));
            
            currentEnemy.health = Math.max(0, currentEnemy.health - damage);
            addToBattleLog(`Você atacou o ${currentEnemy.name} e causou ${damage} de dano!`);
            
            if (currentEnemy.health <= 0) {
                enemyDefeated();
            } else {
                enemyTurn();
            }
            
            updateUI();
        }

        // Defesa do jogador
        function playerDefend() {
            const defenseBonus = Math.floor(gameState.player.defense * 0.5);
            gameState.player.defense += defenseBonus;
            addToBattleLog(`Você se preparou para se defender! Defesa aumentada em ${defenseBonus}.`);
            
            // A defesa volta ao normal após o turno do inimigo
            setTimeout(() => {
                gameState.player.defense -= defenseBonus;
                addToBattleLog('Sua defesa voltou ao normal.');
                updateUI();
            }, 1000);
            
            enemyTurn();
            updateUI();
        }

        // Turno do inimigo
        function enemyTurn() {
            const { player, currentEnemy } = gameState;
            
            // O inimigo tem 20% de chance de se defender
            if (Math.random() < 0.2) {
                const defenseBonus = Math.floor(currentEnemy.defense * 0.5);
                currentEnemy.defense += defenseBonus;
                addToBattleLog(`O ${currentEnemy.name} se preparou para se defender!`);
                
                // A defesa volta ao normal no próximo turno
                setTimeout(() => {
                    currentEnemy.defense -= defenseBonus;
                    addToBattleLog(`A defesa do ${currentEnemy.name} voltou ao normal.`);
                    updateUI();
                }, 1000);
            } else {
                // Ataque normal
                const damage = Math.max(1, currentEnemy.attack - Math.floor(Math.random() * player.defense));
                player.health = Math.max(0, player.health - damage);
                addToBattleLog(`O ${currentEnemy.name} te atacou e causou ${damage} de dano!`);
                
                if (player.health <= 0) {
                    playerDefeated();
                }
            }
            
            updateUI();
        }

        // Inimigo derrotado
        function enemyDefeated() {
            const { player, currentEnemy } = gameState;
            
            // Experiência e ouro
            const expGain = currentEnemy.experience;
            const goldGain = currentEnemy.gold;
            
            player.experience += expGain;
            player.gold = (player.gold || 0) + goldGain;
            
            addToBattleLog(`Você derrotou o ${currentEnemy.name}!`);
            addToBattleLog(`Ganhou ${expGain} de experiência e ${goldGain} de ouro.`);
            
            // Verifica se subiu de nível
            checkLevelUp();
            
            // Prepara o próximo inimigo
            setTimeout(() => {
                if (confirm('Deseja continuar lutando na Floresta dos Iniciantes?')) {
                    spawnNewEnemy();
                } else {
                    saveGame();
                    window.location.href = 'mapa-mundi.html';
                }
            }, 1000);
        }

        // Jogador derrotado
        function playerDefeated() {
            addToBattleLog('Você foi derrotado!');
            
            // Reseta a vida do jogador
            gameState.player.health = Math.floor(gameState.player.maxHealth * 0.5);
            
            setTimeout(() => {
                if (confirm('Você foi derrotado! Deseja voltar ao mapa?')) {
                    saveGame();
                    window.location.href = 'mapa-mundi.html';
                }
            }, 500);
        }

        // Tenta fugir da batalha
        function tryToFlee() {
            const fleeChance = 0.7; // 70% de chance de fugir
            
            if (Math.random() < fleeChance) {
                addToBattleLog('Você fugiu da batalha!');
                saveGame();
                setTimeout(() => {
                    window.location.href = 'mapa-mundi.html';
                }, 1000);
            } else {
                addToBattleLog('Você não conseguiu fugir!');
                enemyTurn();
            }
            
            updateUI();
        }

        // Abre o inventário
        function openInventory() {
            // Implementação do inventário
            addToBattleLog('Inventário aberto (em desenvolvimento)');
        }

        // Gera um novo inimigo
        function spawnNewEnemy() {
            const enemies = [
                { name: 'Lobo', maxHealth: 50, attack: 8, defense: 3, experience: 25, gold: 10 },
                { name: 'Goblin', maxHealth: 40, attack: 10, defense: 2, experience: 30, gold: 15 },
                { name: 'Aranha', maxHealth: 35, attack: 12, defense: 1, experience: 20, gold: 8 }
            ];
            
            const randomEnemy = enemies[Math.floor(Math.random() * enemies.length)];
            gameState.currentEnemy = { ...randomEnemy, health: randomEnemy.maxHealth };
            
            // Atualiza a imagem do inimigo
            // Atualiza o caminho da imagem do inimigo com base no nome
            const enemyImageMap = {
                'Lobo': 'Lobo',
                'Goblin': 'Goblin',
                'Aranha Gigante': 'Aranha Gigante'
                // Adicione outros inimigos conforme necessário
            };
            const enemyImageName = enemyImageMap[randomEnemy.name] || 'Lobo';
            document.getElementById('enemy-image').style.backgroundImage = `url('../assets/monstros/${enemyImageName}.png')`;
            
            addToBattleLog(`Um ${randomEnemy.name} selvagem apareceu!`);
            updateUI();
        }

        // Verifica se o jogador subiu de nível
        function checkLevelUp() {
            const { player } = gameState;
            
            while (player.experience >= player.nextLevelExp) {
                player.level++;
                player.experience -= player.nextLevelExp;
                player.nextLevelExp = Math.floor(player.nextLevelExp * 1.5);
                
                // Melhoria de status
                player.maxHealth += 10;
                player.health = player.maxHealth;
                player.attack += 2;
                player.defense += 1;
                
                addToBattleLog(`Parabéns! Você subiu para o nível ${player.level}!`);
            }
            
            updateUI();
        }

        // Adiciona uma mensagem ao log de batalha
        function addToBattleLog(message) {
            gameState.battleLog.push(message);
            if (gameState.battleLog.length > 50) {
                gameState.battleLog.shift();
            }
            updateBattleLog();
        }

        // Atualiza o log de batalha na tela
        function updateBattleLog() {
            elements.battleLog.innerHTML = gameState.battleLog
                .map(entry => `<div class="log-entry">${entry}</div>`)
                .join('');
            elements.battleLog.scrollTop = elements.battleLog.scrollHeight;
        }

        // Salva o jogo
        function saveGame() {
            // Remove o inimigo atual antes de salvar
            const gameStateToSave = { ...gameState };
            delete gameStateToSave.currentEnemy;
            
            localStorage.setItem('gameState', JSON.stringify(gameStateToSave));
        }

        // Carrega o jogo salvo
        function loadGame() {
            const savedGame = localStorage.getItem('gameState');
            if (savedGame) {
                const parsed = JSON.parse(savedGame);
                Object.assign(gameState.player, parsed.player || {});
            }
        }

        // Inicializa o jogo quando a página carregar
        window.addEventListener('load', () => {
            loadGame();
            init();
        });
    </script>
</body>
</html>
