<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BLAZE AND STEEL</title>
    <style>
        /* Vari√°veis de Cores (CSS Custom Properties) */
        :root {
            --color-primary: #1e1e2d;
            --color-secondary: #36364f;
            --color-text: #e0e0e0;
            --color-accent: #f39c12; /* Ouro */
            --color-combat: #c0392b;
            /* Combate/Aventura */
            --color-evolve: #8e44ad;
            /* Evoluir/Treinamento */
            --color-soul: #9b59b6;
            /* Alma/Reencarna√ß√£o */
            --color-hp: #2ecc71;
            /* HP/Vida */
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--color-primary);
            color: var(--color-text);
            margin: 0;
            display: flex;
            min-height: 100vh;
            overflow: hidden;
        }

        /* Estrutura Geral */
        #app-wrapper {
            display: flex;
            width: 100%;
        }

        /* Sidebar (Menu Lateral) */
        #sidebar {
            width: 200px;
            background-color: var(--color-secondary);
            padding: 20px 0;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.5);
            display: none; 
            flex-shrink: 0;
        }

        .sidebar-menu button {
            display: block;
            width: 100%;
            padding: 15px 20px;
            text-align: left;
            background: none;
            border: none;
            color: var(--color-text);
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
            display: flex; 
            align-items: center;
        }

        .sidebar-menu button:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .sidebar-menu button.active {
            background-color: var(--color-evolve);
            font-weight: bold;
            color: white; 
        }
        
        .sidebar-menu button::before {
            content: '';
            margin-right: 10px;
            font-size: 1.2em;
            width: 25px; 
            text-align: center;
        }
        
        /* Defini√ß√£o de √çcones */
        #btn-training::before { content: 'üè†';
            color: var(--color-evolve); } 
        #btn-adventure::before { content: 'üó∫Ô∏è'; color: var(--color-combat);
            } 
        #btn-upgrades::before { content: '‚è´'; color: var(--color-accent);
            } 
        #btn-equipment::before { content: '‚öîÔ∏è'; color: var(--color-hp);
            } 
        #btn-inventory::before { content: 'üì¶'; color: #f1c40f;
            } /* Cor amarela para invent√°rio */
        #btn-status::before { content: 'üë§'; color: var(--color-soul);
            } 
        #btn-expedition::before { content: 'üß≠'; color: #f1c40f;
            } 


        /* √Årea de Conte√∫do Principal */
        #main-content {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            max-height: 100vh;
            display: none; 
            position: relative;
        }
        
        /* Bot√£o de √Åudio (Dentro do Jogo) */
        #audio-control-button {
            background-color: var(--color-secondary);
            border: 1px solid var(--color-accent);
            color: var(--color-text);
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            z-index: 10;
        }

        /* Pain√©is de Conte√∫do (Geral) */
        .content-panel {
            background-color: var(--color-secondary);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        /* Menu Inicial (Start Menu) */
        #start-menu {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100vh;
            position: fixed; 
            top: 0;
            left: 0;
            background-color: var(--color-primary);
            z-index: 100;
        }
        
        .game-logo {
            max-width: 90%;
            width: 500px;
            height: auto;
            margin-bottom: 50px;
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
        }

        .menu-button-stack button {
            display: block;
            width: 300px;
            padding: 15px 20px;
            margin: 10px 0;
            border: 2px solid var(--color-accent);
            border-radius: 5px;
            background-color: var(--color-combat);
            color: var(--color-text);
            font-size: 1.2em;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            box-shadow: 0 4px var(--color-accent);
        }

        .menu-button-stack button:hover {
            background-color: #e74c3c;
            transform: translateY(-2px);
            box-shadow: 0 6px var(--color-accent);
        }

        .menu-button-stack button:active {
            transform: translateY(2px);
            box-shadow: 0 2px var(--color-accent);
        }
        
        /* Estilo para o Slider de Volume */
        .volume-control-container {
            margin-top: 20px;
            padding: 10px;
            background-color: var(--color-secondary);
            border-radius: 5px;
            width: 300px;
            text-align: center;
        }

        .volume-control-container label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        /* Ajuste a posi√ß√£o do controle de volume para o menu inicial */
        #start-menu .volume-control-container {
            position: absolute;
            bottom: 33px; 
            left: 50%;
            transform: translateX(-50%);
            width: 90%; 
            max-width: 300px;
        }


        /* Painel de Cria√ß√£o de Personagem - ESTILO ISOLADO */
        #character-creation-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--color-primary);
            z-index: 99;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
            box-sizing: border-box;
        }

        #character-creation-panel .content-panel {
            max-width: 600px;
            margin: auto;
            padding: 30px;
            border: 2px solid var(--color-accent);
        }
        
        /* Header e Display de Recursos */
        #header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px 20px 0;
            border-bottom: 1px solid var(--color-secondary);
            margin-bottom: 20px;
        }

        .resource-display {
            display: flex;
            gap: 15px;
        }

        .resource-item {
            font-size: 1.1em;
            font-weight: bold;
        }

        .resource-item span {
            margin-left: 5px;
        }
        
        /* Bot√µes de A√ß√£o (Geral) */
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Estilo do Bot√£o Level Up */
        #hero-training-panel button#level-up-button {
            background-color: var(--color-evolve);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            margin-top: 10px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        #hero-training-panel button#level-up-button:hover:not(:disabled) {
            background-color: #6c3483;
        }
        
        /* Estilo para o logo ADVENTURE */
        #adventure-title-logo {
            display: block;
            margin: 0 auto 20px auto;
            max-width: 300px; 
            height: auto;
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
        }

        /* Estilo para os bot√µes de sele√ß√£o de classe */
        #class-selection-container {
             display: flex;
             justify-content: center; 
             flex-wrap: wrap; 
             gap: 15px;
        }
        
        #class-selection-container button {
            background-color: var(--color-secondary);
            color: var(--color-text); 
            border: 2px solid var(--color-primary); 
            padding: 10px 15px; 
            border-radius: 5px; 
            cursor: pointer;
            width: 150px;
            height: 150px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: border-color 0.2s, background-color 0.2s;
        }
        
        #class-selection-container button img {
            max-width: 80px;
            max-height: 80px; 
            margin-bottom: 5px;
            border-radius: 5px;
        }
        
        #class-selection-container button:hover {
            border-color: var(--color-accent);
        }

        /* Estilos para o Invent√°rio e Equipamento */
        .item-card {
            background-color: #2c3e50;
            border: 2px solid var(--color-secondary);
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
        }

        .item-card:hover {
            background-color: #34495e;
            border-color: var(--color-accent);
        }
        
        .item-card.equipped {
            border-color: var(--color-hp);
            box-shadow: 0 0 5px var(--color-hp);
        }

        .item-card p {
            margin: 5px 0 0 0;
            font-size: 0.9em;
        }

        .slot-container {
            display: flex;
            align-items: center;
            padding: 10px;
            border: 1px dashed var(--color-accent);
            border-radius: 5px;
            background-color: #1a1a25;
        }

        .slot-label {
            width: 100px;
            font-weight: bold;
            color: var(--color-accent);
        }

        .equipped-item-display {
            flex-grow: 1;
            padding: 5px;
            background-color: #2c3e50;
            border-radius: 3px;
        }

        .empty-slot {
            font-style: italic;
            color: #7f8c8d;
        }
        
        /* -------------------------------------- */
        /* RESPONSIVIDADE (MOBILE / TELAS PEQUENAS) */
        /* -------------------------------------- */
        @media (max-width: 768px) {
            
            /* Estrutura Principal */
            body {
     
            overflow-y: auto;
            }

            #app-wrapper {
                flex-direction: column;
            }
            
            /* Sidebar (Menu) */
            #sidebar {
                width: 100%;
                padding: 10px 0;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
                order: -1;
            }

            .sidebar-menu {
                display: flex;
                flex-wrap: wrap;
                justify-content: space-around;
                gap: 5px;
            }

            .sidebar-menu button {
                width: 45%;
                text-align: center;
                padding: 8px 10px;
                font-size: 0.9em;
                justify-content: center; 
            }
            
            /* Remove o √≠cone extra para economizar espa√ßo no mobile */
            .sidebar-menu button::before {
                content: none !important;
                margin-right: 0;
                width: auto;
            }

            /* Conte√∫do Principal */
            #main-content {
                padding: 10px;
            }

            /* Header (Recursos) */
            #header {
                flex-direction: column;
                align-items: flex-start;
                padding-bottom: 10px;
                margin-bottom: 10px;
            }

            .resource-display {
                flex-wrap: wrap;
                gap: 8px 15px; 
            }
            
            /* Logo de Aventura */
            #adventure-title-logo {
                max-width: 100%;
            }
            
            /* Bot√µes do Menu Inicial */
            .menu-button-stack button {
                width: 250px;
            }
            
            /* Cria√ß√£o de Personagem Mobile */
            #character-creation-panel .content-panel {
                margin: 20px 10px;
                padding: 20px;
            }
            
            #class-selection-container {
                flex-direction: column;
                align-items: center;
            }

            #class-selection-container button {
                width: 80%;
                height: auto;
                padding: 10px;
            }

            /* √Åudio Control - Ajuste para mobile */
            #audio-control-button {
                top: 10px;
                right: 10px;
            }
        }
    </style>
</head>
<body>
    
    <audio id="game-theme-music" loop>
        <source src="assets/theme_music.mp3" type="audio/mpeg"> 
        Seu navegador n√£o suporta a tag de √°udio.
    </audio>

    <div id="app-wrapper">

        <div id="start-menu">
            <img src="assets/blaze-and-steel.png" alt="Blaze and Steel Logo" class="game-logo"> 
            
            <div class="menu-button-stack">
                <button onclick="showCharacterCreation()">NOVO JOGO</button> 
                <button onclick="loadGame(true)">CARREGAR JOGO</button>
     
                <button onclick="alert('Sair: Por enquanto, feche a aba.')">SAIR</button>
            </div>
            
            <div class="volume-control-container">
                <label for="volume-slider-start">üé∂ Volume: <span id="volume-label-start">100</span></label>
                <input type="range" id="volume-slider-start" min="0" max="100" value="100" oninput="setVolume(this.value)">
    
            </div>
        </div>

        <div id="character-creation-panel" style="display: none;">
            <div class="content-panel" style="text-align: center;">
                <h2>Crie Seu Her√≥i!</h2>
                <p>Escolha um nome e uma classe para come√ßar sua aventura.</p>
               
 
                <div style="margin: 20px 0;">
                    <label for="hero-name-input" style="font-weight: bold;
                    display: block; margin-bottom: 5px;">Nome do Her√≥i:</label>
                    <input type="text" id="hero-name-input" placeholder="Ex: Her√≥i Blaze" maxlength="20" style="padding: 10px;
                    font-size: 1.2em; width: 80%; max-width: 300px; border-radius: 5px; border: 1px solid var(--color-accent); background-color: var(--color-primary);
                    color: var(--color-text);">
                </div>
                
                <h3>Selecione Sua Classe:</h3>
                <div id="class-selection-container">
                    </div>
            
        
                <div id="class-details" class="content-panel" style="margin-top: 20px;
                display: none; text-align: left; max-width: 500px; margin-left: auto; margin-right: auto;">
                    <h4>Detalhes da Classe Selecionada</h4>
                    <p><strong>Classe:</strong> <span id="selected-class-name"></span></p>
                    <p><strong>Estat√≠sticas Iniciais:</strong></p>
                    <ul>
     
                        <li>‚ù§Ô∏è HP Base: <span id="class-base-hp"></span></li>
                        <li>‚öîÔ∏è ATK Base: <span id="class-base-atk"></span></li>
                        <li style="font-weight: bold;">‚öîÔ∏è Equipamento Inicial: <span id="class-initial-equipment"></span></li>
                   
                     </ul>
                    <p style="font-style: italic;"></p>
                    
                    <button id="confirm-creation-button" disabled onclick="finalizeCreation()" style="background-color: var(--color-evolve);
                    color: white; padding: 12px 25px; border: none; border-radius: 5px; margin-top: 15px;
                    width: 100%;">
                        INICIAR JOGO!
                    </button>
                </div>
            </div>
        </div>

        <div id="sidebar">
         
            <div id="hero-info" style="text-align: center; margin-bottom: 20px;">
                <h3 id="hero-name"></h3>
                <p>N√≠vel: <span id="power-level">1</span></p>
            </div>
            <nav class="sidebar-menu">
                <button id="btn-training" onclick="showPanel('training-panel')" class="active">Quartel-General</button>
             
                <button id="btn-adventure" onclick="showPanel('adventure-panel')">Aventura</button>
                <button id="btn-upgrades" onclick="showPanel('upgrades-panel')">Upgrades</button>
                <button id="btn-equipment" onclick="showPanel('equipment-panel')">Equipamento</button>
                <button id="btn-inventory" onclick="showPanel('inventory-panel')">Invent√°rio</button>
                <button id="btn-status" onclick="showPanel('status-panel')">Status</button>
                <button id="btn-expedition" onclick="showPanel('expedition-panel')">Expedi√ß√£o</button>
     
            </nav>
        </div>

        <div id="main-content">
            
            <div style="position: absolute;
            top: 10px; right: 10px; z-index: 10; text-align: right;">
                <button id="audio-control-button" onclick="toggleMute()" style="margin-bottom: 5px;">
                    üîä Mute
                </button>
                
                <div class="volume-control-container" style="width: 150px;
                padding: 5px; margin-left: auto;">
                    <label for="volume-slider-game" style="font-size: 0.8em;
                    margin: 0;">Volume: <span id="volume-label-game">100</span></label>
                    <input type="range" id="volume-slider-game" min="0" max="100" value="100" oninput="setVolume(this.value)">
                </div>
            </div>


            <div id="header">
                <h2></h2>
              
                <div class="resource-display">
                    <div class="resource-item" style="color: var(--color-accent);">üí∞ Ouro: <span id="gold-count">0</span></div>
                    <div class="resource-item" style="color: var(--color-soul);">üíÄ Alma: <span id="soul-count">0</span></div>
                </div>
            </div>

            <div id="content-area">
    
                
                <div id="training-panel" style="display: none;">
                    
                    <div id="special-missions-panel" class="content-panel" style="text-align: center;">
                        <h3>Miss√µes 
                        Especiais</h3>
                        <p>Progresso r√°pido e recompensas raras!</p>

                        <div id="daily-missions" style="margin-bottom: 15px;">
                            <h4>Di√°rias (Reseta em 24h)</h4>
              
                            <button id="daily-scouting" class="mission-button mission-daily" onclick="startDailyMission('scouting')">
                                Fazer Patrulha (Recompensa: 100 EXP |
                                50 üí∞)
                            </button>
                            <button id="daily-training-drills" class="mission-button mission-daily" onclick="startDailyMission('drills')">
                                Exerc√≠cios de Treinamento (Recompensa: 200 EXP | 
                                +2 ATK B√¥nus!)
                            </button>
                        </div>

                        <div id="unique-missions">
                     
                            <h4>√önicas (Desaparecem ap√≥s concluir)</h4>
                            <button id="unique-first-quest" class="mission-button mission-unique" onclick="startUniqueMission('firstQuest')">
                                Provar o Valor (Recompensa: 500 EXP | +10 HP B√¥nus!)
                 
                            </button>
                            <button id="unique-tutorial-complete" class="mission-button mission-unique" onclick="startUniqueMission('tutorialComplete')">
                                Finalizar Tutorial B√°sico (Recompensa: 100 üí∞ | 100 ‚ö°) </button>
                
                        </div>
                    </div>

                    <div id="resource-missions-panel" class="content-panel" style="text-align: center;">
                        <h3>Obten√ß√£o de Recursos (Cooldowns)</h3>
                     
                        <button id="work-gold-button" onclick="startMission('workGold')" style="background-color: var(--color-accent);
                        color: black; padding: 10px; margin: 5px;">
                            Trabalhar por Ouro (60s | Ganho: 20 üí∞)
                        </button>
                    </div>

                
     
                    <div id="hero-training-panel" class="content-panel" style="text-align: center;">
                        <h3>Treinamento & Progresso</h3>
                        <button onclick="trainForStats('attack')" style="background-color: var(--color-combat);
                        color: white; padding: 10px; margin: 5px;">
                            Estudar T√°ticas (Ganho: 10 EXP)
                        </button>
                        
               
                        <button onclick="trainForStats('defense')" style="background-color: var(--color-hp); color: white; padding: 10px;
                        margin: 5px;">
                            Preparar Defesas (Ganho: 10 EXP)
                        </button>

                        <div style="margin-top: 20px;">
                 
                            <p>üåü N√≠vel de Poder: <span id="power-level-display">1</span></p>
                            <p>‚ú® EXP: <span id="exp-count">0</span> / <span id="exp-required">50</span></p>
                            <button id="level-up-button" onclick="levelUp()" disabled style="background-color: var(--color-evolve);
                            color: white;">
                                SUBIR DE N√çVEL (Falta: 50 EXP)
                            </button>
                        </div>
          
                    </div>
                </div>

                <div id="adventure-panel" style="display: none;">
                    
                    <img src="assets/adventure.png" alt="ADVENTURE" id="adventure-title-logo">
            
 
                    
                    <div class="content-panel" style="display: flex;
                    justify-content: space-between;">
                        
                        <div style="flex: 1;
                        margin-right: 20px;">
                            <h2 id="monster-name">Monstro</h2>
                            <div id="monster-image" style="background-color: #7f8c8d;
                            width: 150px; height: 150px; border-radius: 8px; margin-bottom: 10px;">
                                </div>
                            <p>‚ù§Ô∏è HP: <span id="monster-hp-display">0</span> / 0</p>
                            
                            <p>‚öîÔ∏è ATK: <span id="monster-atk-display">0</span></p>
                            <p style="font-size: 0.9em;">Recompensa: <span id="monster-reward-exp">0</span> EXP, <span id="monster-reward-gold">0</span> üí∞</p>
                            
                            <button id="start-battle-button" onclick="startBattle()" style="background-color: var(--color-combat);
                            color: white; padding: 10px 20px; margin-top: 15px;">
                                Iniciar Batalha!
                            </button>
                        </div>

         
                        <div style="flex: 2; background-color: #2c3e50;
                        padding: 15px; border-radius: 5px; height: 250px; overflow-y: auto;">
                            <h3>üìù Log de Combate</h3>
                            <div id="combat-log">
                                <p>A 
                                batalha come√ßar√° aqui. Selecione um monstro.</p>
                            </div>
                        </div>
                    </div>
                    
   
                     
                    <div class="content-panel">
                        <h3>Estat√≠sticas de Batalha do Her√≥i</h3>
                        <div id="hero-battle-stats" style="display: flex;
                        justify-content: space-around; text-align: center;">
                            <p>‚ù§Ô∏è HP: <span id="hero-current-hp">10</span> / <span id="hero-max-hp">10</span></p>
                            <p>‚öîÔ∏è ATK: <span id="hero-total-atk">1</span></p>
                            <p>üí• Dano por N√≠vel: 
                            x<span id="hero-level-multiplier">1</span></p>
                        </div>
                    </div>

                    <div class="content-panel">
                        <h3>Oponentes Dispon√≠veis (N√≠vel 1)</h3>
                        <div id="monster-selection" style="display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px;">
                            
                        </div>
                    </div>
                    
                </div>

                <div id="upgrades-panel" style="display: none;">
                    <h2>‚è´ Upgrades de Her√≥i</h2>
                    
                    <div class="content-panel">
                        <h3>Aprimoramentos de Estat√≠sticas Permanentes</h3>
                        
                        <div style="margin-bottom: 15px;">
                            <p style="font-size: 1.1em; font-weight: bold;">
                                ‚öîÔ∏è Ataque Base: <span id="hero-base-atk-display">1</span>
                            </p>
                            <p>Pr√≥ximo Upgrade: +1 ATK Base por <span id="atk-upgrade-cost">50</span> üí∞</p>
                            <button id="buy-atk-upgrade" onclick="buyUpgrade('atk')" style="background-color: var(--color-accent);
                            color: black; padding: 8px 15px; border: none; border-radius: 5px;">
                                Comprar Upgrade de ATK
                            </button>
                        </div>
                        
                        <div>
                            <p style="font-size: 1.1em; font-weight: bold;">
                                ‚ù§Ô∏è HP Base: <span id="hero-base-hp-display">10</span>
                            </p>
                            <p>Pr√≥ximo Upgrade: +10 HP Base por <span id="hp-upgrade-cost">50</span> üí∞</p>
                            <button id="buy-hp-upgrade" onclick="buyUpgrade('hp')" style="background-color: var(--color-accent);
                            color: black; padding: 8px 15px; border: none; border-radius: 5px;">
                                Comprar Upgrade de HP
                            </button>
                        </div>
                    </div>
                    
                    <div class="content-panel">
                        <h3>Reinicializa√ß√£o de Alma (Reencarna√ß√£o)</h3>
                        <p>Ao reencarnar, voc√™ perde seu n√≠vel, ouro e equipamentos, mas ganha um b√¥nus de Alma (üíÄ) permanente que aumenta todos os seus ganhos futuros.</p>
                        <p>üíÄ B√¥nus Total de Alma: <span id="soul-bonus-display">0%</span></p>
                        <button onclick="reincarnate()" style="background-color: var(--color-soul);
                        color: white; padding: 10px 20px; margin-top: 10px;">
                            REINCARNAR! (Ainda n√£o implementado)
                        </button>
                    </div>

                </div>
                
                <div id="equipment-panel" style="display: none;">
                    <h2>‚öîÔ∏è Equipamento</h2>
                    <div style="display: flex; gap: 20px; margin-top: 20px;">
                        <div class="content-panel" style="flex: 2;">
                            <h3>Slots de Equipamento</h3>
                            <div id="equipment-list" style="display: flex; flex-direction: column; gap: 10px;">
                            </div>
                        </div>
                        
                        <div class="content-panel" style="flex: 1;">
                            <h3>Estat√≠sticas Totais</h3>
                            <div id="hero-stats-equipment">
                                <p>‚ù§Ô∏è HP M√°ximo: <span id="eq-max-hp">0</span> (Base: <span id="eq-base-hp">0</span> + B√¥nus: <span id="eq-bonus-hp">0</span>)</p>
                                <p>‚öîÔ∏è ATK Total: <span id="eq-total-atk">0</span> (Base: <span id="eq-base-atk">0</span> + B√¥nus: <span id="eq-bonus-atk">0</span>)</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="inventory-panel" style="display: none;">
                    <h2>üì¶ Invent√°rio</h2>
                    <div style="display: flex; gap: 20px; margin-top: 20px;">
                        <div class="content-panel" style="flex: 2;">
                            <h3>Itens Coletados</h3>
                            <div id="inventory-list" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px;">
                            </div>
                        </div>
                        
                        <div class="content-panel" style="flex: 1; min-width: 250px;">
                            <h3>Detalhes do Item</h3>
                            <div id="item-inspection-area">
                                <p style="font-style: italic;
                                color: #7f8c8d;">Selecione um item no invent√°rio para ver os detalhes.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="status-panel" style="display: none;">
                    <h2>üë§ Status do Her√≥i</h2>
                    
                    <div class="content-panel">
                        <h3>Estat√≠sticas Base</h3>
                        <p>N√≠vel de Poder: <span id="status-level">1</span></p>
                        <p>Classe: <span id="status-class">Aventureiro</span></p>
                        <p>EXP: <span id="status-exp">0</span> / <span id="status-exp-required">50</span></p>
                        <hr>
                        <p>‚ù§Ô∏è HP Base: <span id="status-base-hp">10</span></p>
                        <p>‚öîÔ∏è ATK Base: <span id="status-base-atk">1</span></p>
                    </div>

                    <div class="content-panel">
                        <h3>Recursos</h3>
                        <p>üí∞ Ouro: <span id="status-gold">0</span></p>
                        <p>üíÄ Alma: <span id="status-soul">0</span></p>
                    </div>
                </div>
                
                <div id="expedition-panel" style="display: none;">
                    <h2>üß≠ Expedi√ß√£o</h2>
                    <div class="content-panel">
                        <h3>√Åreas de Expedi√ß√£o</h3>
                        <p>Expedi√ß√µes s√£o miss√µes autom√°ticas de longa dura√ß√£o (horas), ideais para quando voc√™ est√° offline.</p>
                        
                        <div id="expedition-missions">
                            <button disabled style="opacity: 0.5;">
                                Floresta dos Murm√∫rios (3h) - Recompensa: EXP e Materiais (Ainda n√£o implementado)
                            </button>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
    
    <script>
        // Vari√°vel de controle para intera√ß√£o inicial de √°udio (Requisito do Chrome/Firefox)
        let hasInteracted = false; 
        
        // ====================================================================
        // I. VARI√ÅVEIS DE ESTADO DO JOGO (ATUALIZADAS)
        // ====================================================================
        
        // Estado do Her√≥i
        let heroName = "Her√≥i";
        let selectedClass = null; // A chave da classe (ex: 'warrior', 'mage')
        let powerLevel = 1;
        let currentExp = 0;
        let expToNextLevel = 50;
        let gold = 0; 
        let soul = 0; 

        // Estat√≠sticas Base (Aumentam com upgrades)
        let heroBaseHP = 10;
        let heroBaseATK = 1;

        // Estat√≠sticas de Batalha (Atualizadas ao Iniciar Batalha)
        let heroTotalHP = heroBaseHP; // HP M√°ximo ajustado por equipamento
        let heroTotalATK = heroBaseATK; // ATK Total ajustado por equipamento
        let heroCurrentHP = heroBaseHP; // HP Atual em combate

        // Custos de Upgrade
        let atkUpgradeCost = 50; 
        let hpUpgradeCost = 50; 

        // Estado de Combate
        let currentMonster = null; // Monstro atual
        let isFighting = false; // Se uma batalha est√° em andamento

        // Cooldowns
        const DAILY_COOLDOWN_MS = 24 * 60 * 60 * 1000; // 24 horas
        let missionCooldowns = {
            workGold: 0, 
        };
        
        // Status de Miss√µes
        let dailyMissionStatus = {
            scouting: { completedAt: 0 },
            drills: { completedAt: 0 }
        };
        let uniqueMissionStatus = {
            firstQuest: { completed: false },
            tutorialComplete: { completed: false }
        };

        // Estrutura de Equipamento
        const EQUIPMENT_SLOTS = {
            weapon: { name: "Arma", type: "weapon", currentItem: null },
            armor: { name: "Armadura", type: "armor", currentItem: null }
        };
        let inspectedItem = null; // Item sendo inspecionado no invent√°rio
        let nextItemId = 1000; // ID √∫nico para novos itens (come√ßa em 1000 para evitar conflitos com IDs de classes)
        
        // Estrutura do Invent√°rio (Inicia Vazio para o Novo Jogo)
        let inventory = []; 

        // Vari√°veis de √Åudio
        let currentVolume = 1.0; 
        let isMuted = false;
        
        // Defini√ß√£o de Classes e Monstros
        const CLASSES = {
            warrior: {
                name: "Guerreiro",
                description: "Forte e resistente, excelente na linha de frente.",
                initialHP: 20, 
                initialATK: 2,
                imagePath: "assets/warrior.png", // Imagem placeholder
                startingItems: [
                    { id: 1, name: "Espada Curta", type: "weapon", atk: 2, rarity: "Comum", description: "Uma espada b√°sica para iniciantes." },
                    { id: 2, name: "Escudo Leve", type: "armor", hpBonus: 5, rarity: "Comum", description: "Um escudo para prote√ß√£o b√°sica." }
                ]
            },
            mage: {
                name: "Mago",
                description: "Fraco em defesa, mas com alto potencial de dano m√°gico.",
                initialHP: 10,
                initialATK: 1,
                imagePath: "assets/mage.png", // Imagem placeholder
                startingItems: [
                    { id: 3, name: "Cajado R√∫stico", type: "weapon", atk: 1, rarity: "Comum", description: "Um cajado feito de galho de √°rvore." },
                    { id: 4, name: "Manto de Tecido", type: "armor", hpBonus: 2, rarity: "Comum", description: "Um manto simples." }
                ]
            },
            archer: {
                name: "Arqueiro",
                description: "Equilibrado, focado em ataques √† dist√¢ncia.",
                initialHP: 15,
                initialATK: 3,
                imagePath: "assets/archer.png", // Imagem placeholder
                startingItems: [
                    { id: 5, name: "Arco Simples", type: "weapon", atk: 3, rarity: "Comum", description: "Um arco de ca√ßa padr√£o." },
                    { id: 6, name: "Veste Leve", type: "armor", hpBonus: 8, rarity: "Comum", description: "Vestimentas que favorecem a agilidade." }
                ]
            },
            assassin: {
                name: "Assassino",
                description: "Mestre da furtividade e do dano cr√≠tico. Pouca vida, alto ataque.",
                initialHP: 8,
                initialATK: 3,
                imagePath: "assets/assassino.png", // Imagem placeholder
                startingItems: [
                    { id: 7, name: "Adaga de A√ßo", type: "weapon", atk: 4, rarity: "Incomum", description: "Uma l√¢mina afiada, ideal para golpes r√°pidos." },
                    { id: 8, name: "Veste de Sombra", type: "armor", hpBonus: 5, rarity: "Comum", description: "Roupas escuras que favorecem a discri√ß√£o." }
                ]
            }
        };

        // Objeto central para a sele√ß√£o de monstros por N√≠vel
        const MONSTERS_BY_LEVEL = {
            1: [ 
                // Reduzindo o custo de energia para 0, agora √© um recurso de tempo/cooldown
                { name: "Slime Iniciante", baseHP: 20, atk: 2, expReward: 30, goldReward: 5, cost: 0 },
                { name: "Mosquito Mutante", baseHP: 15, atk: 3, expReward: 35, goldReward: 6, cost: 0 }
            ],
            2: [
                { name: "Lobo Faminto", baseHP: 45, atk: 8, expReward: 70, goldReward: 15, cost: 0 },
                { name: "Orc Desgrenhado", baseHP: 60, atk: 5, expReward: 80, goldReward: 20, cost: 0 }
            ]
        };
        
        // ====================================================================
        // II. REFER√äNCIAS DE ELEMENTOS HTML
        // ====================================================================
        
        // Elementos de Estrutura
        const startMenu = document.getElementById('start-menu');
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('main-content');
        const headerTitle = document.querySelector('#header h2');
        const contentArea = document.getElementById('content-area');
        
        // Elementos de Recursos
        const goldCount = document.getElementById('gold-count');
        const soulCount = document.getElementById('soul-count');
        
        // Elementos de Cria√ß√£o de Personagem
        const characterCreationPanel = document.getElementById('character-creation-panel');
        const heroNameInput = document.getElementById('hero-name-input');
        const classContainer = document.getElementById('class-selection-container');
        const classDetailsPanel = document.getElementById('class-details');
        const confirmCreationButton = document.getElementById('confirm-creation-button');
        
        // Elementos de Treinamento/N√≠vel
        const heroNameDisplay = document.getElementById('hero-name');
        const powerLevelDisplay = document.getElementById('power-level-display');
        const expCount = document.getElementById('exp-count');
        const expRequired = document.getElementById('exp-required');
        const levelUpButton = document.getElementById('level-up-button');
        
        // Elementos de Upgrades
        const heroBaseATKDisplay = document.getElementById('hero-base-atk-display');
        const atkUpgradeCostDisplay = document.getElementById('atk-upgrade-cost');
        const heroBaseHPDisplay = document.getElementById('hero-base-hp-display');
        const hpUpgradeCostDisplay = document.getElementById('hp-upgrade-cost');
        const buyHpUpgradeButton = document.getElementById('buy-hp-upgrade');
        
        // Refer√™ncias de Combate
        const combatLog = document.getElementById('combat-log');
        const startBattleButton = document.getElementById('start-battle-button');
        const heroCurrentHPDisplay = document.getElementById('hero-current-hp');
        const heroMaxHPDisplay = document.getElementById('hero-max-hp');
        const heroTotalATKDisplay = document.getElementById('hero-total-atk');
        const heroLevelMultiplierDisplay = document.getElementById('hero-level-multiplier');
        const monsterSelectionPanel = document.getElementById('monster-selection'); // Painel de sele√ß√£o de monstros
        
        // Refer√™ncias de Equipamento e Invent√°rio
        const inventoryPanel = document.getElementById('inventory-list');
        const equipmentPanel = document.getElementById('equipment-list');
        const inspectionArea = document.getElementById('item-inspection-area');
        
        // Refer√™ncias de Volume
        const gameThemeMusic = document.getElementById('game-theme-music');
        const volumeSliderStart = document.getElementById('volume-slider-start');
        const volumeLabelStart = document.getElementById('volume-label-start');
        const volumeSliderGame = document.getElementById('volume-slider-game');
        const volumeLabelGame = document.getElementById('volume-label-game');
        const audioControlButton = document.getElementById('audio-control-button');
        
        // ====================================================================
        // III. FUN√á√ïES DE DISPLAY E NAVEGA√á√ÉO
        // ====================================================================
        
        // Atualiza a exibi√ß√£o na tela
        function updateDisplay() {
            // NOME
            heroNameDisplay.textContent = heroName;
            headerTitle.textContent = heroName;
            
            // Recursos
            document.getElementById('power-level').textContent = powerLevel; // Sidebar
            powerLevelDisplay.textContent = powerLevel; // Training
            goldCount.textContent = gold;
            soulCount.textContent = soul;

            // EXP
            expCount.textContent = currentExp;
            expRequired.textContent = expToNextLevel;
            
            // Level Up
            if (currentExp >= expToNextLevel) {
                levelUpButton.disabled = false;
                levelUpButton.textContent = 'SUBIR DE N√çVEL (PRONTO!)';
            } else {
                levelUpButton.disabled = true;
                levelUpButton.textContent = `SUBIR DE N√çVEL (Falta: ${expToNextLevel - currentExp} EXP)`;
            }

            // Upgrades
            heroBaseATKDisplay.textContent = heroBaseATK;
            atkUpgradeCostDisplay.textContent = atkUpgradeCost;
            heroBaseHPDisplay.textContent = heroBaseHP;
            hpUpgradeCostDisplay.textContent = hpUpgradeCost;
            
            document.getElementById('buy-atk-upgrade').disabled = gold < atkUpgradeCost;
            document.getElementById('buy-hp-upgrade').disabled = gold < hpUpgradeCost;
            
            // Stats de Batalha (Geral)
            heroMaxHPDisplay.textContent = heroTotalHP;
            heroTotalATKDisplay.textContent = heroTotalATK;
            heroLevelMultiplierDisplay.textContent = powerLevel; // Multiplicador √© o N√≠vel
            
            // HP Atual
            if (heroCurrentHP > heroTotalHP) {
                 heroCurrentHP = heroTotalHP; // Cura se o max HP aumentar
            }
            heroCurrentHPDisplay.textContent = Math.max(0, heroCurrentHP);
            
            // Status Panel
            document.getElementById('status-level').textContent = powerLevel;
            document.getElementById('status-class').textContent = selectedClass ? CLASSES[selectedClass].name : 'N/A';
            document.getElementById('status-exp').textContent = currentExp;
            document.getElementById('status-exp-required').textContent = expToNextLevel;
            document.getElementById('status-base-hp').textContent = heroBaseHP;
            document.getElementById('status-base-atk').textContent = heroBaseATK;
            document.getElementById('status-gold').textContent = gold;
            document.getElementById('status-soul').textContent = soul;
            
            // Volume
            volumeLabelStart.textContent = Math.round(currentVolume * 100);
            volumeLabelGame.textContent = Math.round(currentVolume * 100);
            volumeSliderStart.value = Math.round(currentVolume * 100);
            volumeSliderGame.value = Math.round(currentVolume * 100);
            audioControlButton.textContent = isMuted ? 'üîá Unmute' : 'üîä Mute';

            // Cooldowns
            updateCooldownDisplays();
            
            // Miss√µes Di√°rias e √önicas
            updateMissionButtons();
            
            // Equipamento e Invent√°rio
            renderEquipment();
            renderInventory();
            
            // Adventure Panel (Monstro Atual)
            if (currentMonster) {
                document.getElementById('monster-hp-display').textContent = Math.max(0, currentMonster.currentHP);
                document.getElementById('monster-atk-display').textContent = currentMonster.atk;
            } else {
                // Se n√£o houver monstro selecionado, seleciona um para iniciar
                selectMonsterByLevel();
            }
        }
        
        // Atualiza a exibi√ß√£o de cooldowns (Recursos)
        function updateCooldownDisplays() {
            const now = Date.now();
            
            // Cooldowns de Miss√µes de Recurso
            ['workGold'].forEach(type => {
                const button = document.getElementById(`${type}-button`);
                let cooldown = missionCooldowns[type];
                let duration = type === 'workGold' ? 60 : 0;
                let rewards = { gold: 20 };
                let buttonText = `Trabalhar por Ouro (${duration}s | Ganho: ${rewards.gold} üí∞)`;

                if (cooldown > now) {
                    const remainingSeconds = Math.ceil((cooldown - now) / 1000);
                    button.textContent = `[‚è≥ ${remainingSeconds}s] ${buttonText}`;
                    button.disabled = true;
                } else {
                    button.textContent = buttonText;
                    button.disabled = false;
                }
            });
            
            // Miss√µes Di√°rias (24h)
            for (const key in dailyMissionStatus) {
                const button = document.getElementById(`daily-${key}`);
                const status = dailyMissionStatus[key];
                
                if (status.completedAt > 0 && (now < status.completedAt + DAILY_COOLDOWN_MS)) {
                    const timeRemaining = status.completedAt + DAILY_COOLDOWN_MS - now;
                    const hours = Math.floor(timeRemaining / (1000 * 60 * 60));
                    const minutes = Math.floor((timeRemaining % (1000 * 60 * 60)) / (1000 * 60));
                    button.textContent = `[‚è≥ ${hours}h ${minutes}m] J√° Conclu√≠da Hoje`;
                    button.disabled = true;
                } else {
                    // Reset do status para permitir o clique
                    if (button) {
                        button.disabled = false;
                        // Atualiza o texto original se o cooldown passou
                        if (key === 'scouting') button.textContent = `Fazer Patrulha (Recompensa: 100 EXP | 50 üí∞)`;
                        if (key === 'drills') button.textContent = `Exerc√≠cios de Treinamento (Recompensa: 200 EXP | +2 ATK B√¥nus!)`;
                    }
                }
            }

            // Miss√µes √önicas (Desaparecem)
            for (const key in uniqueMissionStatus) {
                const button = document.getElementById(`unique-${key}`);
                const status = uniqueMissionStatus[key];
                
                if (status.completed) {
                    if (button) {
                        button.disabled = true;
                        button.textContent = `Conclu√≠da!`;
                        button.style.display = 'none'; // Esconde ap√≥s conclus√£o
                    }
                } else {
                    if (button) {
                        button.disabled = false;
                        button.style.display = 'block'; // Garante que esteja vis√≠vel
                    }
                }
            }
        }

        // Alterna o painel de conte√∫do principal
        function showPanel(panelId) {
            // Esconde todos os pain√©is
            const panels = contentArea.querySelectorAll('div[id$="-panel"]');
            panels.forEach(panel => {
                panel.style.display = 'none';
            });

            // Mostra o painel selecionado
            document.getElementById(panelId).style.display = 'block';

            // Atualiza o estado ativo dos bot√µes da sidebar
            const buttons = sidebar.querySelectorAll('button');
            buttons.forEach(button => {
                button.classList.remove('active');
            });
            document.getElementById(`btn-${panelId.replace('-panel', '')}`).classList.add('active');
            
            // A√ß√µes espec√≠ficas ao mostrar painel
            if (panelId === 'adventure-panel') {
                selectMonsterByLevel(); // Garante que um monstro esteja selecionado
            }
            
            updateDisplay();
        }

        // Exibe o painel de cria√ß√£o de personagem
        function showCharacterCreation() {
            // *** A√á√ÉO DE CORRE√á√ÉO (√Åudio) ***
            hasInteracted = true;
            checkAndPlayMusic();
            
            // Esconde o menu inicial
            startMenu.style.display = 'none';
            // Esconde a sidebar e o conte√∫do principal do jogo
            sidebar.style.display = 'none';
            mainContent.style.display = 'none';
            
            // Reseta a vari√°vel de classe para for√ßar a sele√ß√£o
            selectedClass = null;
            
            // Limpa o item inspecionado
            inspectedItem = null;
            
            // Exibe APENAS a tela de cria√ß√£o
            characterCreationPanel.style.display = 'flex';
            generateClassButtons();
        }

        // Gera os bot√µes de sele√ß√£o de classe no painel
        function generateClassButtons() {
            classContainer.innerHTML = '';
            for (const key in CLASSES) {
                const cls = CLASSES[key];
                const button = document.createElement('button');
                button.setAttribute('data-class', key);
                button.innerHTML = `
                    <img src="assets/${key}.png" alt="${cls.name} Icon" onerror="this.src='assets/placeholder.png';">
                    <span>${cls.name}</span>
                `;
                button.onclick = () => selectClass(key);
                classContainer.appendChild(button);
            }
        }

        // Seleciona uma classe e atualiza os detalhes
        function selectClass(className) {
            selectedClass = className;
            const cls = CLASSES[className];
            const buttons = classContainer.querySelectorAll('button');

            // Marca o bot√£o selecionado
            buttons.forEach(btn => {
                if (btn.getAttribute('data-class') === className) {
                    btn.style.borderColor = 'var(--color-evolve)';
                    btn.style.backgroundColor = 'rgba(142, 68, 173, 0.2)'; // Fundo levemente roxo
                } else {
                    btn.style.borderColor = 'var(--color-primary)';
                    btn.style.backgroundColor = 'var(--color-secondary)';
                }
            });

            // Atualiza os detalhes
            document.getElementById('selected-class-name').textContent = cls.name;
            document.getElementById('class-base-hp').textContent = cls.initialHP;
            document.getElementById('class-base-atk').textContent = cls.initialATK;
            
            // Detalhes do equipamento inicial
            const itemNames = cls.startingItems.map(item => `${item.name} (+${item.atk || item.hpBonus} ${item.atk ? 'ATK' : 'HP'})`);
            document.getElementById('class-initial-equipment').textContent = itemNames.join(' e ');
            
            classDetailsPanel.querySelector('p:last-of-type').textContent = cls.description; // Pega o √∫ltimo <p>
            
            classDetailsPanel.style.display = 'block';
            confirmCreationButton.disabled = false;
        }

        // Finaliza a cria√ß√£o do personagem e inicia o jogo
        function finalizeCreation() {
            const name = heroNameInput.value.trim();
            if (name === "" || selectedClass === null) {
                alert("Por favor, escolha um nome e uma classe.");
                return;
            }

            heroName = name;
            const cls = CLASSES[selectedClass];

            // 1. Configura as estat√≠sticas base
            heroBaseHP = cls.initialHP;
            heroBaseATK = cls.initialATK;
            heroCurrentHP = heroBaseHP; // HP atual igual ao base

            // 2. Reseta/Zera recursos e status de miss√µes
            powerLevel = 1;
            currentExp = 0;
            expToNextLevel = 50;
            gold = 0;
            soul = 0;
            atkUpgradeCost = 50;
            hpUpgradeCost = 50;
            dailyMissionStatus = { scouting: { completedAt: 0 }, drills: { completedAt: 0 } };
            uniqueMissionStatus = { firstQuest: { completed: false }, tutorialComplete: { completed: false } };
            missionCooldowns = { workGold: 0 };
            
            // 3. Adiciona e equipa itens iniciais
            inventory = [];
            for (const slotKey in EQUIPMENT_SLOTS) {
                EQUIPMENT_SLOTS[slotKey].currentItem = null; // Zera slots
            }
            
            // Adiciona itens iniciais
            cls.startingItems.forEach((starterItem, index) => {
                // Cria uma c√≥pia do item para que IDs de itens sejam √∫nicos em saves
                const newItem = { 
                    ...starterItem, 
                    id: nextItemId++, // Usa um ID incremental √∫nico para o item
                    rarity: starterItem.rarity || "B√°sico" // Adiciona a raridade se n√£o existir (para o display)
                };
                inventory.push(newItem); // Adiciona ao invent√°rio
                equipItem(newItem, false); // Equipa o item (sem alerta, para n√£o floodar)
            });
            
            // 4. Inicia o jogo
            characterCreationPanel.style.display = 'none'; // Esconde a tela de cria√ß√£o
            startGame(); // CHAMA A FUN√á√ÉO PARA INICIAR O JOGO
            saveGame(); // Salva o novo jogo
        }
        
        // Inicia o jogo ap√≥s cria√ß√£o ou carregamento
        function startGame() {
            sidebar.style.display = 'block';
            mainContent.style.display = 'block'; // Exibe o conte√∫do principal
            showPanel('training-panel');
            updateEquipmentStats(); // Calcula o total de stats baseado nos itens iniciais
            updateDisplay();
            
            // Configura√ß√£o do input de nome para o futuro
            heroNameInput.value = '';
        }
        
        // ====================================================================
        // IV. FUN√á√ïES DE √ÅUDIO
        // ====================================================================
        
        // Verifica se houve intera√ß√£o e toca a m√∫sica, se n√£o estiver tocando
        function checkAndPlayMusic() {
            if (hasInteracted && gameThemeMusic.paused && !gameThemeMusic.muted) {
                // Se o navegador bloquear o autoplay, isso pode falhar.
                gameThemeMusic.play().catch(error => {
                    console.log("Autoplay bloqueado. O √°udio ser√° reproduzido ap√≥s a pr√≥xima intera√ß√£o do usu√°rio.", error);
                    // O erro de autoplay √© comum; o usu√°rio precisa clicar novamente no documento.
                });
            }
        }
        
        // Define o volume da m√∫sica
        function setVolume(volumeValue) {
            currentVolume = volumeValue / 100;
            gameThemeMusic.volume = currentVolume;
            // Garante que o slider de jogo e start atualizem um ao outro
            volumeSliderStart.value = volumeValue; 
            volumeSliderGame.value = volumeValue;
            
            // Se o volume for ajustado, desmuta automaticamente
            if (currentVolume > 0 && isMuted) {
                isMuted = false;
                gameThemeMusic.muted = false;
            } else if (currentVolume === 0 && !isMuted) {
                isMuted = true; // Se slider for pra 0, considera mutado
                gameThemeMusic.muted = true;
            }
            
            localStorage.setItem('gameVolume', currentVolume);
            localStorage.setItem('isMuted', isMuted);
            updateDisplay();
            
            // Garante que tente tocar se n√£o estiver tocando e houver volume
            if (currentVolume > 0) {
                 hasInteracted = true;
                 checkAndPlayMusic();
            }
        }
        
        // Alterna o estado de mudo
        function toggleMute() {
            isMuted = !isMuted;
            gameThemeMusic.muted = isMuted;
            localStorage.setItem('isMuted', isMuted);
            
            // Se estiver mutado, zera o volume no display, mas mant√©m o 'currentVolume' real
            if (isMuted) {
                volumeSliderStart.value = 0;
                volumeSliderGame.value = 0;
            } else {
                // Ao desmutar, restaura o volume para o valor salvo
                gameThemeMusic.volume = currentVolume;
                volumeSliderStart.value = Math.round(currentVolume * 100);
                volumeSliderGame.value = Math.round(currentVolume * 100);
            }
            
            // *** A√á√ÉO DE CORRE√á√ÉO (√Åudio) ***
            hasInteracted = true;
            checkAndPlayMusic();
            updateDisplay();
        }

        // ====================================================================
        // V. FUN√á√ïES DE SALVAR/CARREGAR (localStorage)
        // ====================================================================
        
        // Salva o Estado do Jogo no Navegador (ATUALIZADO)
        function saveGame() {
            const gameData = {
                heroName: heroName,
                selectedClass: selectedClass,
                level: powerLevel,
                exp: currentExp,
                expRequired: expToNextLevel,
                // REMOVIDO: energy
                gold: gold,
                soul: soul,
                
                // Upgrades/Base Stats
                heroHP: heroBaseHP,
                heroATK: heroBaseATK,
                atkCost: atkUpgradeCost,
                hpCost: hpUpgradeCost,
                
                // Status de Combate
                heroCurrentHP: heroCurrentHP,
                
                // Miss√µes
                dailyStatus: dailyMissionStatus,
                uniqueStatus: uniqueMissionStatus,
                missionCooldowns: missionCooldowns,
                
                // Invent√°rio
                inventory: inventory,
                nextItemId: nextItemId,
                
                // Salva apenas os IDs dos itens equipados, para que a refer√™ncia seja refeita ao carregar
                equipment: {
                    weapon: EQUIPMENT_SLOTS.weapon.currentItem ? EQUIPMENT_SLOTS.weapon.currentItem.id : null,
                    armor: EQUIPMENT_SLOTS.armor.currentItem ? EQUIPMENT_SLOTS.armor.currentItem.id : null,
                }
            };
            localStorage.setItem('gameData', JSON.stringify(gameData));
        }

        // Carrega o Estado do Jogo (ATUALIZADO)
        function loadGame(showAlert = false) {
            const savedData = localStorage.getItem('gameData');
            const savedVolume = localStorage.getItem('gameVolume');
            const savedMuteStatus = localStorage.getItem('isMuted');
            
            // --- CARREGAMENTO DE √ÅUDIO ---
            if (savedVolume !== null) {
                currentVolume = parseFloat(savedVolume);
                gameThemeMusic.volume = currentVolume;
            }
            if (savedMuteStatus !== null) {
                isMuted = savedMuteStatus === 'true'; // localStorage armazena como string
                gameThemeMusic.muted = isMuted;
                if (isMuted) {
                    volumeSliderStart.value = 0;
                    volumeSliderGame.value = 0;
                }
            }
            
            // --- CARREGAMENTO DO JOGO ---
            if (!savedData) {
                if (showAlert) alert("Nenhum jogo salvo encontrado.");
                return; // Volta ao menu inicial se n√£o houver save
            }

            const gameData = JSON.parse(savedData);
            
            // Popula as vari√°veis de estado
            heroName = gameData.heroName || "Her√≥i";
            selectedClass = gameData.selectedClass || null;
            powerLevel = gameData.level || 1;
            currentExp = gameData.exp || 0;
            expToNextLevel = gameData.expRequired || 50;
            gold = gameData.gold || 0;
            soul = gameData.soul || 0;
            
            heroBaseHP = gameData.heroHP || 10;
            heroBaseATK = gameData.heroATK || 1;
            atkUpgradeCost = gameData.atkCost || 50;
            hpUpgradeCost = gameData.hpCost || 50;
            
            heroCurrentHP = gameData.heroCurrentHP || heroBaseHP;
            
            dailyMissionStatus = gameData.dailyStatus || { scouting: { completedAt: 0 }, drills: { completedAt: 0 } };
            uniqueMissionStatus = gameData.uniqueStatus || { firstQuest: { completed: false }, tutorialComplete: { completed: false } };
            missionCooldowns = gameData.missionCooldowns || { workGold: 0 };
            
            inventory = gameData.inventory || [];
            nextItemId = gameData.nextItemId || 1000;
            
            // Popula a estrutura de equipamento (re-linkando itens do invent√°rio)
            if (gameData.equipment) {
                for (const slotKey in gameData.equipment) {
                    if (EQUIPMENT_SLOTS[slotKey]) {
                        const equippedItemId = gameData.equipment[slotKey];
                        
                        if (equippedItemId !== null) {
                            // Procura a refer√™ncia real no novo array 'inventory'
                            const itemReference = inventory.find(item => item.id === equippedItemId);
                            
                            // NOVO: Verifica se o item de save ainda tem a mesma chave de slot
                            if (itemReference && itemReference.type === slotKey) {
                                EQUIPMENT_SLOTS[slotKey].currentItem = itemReference;
                            } else {
                                EQUIPMENT_SLOTS[slotKey].currentItem = null; // console.warn(`Item equipado ID ${equippedItemId} n√£o encontrado ou slot inv√°lido. Desequipado.`);
                            }
                        } else {
                            EQUIPMENT_SLOTS[slotKey].currentItem = null;
                        }
                    }
                }
            } else {
                // Se n√£o houver dados de equipamento (save antigo), zera
                for (const slotKey in EQUIPMENT_SLOTS) {
                    EQUIPMENT_SLOTS[slotKey].currentItem = null;
                }
            }

            // Inicia o jogo e esconde o menu
            startMenu.style.display = 'none';
            startGame();
            if (showAlert) alert("Jogo carregado com sucesso!");
            
            // Tenta tocar a m√∫sica se n√£o estiver mutada (intera√ß√£o de clique)
            hasInteracted = true;
            checkAndPlayMusic();
        }

        // ====================================================================
        // VI. FUN√á√ïES DE PROGRESS√ÉO
        // ====================================================================
        
        // Calcula o EXP necess√°rio para o pr√≥ximo n√≠vel
        function calculateExpRequired(level) {
            return level * 50 + (level - 1) * 10; // Exemplo: Nv1: 50, Nv2: 110, Nv3: 180...
        }

        // Tenta subir de n√≠vel
        function levelUp() {
            while (currentExp >= expToNextLevel) {
                currentExp -= expToNextLevel;
                powerLevel++;
                
                // Aumenta as estat√≠sticas base ao subir de n√≠vel
                heroBaseHP += 5;
                heroBaseATK += 1;
                
                // Recalcula o exp necess√°rio
                expToNextLevel = calculateExpRequired(powerLevel);
                
                alert(`üéâ ${heroName} subiu para o N√≠vel ${powerLevel}! Ganhos: +5 HP Base e +1 ATK Base.`);
            }
            updateEquipmentStats(); // Recalcula stats para o novo n√≠vel
            updateDisplay();
            saveGame();
        }

        // 1. Treinamento
        function trainForStats(type) {
            let expGain = 10; // REMOVIDO: Teste de energia e custo
            currentExp += expGain;
            let message = `${heroName} treinou e ganhou ${expGain} EXP.`;
            
            alert(message);
            levelUp(); // Tenta subir de n√≠vel
            updateDisplay();
            saveGame();
        }

        // 2. Compra upgrades de stats permanentes
        function buyUpgrade(type) {
            if (type === 'atk' && gold >= atkUpgradeCost) {
                gold -= atkUpgradeCost;
                heroBaseATK += 1;
                atkUpgradeCost = Math.round(atkUpgradeCost * 1.5);
                alert(`‚öîÔ∏è Ataque Base (Upgrade) aumentado para ${heroBaseATK}!`);
            } else if (type === 'hp' && gold >= hpUpgradeCost) {
                gold -= hpUpgradeCost;
                heroBaseHP += 10;
                hpUpgradeCost = Math.round(hpUpgradeCost * 1.5);
                alert(`‚ù§Ô∏è HP Base (Upgrade) aumentado para ${heroBaseHP}!`);
            } else {
                alert("Voc√™ n√£o tem Ouro suficiente para este upgrade!");
                return;
            }
            
            updateEquipmentStats(); // Recalcula stats para o novo base
            updateDisplay();
            saveGame();
        }
        
        // 3. In√≠cio de Miss√µes Recorrentes (Cooldowns de Tempo)
        function startMission(missionType, initialDuration = 0) {
            if (missionCooldowns[missionType] > Date.now() && initialDuration === 0) {
                alert("Aguarde o cooldown!");
                return;
            }
            
            let duration = initialDuration > 0 ? initialDuration : 60; // 60s default
            
            // Aplica a recompensa imediatamente
            if (missionType === 'workGold') {
                gold += 20;
                alert(`üí∞ Voc√™ trabalhou e ganhou 20 Ouro!`);
            }
            
            // Define o cooldown
            missionCooldowns[missionType] = Date.now() + (duration * 1000);
            
            updateDisplay();
            saveGame();
        }
        
        // 4. In√≠cio de Miss√µes Di√°rias (Reseta em 24h)
        function startDailyMission(key) {
            const status = dailyMissionStatus[key];
            const now = Date.now();
            
            if (status.completedAt > 0 && (now < status.completedAt + DAILY_COOLDOWN_MS)) {
                alert("Voc√™ j√° completou esta miss√£o hoje! Volte amanh√£.");
                return;
            }
            
            status.completedAt = now; // Marca a conclus√£o
            
            let message = "Miss√£o Di√°ria conclu√≠da!";
            
            if (key === 'scouting') {
                currentExp += 100;
                gold += 50;
                message += " Recompensa: 100 EXP e 50 üí∞!";
            } else if (key === 'drills') {
                currentExp += 200;
                heroBaseATK += 2;
                message += " Recompensa: 200 EXP e +2 ATK base!";
            }
            
            alert(message);
            updateDisplay();
            levelUp();
            saveGame();
        }

        // 5. In√≠cio de Miss√µes √önicas (Desaparecem ap√≥s completar)
        function startUniqueMission(key) {
            const status = uniqueMissionStatus[key];
            
            if (status.completed) {
                return;
            }
            
            status.completed = true;
            
            let message = "Miss√£o √önica conclu√≠da!";
            
            if (key === 'firstQuest') {
                currentExp += 500;
                heroBaseHP += 10;
                heroCurrentHP += 10; // Aumenta o HP atual tamb√©m
                message += " Recompensa: 500 EXP e +10 HP base!";
            } else if (key === 'tutorialComplete') {
                gold += 100;
                // REMOVIDO: energy += 100;
                message += " Recompensa: 100 üí∞!";
            }
            
            alert(message);
            updateDisplay();
            levelUp();
            saveGame();
        }
        
        // ====================================================================
        // VII. FUN√á√ïES DE COMBATE E AVENTURA
        // ====================================================================
        
        // Seleciona um monstro baseado no n√≠vel do her√≥i (ou um n√≠vel pr√≥ximo)
        function selectMonsterByLevel() {
            const monsterLevel = powerLevel;
            const availableMonsters = MONSTERS_BY_LEVEL[monsterLevel] || MONSTERS_BY_LEVEL[1]; // Fallback para N√≠vel 1

            monsterSelectionPanel.innerHTML = '';
            
            availableMonsters.forEach((monsterData, index) => {
                const button = document.createElement('button');
                button.textContent = monsterData.name;
                button.className = 'mission-button monster-select-button';
                button.style.backgroundColor = 'var(--color-secondary)';
                button.style.color = 'var(--color-text)';
                button.style.border = '2px solid var(--color-combat)';
                button.style.padding = '10px';
                button.style.borderRadius = '5px';
                button.style.cursor = 'pointer';
                button.style.minWidth = '150px';
                
                button.onclick = () => {
                    const buttons = monsterSelectionPanel.querySelectorAll('button');
                    buttons.forEach(btn => btn.style.backgroundColor = 'var(--color-secondary)');
                    button.style.backgroundColor = 'rgba(192, 57, 43, 0.5)'; // Marca o selecionado
                    setupMonster(monsterData);
                };
                
                monsterSelectionPanel.appendChild(button);
            });
            
            // Seleciona o primeiro monstro por padr√£o (se houver)
            if (availableMonsters.length > 0 && !currentMonster) {
                setupMonster(availableMonsters[0]);
            } else if (currentMonster) {
                 // Se um monstro j√° estiver setado, garante que o bot√£o dele esteja marcado
                 const selectedButton = monsterSelectionPanel.querySelector(`button:contains("${currentMonster.name}")`);
                 if (selectedButton) {
                      selectedButton.style.backgroundColor = 'rgba(192, 57, 43, 0.5)';
                 }
            }
        }
        
        // Configura o monstro para a batalha
        function setupMonster(monsterData) {
            // Cria uma c√≥pia do objeto para manipula√ß√£o de HP em combate
            currentMonster = {
                ...monsterData,
                currentHP: monsterData.baseHP
            };

            document.getElementById('monster-name').textContent = currentMonster.name;
            document.getElementById('monster-hp-display').textContent = currentMonster.currentHP;
            document.getElementById('monster-reward-exp').textContent = currentMonster.expReward;
            document.getElementById('monster-reward-gold').textContent = currentMonster.goldReward;
            
            // Atualiza o ATK do monstro (se houver)
            document.getElementById('monster-atk-display').textContent = currentMonster.atk;

            // Limpa o log de combate e prepara a interface
            combatLog.innerHTML = `<p>Pronto para a Batalha contra o(a) ${currentMonster.name}.</p>`;
            startBattleButton.textContent = 'Iniciar Batalha!';
            startBattleButton.disabled = false;
        }

        // Fun√ß√£o auxiliar para logar mensagens no log de combate
        function logToCombat(message) {
            const p = document.createElement('p');
            p.innerHTML = message;
            combatLog.appendChild(p);
            combatLog.scrollTop = combatLog.scrollHeight; // Scroll to bottom
        }
        
        // Inicia o processo de batalha
        function startBattle() {
            if (isFighting || !currentMonster) return;
            
            isFighting = true;
            startBattleButton.textContent = 'Batalhando...';
            startBattleButton.disabled = true;
            
            heroCurrentHP = heroTotalHP; // Cura total no in√≠cio da batalha
            currentMonster.currentHP = currentMonster.baseHP; // Reseta o HP do monstro
            
            // 1. Calcula o dano final do her√≥i
            const levelMultiplier = powerLevel;
            const finalHeroDamage = Math.max(1, heroTotalATK * levelMultiplier);
            
            // Limpa Log
            combatLog.innerHTML = `<p style="font-weight: bold;">[Batalha Iniciada contra ${currentMonster.name}]</p>`;
            logToCombat(`<p style="color: var(--color-combat);">Her√≥i se prepara para lutar!</p>`);
            
            // 2. Loop de Turnos (Simula√ß√£o)
            let turn = 1;
            const battleInterval = setInterval(() => {
                
                // Fim da Batalha (Verificado no in√≠cio de cada turno)
                if (currentMonster.currentHP <= 0 || heroCurrentHP <= 0) {
                    clearInterval(battleInterval);
                    endBattle(currentMonster.currentHP <= 0);
                    return;
                }

                // Turno do Her√≥i
                const heroDamage = finalHeroDamage;
                currentMonster.currentHP -= heroDamage;
                logToCombat(`[Turno ${turn}] Her√≥i ataca ${currentMonster.name} causando ${heroDamage} de dano! (HP Monstro: ${Math.max(0, currentMonster.currentHP)})`);
                
                // Turno do Monstro (se ainda estiver vivo)
                if (currentMonster.currentHP > 0) {
                    const monsterDamage = currentMonster.atk;
                    heroCurrentHP -= monsterDamage;
                    logToCombat(`<span style="color: var(--color-combat);"> ${currentMonster.name} contra-ataca causando ${monsterDamage} de dano! (HP Her√≥i: ${Math.max(0, heroCurrentHP)})</span>`);
                }
                
                turn++;
                updateDisplay(); // Atualiza os displays de HP
            }, 1000); // Um turno a cada 1 segundo
        }

        // Finaliza a batalha
        function endBattle(isVictory) {
            isFighting = false;
            startBattleButton.textContent = 'Iniciar Batalha!';
            
            if (isVictory) {
                // Vit√≥ria!
                const expGain = currentMonster.expReward;
                const goldGain = currentMonster.goldReward;
                currentExp += expGain;
                gold += goldGain;
                
                logToCombat(`<p style="color: var(--color-hp); font-weight: bold;">[VIT√ìRIA!] ${currentMonster.name} derrotado!</p>`);
                logToCombat(`Recompensa: ${expGain} EXP e ${goldGain} üí∞!`);
                
            } else {
                // Derrota (HP = 0)
                logToCombat(`<p style="color: var(--color-combat); font-weight: bold;">[DERROTA!] Her√≥i caiu!</p>`);
                logToCombat(`Voc√™ perde a recompensa. Recupere-se e tente novamente.`);
                heroCurrentHP = 1; // Deixa 1 de HP para n√£o ser 0
            }
            
            levelUp();
            updateDisplay();
            saveGame();
            
            // Permite que o bot√£o de batalha esteja no estado correto
            startBattleButton.disabled = isFighting; // Apenas se estiver lutando
        }

        // ====================================================================
        // VIII. FUN√á√ïES DE EQUIPAMENTO E INVENT√ÅRIO
        // ====================================================================
        
        // 1. Renderiza os slots de equipamento
        function renderEquipment() {
            equipmentPanel.innerHTML = ''; // Limpa o painel
            
            for (const key in EQUIPMENT_SLOTS) {
                const slot = EQUIPMENT_SLOTS[key];
                const item = slot.currentItem;
                
                const slotDiv = document.createElement('div');
                slotDiv.className = 'slot-container';
                
                const labelSpan = document.createElement('span');
                labelSpan.className = 'slot-label';
                labelSpan.textContent = slot.name + ':';
                
                const itemDisplay = document.createElement('div');
                itemDisplay.className = 'equipped-item-display';

                if (item) {
                    let statText = '';
                    // Combina todos os b√¥nus para exibi√ß√£o
                    const bonuses = [];
                    if (item.atk) bonuses.push(`+${item.atk} ATK`);
                    if (item.hpBonus) bonuses.push(`+${item.hpBonus} HP`);
                    statText = bonuses.join(' | ');
                    
                    itemDisplay.innerHTML = `<span style="font-weight: bold;">${item.name}</span> <span style="font-size: 0.8em; color: var(--color-hp);">(${statText})</span>`;
                    itemDisplay.title = item.description;
                    
                    // Adiciona um listener para desequipar clicando no item equipado
                    itemDisplay.style.cursor = 'pointer';
                    itemDisplay.onclick = () => {
                         // Passa a refer√™ncia real do item
                        unequipItem(item); 
                    }; 
                } else {
                    itemDisplay.innerHTML = `<span class="empty-slot">Vazio</span>`;
                }
                
                slotDiv.appendChild(labelSpan);
                slotDiv.appendChild(itemDisplay);
                equipmentPanel.appendChild(slotDiv);
            }
            
            updateEquipmentStats();
        }
        
        // 2. Calcula e atualiza as estat√≠sticas totais (Base + Equipamento)
        function updateEquipmentStats() {
            let totalAtkBonus = 0;
            let totalHpBonus = 0;
            
            for (const key in EQUIPMENT_SLOTS) {
                const item = EQUIPMENT_SLOTS[key].currentItem;
                if (item) {
                    totalAtkBonus += item.atk || 0;
                    totalHpBonus += item.hpBonus || 0;
                }
            }
            
            // Atualiza as vari√°veis de estado
            heroTotalATK = heroBaseATK + totalAtkBonus;
            heroTotalHP = heroBaseHP + totalHpBonus;
            
            // Atualiza os displays
            document.getElementById('eq-base-hp').textContent = heroBaseHP;
            document.getElementById('eq-bonus-hp').textContent = totalHpBonus;
            document.getElementById('eq-max-hp').textContent = heroTotalHP;

            document.getElementById('eq-base-atk').textContent = heroBaseATK;
            document.getElementById('eq-bonus-atk').textContent = totalAtkBonus;
            document.getElementById('eq-total-atk').textContent = heroTotalATK;
            
            // Garante que o HP atual n√£o exceda o HP m√°ximo
            heroCurrentHP = Math.min(heroCurrentHP, heroTotalHP);
            
            updateDisplay();
        }

        // 3. Renderiza os itens no invent√°rio
        function renderInventory() {
            inventoryPanel.innerHTML = '';
            
            // Marca quais itens est√£o equipados
            const equippedIds = Object.values(EQUIPMENT_SLOTS)
                .map(slot => slot.currentItem ? slot.currentItem.id : null)
                .filter(id => id !== null);
                
            inventory.forEach(item => {
                const card = document.createElement('div');
                card.className = 'item-card';
                card.setAttribute('data-item-id', item.id);
                
                if (equippedIds.includes(item.id)) {
                    card.classList.add('equipped');
                }

                card.innerHTML = `
                    <p style="font-weight: bold;">${item.name}</p>
                    <p>Tipo: ${EQUIPMENT_SLOTS[item.type] ? EQUIPMENT_SLOTS[item.type].name : item.type}</p>
                    <p style="color: var(--color-accent); font-size: 0.8em;">${item.rarity}</p>
                `;
                card.onclick = () => inspectItem(item);
                inventoryPanel.appendChild(card);
            });
            
            // Se o invent√°rio estiver vazio, mostra uma mensagem
            if (inventory.length === 0) {
                inventoryPanel.innerHTML = `<p style="font-style: italic; color: #7f8c8d; text-align: center; grid-column: 1 / -1;">Seu invent√°rio est√° vazio.</p>`;
            }
        }
        
        // 4. Inspeciona e mostra detalhes de um item
        function inspectItem(item) {
            inspectedItem = item;
            
            let stats = '';
            if (item.atk) stats += `<p>‚öîÔ∏è ATK: +${item.atk}</p>`;
            if (item.hpBonus) stats += `<p>‚ù§Ô∏è HP B√¥nus: +${item.hpBonus}</p>`;
            
            let isEquipped = false;
            if (EQUIPMENT_SLOTS[item.type] && EQUIPMENT_SLOTS[item.type].currentItem && EQUIPMENT_SLOTS[item.type].currentItem.id === item.id) {
                isEquipped = true;
            }

            let buttonHTML = '';
            if (isEquipped) {
                 buttonHTML = `<button onclick="unequipItem(inspectedItem)" style="background-color: var(--color-combat);
                 color: white; padding: 10px; border: none; border-radius: 5px; margin-top: 10px;
                 width: 100%;">DESEQUIPAR</button>`;
            } else {
                 buttonHTML = `<button onclick="equipItem(inspectedItem)" style="background-color: var(--color-hp);
                 color: white; padding: 10px; border: none; border-radius: 5px; margin-top: 10px;
                 width: 100%;">EQUIPAR</button>`;
            }
            
            inspectionArea.innerHTML = `
                <h4>${item.name}</h4>
                <p><strong>Tipo:</strong> ${EQUIPMENT_SLOTS[item.type] ? EQUIPMENT_SLOTS[item.type].name : item.type}</p>
                <p><strong>Raridade:</strong> <span style="color: var(--color-accent);">${item.rarity}</span></p>
                <hr>
                ${stats}
                <p style="font-style: italic; font-size: 0.9em;">"${item.description || 'Sem descri√ß√£o.'}"</p>
                ${buttonHTML}
            `;
            
             // Garante que o item inspecionado esteja marcado no invent√°rio (opcional)
             // Nota: A renderInventory j√° cuida de marcar o equipado.
        }

        // 5. Equipa um item
        function equipItem(item, showAlert = true) {
            const slotKey = item.type;
            
            if (!EQUIPMENT_SLOTS[slotKey]) {
                if (showAlert) alert(`Tipo de item inv√°lido para equipamento: ${item.type}`);
                return;
            }
            
            // Se o item est√° sendo equipado, ent√£o ele substitui o item atual no slot
            EQUIPMENT_SLOTS[slotKey].currentItem = item;
            
            // Atualiza todos os pain√©is
            renderEquipment();
            renderInventory();
            updateEquipmentStats(); // Recalcula stats
            if (showAlert) inspectItem(item); // Reinspeciona para mostrar "DESEQUIPAR"
            saveGame();
            if (showAlert) alert(`${item.name} equipado no slot de ${EQUIPMENT_SLOTS[slotKey].name}.`);
        }
        
        // 6. Desequipa o item
        function unequipItem(item) {
            const slotKey = item.type;
            
            if (EQUIPMENT_SLOTS[slotKey].currentItem && EQUIPMENT_SLOTS[slotKey].currentItem.id === item.id) {
                 EQUIPMENT_SLOTS[slotKey].currentItem = null;
                 alert(`${item.name} desequipado.`);
            }
            
            // Atualiza todos os pain√©is
            renderEquipment();
            renderInventory();
            updateEquipmentStats(); // Recalcula stats
            // Reinspeciona para atualizar o bot√£o para "EQUIPAR"
            if (inspectedItem) {
                inspectItem(inspectedItem); 
            }
            saveGame();
        }


        // ====================================================================
        // IX. INICIALIZA√á√ÉO
        // ====================================================================

        // Tenta carregar o jogo salvo ao iniciar a p√°gina. 
        loadGame();
        
    </script>

</body>
</html>
