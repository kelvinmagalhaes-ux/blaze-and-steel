<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BLAZE AND STEEL</title>
    <style>
        /* Vari√°veis de Cores (CSS Custom Properties) */
        :root {
            --color-primary: #1e1e2d;
            --color-secondary: #36364f;
            --color-text: #e0e0e0;
            --color-accent: #f39c12; /* Ouro */
            --color-combat: #c0392b; /* Combate/Aventura */
            --color-evolve: #8e44ad; /* Evoluir/Treinamento */
            --color-energy: #3498db; /* Energia */
            --color-soul: #9b59b6; /* Alma/Reencarna√ß√£o */
            --color-hp: #2ecc71; /* HP/Vida */
            --color-locked: #555; /* Cor para elementos bloqueados */
            --color-unlocked: #2ecc71; /* Cor para elementos desbloqueados */
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--color-primary);
            color: var(--color-text);
            margin: 0;
            display: flex;
            min-height: 100vh;
            overflow: hidden; 
        }

        /* Estrutura Geral */
        #app-wrapper {
            display: flex;
            width: 100%;
        }

        /* Sidebar (Menu Lateral) */
        #sidebar {
            width: 200px;
            background-color: var(--color-secondary);
            padding: 20px 0;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.5);
            display: none; 
            flex-shrink: 0; 
        }

        .sidebar-menu button {
            display: block;
            width: 100%;
            padding: 15px 20px;
            text-align: left;
            background: none;
            border: none;
            color: var(--color-text);
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
            display: flex; 
            align-items: center;
        }

        .sidebar-menu button:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .sidebar-menu button.active {
            background-color: var(--color-evolve);
            font-weight: bold;
            color: white; 
        }
        
        .sidebar-menu button::before {
            content: ''; 
            margin-right: 10px;
            font-size: 1.2em;
            width: 25px; 
            text-align: center;
        }
        
        /* Defini√ß√£o de √çcones */
        #btn-training::before { content: 'üè†'; color: var(--color-evolve); } 
        #btn-adventure::before { content: 'üó∫Ô∏è'; color: var(--color-combat); } 
        #btn-upgrades::before { content: '‚è´'; color: var(--color-accent); } 
        #btn-equipment::before { content: '‚öîÔ∏è'; color: var(--color-energy); } 
        #btn-inventory::before { content: 'üì¶'; color: var(--color-hp); } 
        #btn-status::before { content: 'üë§'; color: var(--color-soul); } 
        #btn-expedition::before { content: 'üß≠'; color: #f1c40f; } 


        /* √Årea de Conte√∫do Principal */
        #main-content {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            max-height: 100vh;
            display: none; 
            position: relative; 
        }
        
        /* Bot√£o de √Åudio (Dentro do Jogo) */
        #audio-control-button {
            background-color: var(--color-secondary);
            border: 1px solid var(--color-accent);
            color: var(--color-text);
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            z-index: 10;
        }

        /* Pain√©is de Conte√∫do (Geral) */
        .content-panel {
            background-color: var(--color-secondary);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        /* Menu Inicial (Start Menu) */
        #start-menu {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100vh;
            position: fixed; 
            top: 0;
            left: 0;
            background-color: var(--color-primary);
            z-index: 100;
        }
        
        .game-logo {
            max-width: 90%;
            width: 500px;
            height: auto;
            margin-bottom: 50px;
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
        }

        .menu-button-stack button {
            display: block;
            width: 300px;
            padding: 15px 20px;
            margin: 10px 0;
            border: 2px solid var(--color-accent);
            border-radius: 5px;
            background-color: var(--color-combat);
            color: var(--color-text);
            font-size: 1.2em;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            box-shadow: 0 4px var(--color-accent);
        }

        .menu-button-stack button:hover {
            background-color: #e74c3c;
            transform: translateY(-2px);
            box-shadow: 0 6px var(--color-accent);
        }

        .menu-button-stack button:active {
            transform: translateY(2px);
            box-shadow: 0 2px var(--color-accent);
        }
        
        /* Estilo para o Slider de Volume */
        .volume-control-container {
            margin-top: 20px;
            padding: 10px;
            background-color: var(--color-secondary);
            border-radius: 5px;
            width: 300px;
            text-align: center;
        }

        .volume-control-container label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        /* Ajuste a posi√ß√£o do controle de volume para o menu inicial */
        #start-menu .volume-control-container {
            position: absolute;
            bottom: 33px; 
            left: 50%;
            transform: translateX(-50%);
            width: 90%; 
            max-width: 300px;
        }


        /* Painel de Cria√ß√£o de Personagem - ESTILO ISOLADO */
        #character-creation-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--color-primary);
            z-index: 99;
            display: none; /* Inicia Oculto */
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
            box-sizing: border-box;
        }

        #character-creation-panel .content-panel {
            max-width: 600px;
            margin: auto;
            padding: 30px;
            border: 2px solid var(--color-accent);
        }
        
        /* Header e Display de Recursos */
        #header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px 20px 0;
            border-bottom: 1px solid var(--color-secondary);
            margin-bottom: 20px;
        }

        .resource-display {
            display: flex;
            gap: 15px;
        }

        .resource-item {
            font-size: 1.1em;
            font-weight: bold;
        }

        .resource-item span {
            margin-left: 5px;
        }
        
        /* Bot√µes de A√ß√£o (Geral) */
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Estilo do Bot√£o Level Up */
        #hero-training-panel button#level-up-button {
            background-color: var(--color-evolve);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            margin-top: 10px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        #hero-training-panel button#level-up-button:hover:not(:disabled) {
            background-color: #6c3483;
        }
        
        /* Estilo para o logo ADVENTURE */
        #adventure-title-logo {
            display: block;
            margin: 0 auto 20px auto;
            max-width: 300px; 
            height: auto;
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
        }

        /* Estilo para os bot√µes de sele√ß√£o de classe */
        #class-selection-container {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        #class-selection-container button {
            background-color: var(--color-secondary); 
            color: var(--color-text); 
            border: 2px solid var(--color-primary); 
            padding: 10px 15px; 
            border-radius: 5px; 
            cursor: pointer;
            width: 150px;
            height: 150px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: border-color 0.2s, background-color 0.2s;
        }
        
        #class-selection-container button img {
            max-width: 80px; 
            max-height: 80px; 
            margin-bottom: 5px;
            border-radius: 5px;
            background-color: #34495e; /* Placeholder */
            width: 80px;
            height: 80px;
            object-fit: cover;
        }
        
        #class-selection-container button:hover {
            border-color: var(--color-energy);
        }
        
        /* Estilos dos Slots de Equipamento */
        .equipment-slot {
            padding: 10px;
            border: 1px solid var(--color-primary);
            border-radius: 5px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .equipment-slot span.item-name {
            font-weight: bold;
            color: var(--color-accent);
        }
        
        /* Estilos do Invent√°rio */
        #inventory-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .inventory-item-card {
            background-color: var(--color-primary);
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
            border: 1px solid transparent;
        }

        .inventory-item-card.selected {
            border-color: var(--color-energy);
            background-color: rgba(52, 152, 219, 0.1);
        }
        
        .item-rarity-common { color: #aaa; }
        .item-rarity-uncommon { color: var(--color-unlocked); }
        .item-rarity-rare { color: var(--color-energy); }
        .item-rarity-epic { color: var(--color-evolve); }
        .item-rarity-legendary { color: var(--color-accent); }

        /* -------------------------------------- */
        /* NOVO CSS: MAPA DE AVENTURA */
        /* -------------------------------------- */
        #adventure-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        #map-and-combat-area {
            display: flex;
            gap: 20px;
            flex-wrap: wrap; 
        }

        #adventure-map-container {
            width: 100%; 
            max-width: 600px; 
            min-height: 400px;
            background-color: #2c3e50;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            padding: 15px;
        }

        #region-selection-area {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .region-card {
            background-color: var(--color-primary);
            padding: 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.1s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .region-card:hover:not(.locked) {
            transform: translateY(-2px);
            box-shadow: 0 4px var(--color-accent);
        }

        .region-card .status {
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 3px;
        }

        .region-card.locked {
            opacity: 0.6;
            cursor: not-allowed;
            border-left: 4px solid var(--color-locked);
        }

        .region-card.locked .status {
            background-color: var(--color-locked);
            color: #ccc;
        }

        .region-card.unlocked {
            border-left: 4px solid var(--color-unlocked);
        }

        .region-card.unlocked .status {
            background-color: var(--color-unlocked);
            color: var(--color-primary);
        }

        .region-info h4 {
            margin: 0 0 5px 0;
            color: var(--color-accent);
        }
        
        /* Estilos do Log de Combate e Sele√ß√£o de Monstro */
        #combat-interface {
            flex-grow: 1;
            min-width: 300px;
        }

        #monster-selection button {
            display: block;
            width: 100%;
            padding: 10px;
            margin-bottom: 5px;
            background-color: var(--color-combat);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        #monster-selection button:hover {
            background-color: #e74c3c;
        }

        #combat-log {
            min-height: 150px;
            max-height: 300px;
            overflow-y: auto;
            background-color: var(--color-primary);
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-family: monospace;
            white-space: pre-wrap;
        }


    </style>
</head>
<body>

    <audio id="background-music" loop src=""></audio>
    
    <div id="start-menu" style="display: flex;">
        <img src="blaze-and-steel.png.png" alt="Blaze and Steel Logo" class="game-logo">
        <div class="menu-button-stack">
            <button id="btn-new-game">NOVO JOGO</button>
            <button id="btn-load-game">CARREGAR JOGO</button>
            <button id="btn-exit-game">SAIR</button>
        </div>
        <div id="start-menu-volume" class="volume-control-container">
            <label for="start-volume-slider">Volume da M√∫sica:</label>
            <input type="range" id="start-volume-slider" min="0" max="1" step="0.05" value="0.5">
        </div>
    </div>

    <div id="character-creation-panel" style="display: none;">
        <div class="content-panel">
            <h2>Crie Seu Her√≥i!</h2>
            <p>Escolha um nome e uma classe para come√ßar sua aventura.</p>
            
            <label for="hero-name">Nome do Her√≥i:</label>
            <input type="text" id="hero-name" placeholder="Ex: Her√≥i Blaze" style="width: 100%; padding: 10px; margin-bottom: 20px; box-sizing: border-box; background-color: var(--color-primary); color: var(--color-text); border: 1px solid var(--color-accent);">
            
            <h3>Selecione Sua Classe:</h3>
            <div id="class-selection-container">
                </div>

            <button id="btn-confirm-creation" disabled style="width: 100%; padding: 15px; margin-top: 30px; background-color: var(--color-evolve); color: white; border: none; border-radius: 5px; font-size: 1.1em; cursor: pointer;">CONFIRMAR CRIA√á√ÉO</button>
        </div>
    </div>

    <div id="app-wrapper" style="display: none;">
        
        <div id="sidebar">
            <div id="hero-info" style="padding: 0 20px 20px 20px; border-bottom: 1px solid var(--color-primary); margin-bottom: 10px;">
                <h3 id="hero-display-name">Her√≥i CLT</h3>
                <p>N√≠vel: <span id="hero-display-level">1</span></p>
            </div>
            <div class="sidebar-menu">
                <button id="btn-training" data-panel="hero-training-panel" class="active">Quartel-General</button>
                <button id="btn-adventure" data-panel="adventure-panel">Aventura</button>
                <button id="btn-upgrades" data-panel="upgrades-panel">Upgrades</button>
                <button id="btn-equipment" data-panel="equipment-panel">Equipamento</button>
                <button id="btn-inventory" data-panel="inventory-panel">Invent√°rio</button>
                <button id="btn-status" data-panel="status-panel">Status</button>
                <button id="btn-expedition" data-panel="expedition-panel">Expedi√ß√£o</button>
            </div>
        </div>
        
        <div id="main-content">
            
            <div id="header">
                <h2 id="current-panel-title">Quartel-General</h2>
                <div class="resource-display">
                    <div class="resource-item" style="color: var(--color-energy);">‚ö° Energia: <span id="resource-energy">150</span></div>
                    <div class="resource-item" style="color: var(--color-accent);">üí∞ Ouro: <span id="resource-gold">0</span></div>
                    <div class="resource-item" style="color: var(--color-soul);">üîÆ Alma: <span id="resource-soul">0</span></div>
                    <button id="audio-control-button">üîä</button>
                </div>
            </div>

            <div id="hero-training-panel" class="content-panel" style="display: block;">
                
                <h3>Obten√ß√£o de Recursos (Prepara√ß√£o)</h3>
                <p>Miss√µes de tempo para gerar recursos:</p>
                
                <div id="preparation-actions" style="display: flex; gap: 10px;">
                    <button id="action-study" data-action="study" style="background-color: var(--color-energy); color: white; border: none; padding: 10px 15px; border-radius: 5px;">
                        Estudo de Magia (Custo: 5 ‚ö° | Ganho: 50 üí∞)
                    </button>
                    <button id="action-blacksmith" data-action="blacksmith" style="background-color: var(--color-accent); color: var(--color-primary); border: none; padding: 10px 15px; border-radius: 5px;">
                        Trabalho no Ferreiro (+10 üî® | Vender Recurso -50 üí∞ | +15 ‚ö°)
                    </button>
                </div>
                <div id="preparation-cooldowns" style="margin-top: 15px; display: flex; gap: 10px;">
                    </div>

                <h3 style="margin-top: 30px;">Treinamento & Progresso</h3>
                <p>Gaste Energia para aumentar sua EXP e preparo.</p>
                <div id="training-actions" style="display: flex; gap: 10px;">
                    <button id="action-tactic" data-action="tactic" style="background-color: var(--color-combat); color: white; border: none; padding: 10px 15px; border-radius: 5px;">
                        Estudar T√°ticas (Custo: 25 ‚ö° | Ganho: 10 EXP)
                    </button>
                    <button id="action-defense" data-action="defense" style="background-color: var(--color-hp); color: white; border: none; padding: 10px 15px; border-radius: 5px;">
                        Preparar Defesas (Custo: 25 ‚ö° | Ganho: 10 EXP)
                    </button>
                </div>
                
                <p style="margin-top: 15px;">
                    <span style="color: var(--color-accent);">üåü N√≠vel de Poder:</span> <span id="hero-level">1</span><br>
                    <span style="color: var(--color-energy);">‚ú® EXP:</span> <span id="hero-exp">0</span> / <span id="exp-to-next-level">50</span>
                </p>
                <button id="level-up-button" disabled>SUBIR DE N√çVEL (Falta: 50 EXP)</button>

                <h3 style="margin-top: 30px;">Evolu√ß√£o & Reencarna√ß√£o</h3>
                <p>Suba de n√≠vel e recomece mais forte!</p>
                <button id="evolve-button" style="background-color: var(--color-evolve); color: white; border: none; padding: 10px 15px; border-radius: 5px; margin-right: 10px;">EVOLUIR (Custo: 100 üí∞)</button>
                <button id="reincarnate-button" style="background-color: var(--color-soul); color: white; border: none; padding: 10px 15px; border-radius: 5px;">REENCARNAR (Custo: 500 üîÆ)</button>

                <h3 style="margin-top: 30px;">Miss√µes Especiais</h3>
                <p>Progresso r√°pido e recompensas raras!</p>
                <h4 style="color: var(--color-energy);">Di√°rias (Reseta em 24h)</h4>
                <div id="daily-missions" style="margin-bottom: 15px;">
                    <button data-mission="daily-training" style="background-color: #2c3e50; color: var(--color-text); border: none; padding: 10px 15px; border-radius: 5px;">
                        Exerc√≠cios de Treinamento (Recompensa: 200 EXP | +2 ATK B√¥nus!)
                    </button>
                </div>
                <h4 style="color: var(--color-accent);">√önicas (Desaparecem ap√≥s concluir)</h4>
                <div id="unique-missions">
                    <button data-mission="tutorial-hp" style="background-color: #2c3e50; color: var(--color-text); border: none; padding: 10px 15px; border-radius: 5px; margin-right: 10px;">
                        Provar o Valor (Recompensa: 500 EXP | +10 HP B√¥nus!)
                    </button>
                    <button data-mission="tutorial-gold" style="background-color: #2c3e50; color: var(--color-text); border: none; padding: 10px 15px; border-radius: 5px;">
                        Finalizar Tutorial B√°sico (Recompensa: 100 üí∞ | 100 ‚ö°)
                    </button>
                </div>

            </div>
            
            <div id="adventure-panel" class="content-panel" style="display: none;">
                <img src="adventure.png" alt="ADVENTURE" id="adventure-title-logo">

                <div id="map-and-combat-area">
                    
                    <div id="adventure-map-container" class="content-panel">
                        <h3 style="border-bottom: 1px solid var(--color-primary); padding-bottom: 10px;">Selecione sua Regi√£o de Aventura</h3>
                        <div id="region-selection-area">
                            </div>
                    </div>

                    <div id="combat-interface" class="content-panel">
                        <h3><span id="combat-region-name">Nenhuma Regi√£o Selecionada</span></h3>

                        <p>Selecione um monstro para iniciar o combate:</p>
                        <div id="monster-selection" style="margin-bottom: 20px;">
                            <p style="color: var(--color-locked);">Selecione uma regi√£o no mapa para ver os monstros dispon√≠veis.</p>
                            </div>

                        <h4>üìú Log de Combate</h4>
                        <div id="combat-log">
                            A batalha come√ßar√° aqui. Selecione um monstro.
                        </div>

                    </div>
                </div>

            </div>
            
            <div id="upgrades-panel" class="content-panel" style="display: none;">
                <h2>‚è´ Upgrades</h2>
                <p>Aqui voc√™ poder√° gastar seus recursos (Ouro/Alma) para aprimorar permanentemente suas estat√≠sticas.</p>
            </div>

            <div id="equipment-panel" class="content-panel" style="display: none;">
                <h2>‚öîÔ∏è Equipamento & Estat√≠sticas</h2>
                
                <div style="display: flex; gap: 30px;">
                    
                    <div style="flex: 1;">
                        <h3 style="border-bottom: 1px solid var(--color-primary); padding-bottom: 10px;">Slots de Equipamento</h3>
                        <div class="equipment-slot">
                            <span>Arma:</span> <span id="slot-weapon" class="item-name">Vazio</span>
                        </div>
                        <div class="equipment-slot">
                            <span>Armadura:</span> <span id="slot-armor" class="item-name">Vazio</span>
                        </div>
                        <div class="equipment-slot">
                            <span>Acess√≥rio:</span> <span id="slot-accessory" class="item-name">Vazio</span>
                        </div>
                    </div>
                    
                    <div style="flex: 1;">
                        <h3 style="border-bottom: 1px solid var(--color-primary); padding-bottom: 10px;">Estat√≠sticas Totais</h3>
                        <p>‚ù§Ô∏è HP M√°ximo: <span id="stat-max-hp">10</span> (Base: <span id="stat-base-hp">8</span> + B√¥nus: <span id="stat-bonus-hp">2</span>)</p>
                        <p>‚öîÔ∏è ATK Total: <span id="stat-total-atk">1</span> (Base: <span id="stat-base-atk">1</span> + B√¥nus: <span id="stat-bonus-atk">0</span>)</p>
                        <p>‚ö° Energia M√°xima: <span id="stat-max-energy">150</span> (Base: <span id="stat-base-energy">100</span> + B√¥nus: <span id="stat-bonus-energy">50</span>)</p>
                    </div>

                </div>
            </div>

            <div id="inventory-panel" class="content-panel" style="display: none;">
                <h2>üì¶ Invent√°rio</h2>
                <p>Seus itens e recursos. Clique em um item para inspecionar e equipar/usar.</p>
                
                <div id="inventory-items">
                    </div>

                <h3 style="margin-top: 30px;">Detalhes do Item: <span id="item-detail-name">Nenhum</span></h3>
                <div id="item-detail-panel" class="content-panel" style="background-color: var(--color-primary); padding: 15px;">
                    <p>Tipo: <span id="item-detail-type">?</span> | Raridade: <span id="item-detail-rarity" class="item-rarity-common">?</span></p>
                    <p>Descri√ß√£o: <span id="item-detail-desc">Selecione um item para ver os detalhes.</span></p>
                    <p id="item-detail-effects"></p>
                    <button id="btn-equip-item" style="background-color: var(--color-unlocked); color: var(--color-primary); border: none; padding: 8px 15px; border-radius: 5px; margin-top: 10px; display: none;">EQUIPAR</button>
                    <button id="btn-unequip-item" style="background-color: var(--color-combat); color: white; border: none; padding: 8px 15px; border-radius: 5px; margin-top: 10px; display: none;">DESEQUIPAR</button>
                </div>
            </div>
            
            <div id="status-panel" class="content-panel" style="display: none;">
                <h2>üë§ Status</h2>
                <p>Veja seu hist√≥rico, t√≠tulos e conquistas.</p>
            </div>
            
            <div id="expedition-panel" class="content-panel" style="display: none;">
                <h2>üß≠ Expedi√ß√£o</h2>
                <p>Envie companheiros para miss√µes autom√°ticas em troca de grandes recompensas.</p>
            </div>

        </div>
    </div>


    <script>
        // ------------------------------------------------------------
        // I. ESTRUTURA DE DADOS DO JOGO (GAME STATE)
        // ------------------------------------------------------------
        let gameState = {
            isGameStarted: false,
            isCharacterCreated: false,
            hero: {
                name: "Her√≥i CLT",
                class: "Guerreiro",
                level: 1,
                exp: 0,
                baseStats: {
                    hp: 8,
                    atk: 1,
                    energy: 100,
                },
                levelUpPoints: 0,
                resources: {
                    gold: 0,
                    energy: 150, // Come√ßa com energia para gastar
                    soul: 0,
                },
                equipment: {
                    weapon: null,
                    armor: null,
                    accessory: null,
                },
                inventory: [
                    // Exemplo de itens iniciais
                    { id: 'w1', name: 'Cajado de Madeira', type: 'weapon', rarity: 'common', equipped: true, stats: { atk: 1 }, desc: 'Um cajado simples.' },
                    { id: 'a1', name: 'Manto de Pano', type: 'armor', rarity: 'common', equipped: true, stats: { hp: 5 }, desc: 'Roupas leves que n√£o atrapalham o movimento.' },
                ],
                missions: {
                    dailyTraining: { completed: false, cooldown: 0, rewardExp: 200, rewardBonusAtk: 2 },
                    tutorialGold: { completed: false, rewardGold: 100, rewardEnergy: 100 },
                    tutorialHp: { completed: false, rewardExp: 500, rewardBonusHp: 10 },
                },
                preparation: {
                    study: { inProgress: false, cooldown: 0, duration: 60, costEnergy: 5, rewardGold: 50 },
                    blacksmith: { inProgress: false, cooldown: 0, duration: 30, rewardResource: 10, costGold: 50, rewardEnergy: 15 },
                }
            },
            currentPanel: 'hero-training-panel',
        };

        const CLASSES = {
            guerreiro: { name: "Guerreiro", icon: "img/icon-warrior.png", description: "Focado em for√ßa e defesa.", baseStats: { hp: 10, atk: 2, energy: 80 } },
            mago: { name: "Mago", icon: "img/icon-mage.png", description: "Especialista em magias.", baseStats: { hp: 7, atk: 1, energy: 120 } },
            arqueiro: { name: "Arqueiro", icon: "img/icon-archer.png", description: "√Ågil e preciso.", baseStats: { hp: 8, atk: 3, energy: 90 } },
            lutador: { name: "Lutador", icon: "img/icon-fighter.png", description: "Batalhador corpo-a-corpo.", baseStats: { hp: 12, atk: 2, energy: 70 } }
        };

        const EXP_BASE = 50;
        const EXP_MULTIPLIER = 1.5;

        // ------------------------------------------------------------
        // II. DADOS DO MAPA DE AVENTURA
        // ------------------------------------------------------------
        const MAP_REGIONS = {
            'floresta-iniciante': {
                name: 'Floresta do Despertar',
                levelRange: 'N√≠vel 1 - 10',
                minLevel: 1,
                maxLevel: 10,
                monsters: [
                    { name: 'Slime Verde', hp: 5, atk: 1, exp: 5, gold: 1 },
                    { name: 'Lobo Jovem', hp: 8, atk: 2, exp: 8, gold: 2 }
                ]
            },
            'planicie-veterana': {
                name: 'Plan√≠cies da Coragem',
                levelRange: 'N√≠vel 11 - 25',
                minLevel: 11,
                maxLevel: 25,
                monsters: [
                    { name: 'Bandido Armado', hp: 20, atk: 5, exp: 20, gold: 5 },
                    { name: 'Grifo Selvagem', hp: 35, atk: 8, exp: 35, gold: 8 }
                ]
            },
            'montanha-dos-reis': {
                name: 'Montanha dos Reis',
                levelRange: 'N√≠vel 26 +',
                minLevel: 26,
                maxLevel: 99,
                monsters: [
                    { name: 'Troll de Pedra', hp: 80, atk: 15, exp: 50, gold: 15 }
                ]
            },
            'caverna-final': {
                name: 'Caverna do Chefe Final',
                levelRange: 'N√≠vel 50 +',
                minLevel: 50,
                maxLevel: 99,
                monsters: [
                    { name: 'DRAG√ÉO DE A√áO', hp: 500, atk: 50, exp: 500, gold: 100 }
                ]
            }
        };


        // ------------------------------------------------------------
        // III. FUN√á√ïES DE C√ÅLCULO DE ESTAT√çSTICAS
        // ------------------------------------------------------------
        function calculateStats() {
            const hero = gameState.hero;
            let baseHp = hero.baseStats.hp;
            let baseAtk = hero.baseStats.atk;
            let baseEnergy = hero.baseStats.energy;

            let bonusHp = hero.missions.tutorialHp.completed ? 10 : 0;
            let bonusAtk = hero.missions.dailyTraining.completed ? 2 : 0;
            let bonusEnergy = 50; // B√¥nus base inicial

            // B√¥nus de Equipamento
            for (const slot in hero.equipment) {
                const itemId = hero.equipment[slot];
                if (itemId) {
                    const item = hero.inventory.find(i => i.id === itemId);
                    if (item && item.stats) {
                        bonusHp += item.stats.hp || 0;
                        bonusAtk += item.stats.atk || 0;
                        bonusEnergy += item.stats.energy || 0;
                    }
                }
            }

            // Estat√≠sticas Totais
            const totalHp = baseHp + bonusHp;
            const totalAtk = baseAtk + bonusAtk;
            const totalEnergy = baseEnergy + bonusEnergy;
            
            return {
                baseHp, totalHp, bonusHp,
                baseAtk, totalAtk, bonusAtk,
                baseEnergy, totalEnergy, bonusEnergy,
            };
        }

        function getExpRequired(level) {
            if (level <= 1) return EXP_BASE;
            return Math.ceil(EXP_BASE * Math.pow(EXP_MULTIPLIER, level - 1));
        }

        // ------------------------------------------------------------
        // IV. FUN√á√ïES DE RENDERIZA√á√ÉO E ATUALIZA√á√ÉO DA INTERFACE
        // ------------------------------------------------------------
        
        function updateHeroDisplay() {
            const hero = gameState.hero;
            const expToNext = getExpRequired(hero.level);

            document.getElementById('hero-display-name').textContent = hero.name;
            document.getElementById('hero-display-level').textContent = hero.level;

            document.getElementById('hero-level').textContent = hero.level;
            document.getElementById('hero-exp').textContent = hero.exp;
            document.getElementById('exp-to-next-level').textContent = expToNext;

            // Atualiza Level Up Button
            const levelUpBtn = document.getElementById('level-up-button');
            if (hero.exp >= expToNext) {
                levelUpBtn.textContent = `SUBIR DE N√çVEL (PRONTO!)`;
                levelUpBtn.disabled = false;
            } else {
                levelUpBtn.textContent = `SUBIR DE N√çVEL (Falta: ${expToNext - hero.exp} EXP)`;
                levelUpBtn.disabled = true;
            }

            updateResourceDisplay();
        }

        function updateResourceDisplay() {
            const resources = gameState.hero.resources;
            document.getElementById('resource-gold').textContent = resources.gold;
            document.getElementById('resource-energy').textContent = resources.energy;
            document.getElementById('resource-soul').textContent = resources.soul;
        }

        function showPanel(panelId) {
            document.querySelectorAll('.content-panel').forEach(panel => {
                panel.style.display = 'none';
            });
            document.getElementById(panelId).style.display = 'block';

            document.querySelectorAll('.sidebar-menu button').forEach(button => {
                button.classList.remove('active');
            });
            document.querySelector(`[data-panel="${panelId}"]`).classList.add('active');
            
            // Atualiza t√≠tulo do painel
            document.getElementById('current-panel-title').textContent = document.querySelector(`[data-panel="${panelId}"]`).textContent;

            // L√≥gica espec√≠fica de renderiza√ß√£o do painel
            if (panelId === 'equipment-panel') renderEquipmentPanel();
            if (panelId === 'inventory-panel') renderInventoryPanel();
            if (panelId === 'adventure-panel') renderAdventureMap();
        }
        
        // --- Renderiza√ß√£o do Equipamento ---
        function renderEquipmentPanel() {
            const stats = calculateStats();
            const hero = gameState.hero;

            document.getElementById('stat-base-hp').textContent = stats.baseHp;
            document.getElementById('stat-bonus-hp').textContent = stats.bonusHp;
            document.getElementById('stat-max-hp').textContent = stats.totalHp;

            document.getElementById('stat-base-atk').textContent = stats.baseAtk;
            document.getElementById('stat-bonus-atk').textContent = stats.bonusAtk;
            document.getElementById('stat-total-atk').textContent = stats.totalAtk;

            document.getElementById('stat-base-energy').textContent = stats.baseEnergy;
            document.getElementById('stat-bonus-energy').textContent = stats.bonusEnergy;
            document.getElementById('stat-max-energy').textContent = stats.totalEnergy;
            
            const getItemName = (itemId) => {
                const item = hero.inventory.find(i => i.id === itemId);
                return item ? `${item.name} (${item.stats.atk ? `+${item.stats.atk} ATK` : ''} ${item.stats.hp ? `+${item.stats.hp} HP` : ''})` : 'Vazio';
            };

            document.getElementById('slot-weapon').textContent = getItemName(hero.equipment.weapon);
            document.getElementById('slot-armor').textContent = getItemName(hero.equipment.armor);
            document.getElementById('slot-accessory').textContent = getItemName(hero.equipment.accessory);
        }

        // --- Renderiza√ß√£o do Invent√°rio ---
        let selectedItemId = null;
        function renderInventoryPanel() {
            const inventoryContainer = document.getElementById('inventory-items');
            inventoryContainer.innerHTML = '';
            
            gameState.hero.inventory.forEach(item => {
                const card = document.createElement('div');
                card.className = `inventory-item-card item-rarity-${item.rarity} ${item.id === selectedItemId ? 'selected' : ''}`;
                card.setAttribute('data-item-id', item.id);
                card.innerHTML = `
                    <p style="margin: 0;">${item.name}</p>
                    <small style="color: ${item.equipped ? 'var(--color-unlocked)' : '#999'};">
                        [${item.equipped ? 'E' : ''}] ${item.type.toUpperCase()}
                    </small>
                `;
                card.addEventListener('click', () => selectItem(item.id));
                inventoryContainer.appendChild(card);
            });
            
            // Re-seleciona o item para garantir que os detalhes est√£o atualizados
            if (selectedItemId) {
                selectItem(selectedItemId, false); // N√£o renderiza o invent√°rio novamente
            } else {
                // Limpa o painel de detalhes
                document.getElementById('item-detail-name').textContent = "Nenhum";
                document.getElementById('item-detail-type').textContent = "?";
                document.getElementById('item-detail-rarity').textContent = "?";
                document.getElementById('item-detail-desc').textContent = "Selecione um item para ver os detalhes.";
                document.getElementById('item-detail-effects').innerHTML = '';
                document.getElementById('btn-equip-item').style.display = 'none';
                document.getElementById('btn-unequip-item').style.display = 'none';
            }
        }
        
        function selectItem(itemId, shouldRenderInventory = true) {
            const item = gameState.hero.inventory.find(i => i.id === itemId);
            if (!item) return;

            selectedItemId = itemId;

            // Atualiza detalhes
            document.getElementById('item-detail-name').textContent = item.name;
            document.getElementById('item-detail-type').textContent = item.type.toUpperCase();
            document.getElementById('item-detail-rarity').textContent = item.rarity.charAt(0).toUpperCase() + item.rarity.slice(1);
            document.getElementById('item-detail-rarity').className = `item-rarity-${item.rarity}`;
            document.getElementById('item-detail-desc').textContent = item.desc;
            
            let effectsHtml = '';
            if (item.stats) {
                for (const stat in item.stats) {
                    effectsHtml += `<p style="margin: 5px 0; color: var(--color-hp); font-weight: bold;">+${item.stats[stat]} ${stat.toUpperCase()}</p>`;
                }
            }
            document.getElementById('item-detail-effects').innerHTML = effectsHtml;

            // L√≥gica de Equipar/Desequipar
            const equipBtn = document.getElementById('btn-equip-item');
            const unequipBtn = document.getElementById('btn-unequip-item');
            
            equipBtn.style.display = 'none';
            unequipBtn.style.display = 'none';

            if (item.type === 'weapon' || item.type === 'armor' || item.type === 'accessory') {
                if (item.equipped) {
                    unequipBtn.style.display = 'block';
                    unequipBtn.onclick = () => unequipItem(item.id);
                } else {
                    equipBtn.style.display = 'block';
                    equipBtn.onclick = () => equipItem(item.id);
                }
            }

            // Marca o card selecionado
            if (shouldRenderInventory) {
                renderInventoryPanel();
            } else {
                 document.querySelectorAll('.inventory-item-card').forEach(card => {
                    card.classList.remove('selected');
                });
                document.querySelector(`.inventory-item-card[data-item-id="${itemId}"]`).classList.add('selected');
            }
        }
        
        function equipItem(itemId) {
            const item = gameState.hero.inventory.find(i => i.id === itemId);
            if (!item) return;
            
            const slot = item.type; // weapon, armor, accessory
            
            // 1. Desequipa o item anterior no slot, se houver
            const oldItemId = gameState.hero.equipment[slot];
            if (oldItemId) {
                const oldItem = gameState.hero.inventory.find(i => i.id === oldItemId);
                if (oldItem) oldItem.equipped = false;
            }
            
            // 2. Equipa o novo item
            gameState.hero.equipment[slot] = itemId;
            item.equipped = true;

            // 3. Atualiza a interface
            renderInventoryPanel();
            // Volta para a visualiza√ß√£o dos detalhes (garantindo que o bot√£o "Desequipar" apare√ßa)
            selectItem(itemId, false); 
            // Atualiza as estat√≠sticas em Equipment/Training panels (por exemplo)
            updateHeroDisplay(); 
        }

        function unequipItem(itemId) {
            const item = gameState.hero.inventory.find(i => i.id === itemId);
            if (!item) return;
            
            const slot = item.type;
            
            // 1. Remove do slot de equipamento
            gameState.hero.equipment[slot] = null;
            item.equipped = false;

            // 2. Atualiza a interface
            renderInventoryPanel();
            // Volta para a visualiza√ß√£o dos detalhes (garantindo que o bot√£o "Equipar" apare√ßa)
            selectItem(itemId, false); 
            // Atualiza as estat√≠sticas
            updateHeroDisplay();
        }

        // --- Renderiza√ß√£o do Mapa de Aventura ---
        let selectedRegionId = null;
        function renderAdventureMap() {
            const heroLevel = gameState.hero.level;
            const regionSelectionArea = document.getElementById('region-selection-area');
            regionSelectionArea.innerHTML = '';
            
            for (const id in MAP_REGIONS) {
                const region = MAP_REGIONS[id];
                const isUnlocked = heroLevel >= region.minLevel && heroLevel <= region.maxLevel;
                const card = document.createElement('div');
                card.className = `region-card ${isUnlocked ? 'unlocked' : 'locked'}`;
                card.setAttribute('data-region-id', id);
                
                card.innerHTML = `
                    <div class="region-info">
                        <h4>${region.name}</h4>
                        <p style="margin: 0; font-size: 0.9em;">${region.levelRange}</p>
                    </div>
                    <div class="status">
                        ${isUnlocked ? 'DESBLOQUEADO' : `N√≠vel ${region.minLevel}+`}
                    </div>
                `;
                
                if (isUnlocked) {
                    card.addEventListener('click', () => selectRegion(id));
                }
                
                regionSelectionArea.appendChild(card);
            }

            // Renderiza a interface de combate para a regi√£o selecionada (ou limpa)
            if (selectedRegionId) {
                 selectRegion(selectedRegionId, false); // N√£o renderiza o mapa novamente
            } else {
                document.getElementById('combat-region-name').textContent = 'Nenhuma Regi√£o Selecionada';
                document.getElementById('monster-selection').innerHTML = '<p style="color: var(--color-locked);">Selecione uma regi√£o no mapa para ver os monstros dispon√≠veis.</p>';
                document.getElementById('combat-log').textContent = 'A batalha come√ßar√° aqui. Selecione um monstro.';
            }
        }
        
        function selectRegion(regionId, shouldRenderMap = true) {
            const region = MAP_REGIONS[regionId];
            if (!region) return;

            selectedRegionId = regionId;
            document.getElementById('combat-region-name').textContent = region.name;

            // 1. Limpa e Popula a Sele√ß√£o de Monstros
            const monsterSelection = document.getElementById('monster-selection');
            monsterSelection.innerHTML = '';
            
            region.monsters.forEach((monster, index) => {
                const button = document.createElement('button');
                button.textContent = `${monster.name} (HP: ${monster.hp} | ATK: ${monster.atk} | EXP: ${monster.exp} ‚ö°)`;
                button.addEventListener('click', () => startCombat(regionId, index));
                monsterSelection.appendChild(button);
            });

            // 2. Limpa o Log de Combate
            document.getElementById('combat-log').textContent = `Regi√£o ${region.name} selecionada. Escolha um monstro acima para atacar!`;

            // 3. Atualiza o destaque no mapa (se necess√°rio)
            if (shouldRenderMap) {
                document.querySelectorAll('.region-card').forEach(card => card.classList.remove('selected-region'));
                document.querySelector(`.region-card[data-region-id="${regionId}"]`).classList.add('selected-region');
            }
        }
        
        // --- L√≥gica de Combate ---
        function startCombat(regionId, monsterIndex) {
            const region = MAP_REGIONS[regionId];
            const monster = region.monsters[monsterIndex];
            const heroStats = calculateStats();
            
            // Simulando o Combate R√°pido
            const log = document.getElementById('combat-log');
            log.textContent = `--- Combate Iniciado: ${gameState.hero.name} vs ${monster.name} ---\n\n`;
            
            let heroDamage = heroStats.totalAtk;
            let monsterHP = monster.hp;
            let rounds = 0;
            
            while (monsterHP > 0 && rounds < 100) { // Limite de rounds para evitar loop infinito
                rounds++;
                
                // Ataque do Her√≥i
                monsterHP -= heroDamage;
                log.textContent += `[Rodada ${rounds}] ${gameState.hero.name} ataca! Dano: ${heroDamage}. ${monster.name} HP restante: ${Math.max(0, monsterHP)}\n`;

                if (monsterHP <= 0) {
                    log.textContent += `\n*** VIT√ìRIA! ***\n`;
                    log.textContent += `${gameState.hero.name} derrotou ${monster.name} em ${rounds} rodadas.\n`;
                    
                    // Recompensas
                    gameState.hero.exp += monster.exp;
                    gameState.hero.resources.gold += monster.gold;
                    log.textContent += `Ganho: ${monster.exp} EXP e ${monster.gold} Ouro.\n`;
                    
                    updateHeroDisplay();
                    checkLevelUp();
                    break;
                }
                
                // Ataque do Monstro (Simplificado: Monstro n√£o mata o Her√≥i no clicker)
                // log.textContent += `${monster.name} ataca! (Dano: ${monster.atk}, ignorado para simplifica√ß√£o.)\n`;
            }

            if (rounds >= 100) {
                log.textContent += '\nCombate empatado devido ao limite de tempo.';
            }
            
            log.scrollTop = log.scrollHeight; // Scroll autom√°tico
        }


        // ------------------------------------------------------------
        // V. FUN√á√ïES DE GAMEPLAY PRINCIPAIS
        // ------------------------------------------------------------
        
        function checkLevelUp() {
            const hero = gameState.hero;
            const expToNext = getExpRequired(hero.level);
            
            if (hero.exp >= expToNext) {
                const levelUpBtn = document.getElementById('level-up-button');
                levelUpBtn.disabled = false;
                levelUpBtn.textContent = `SUBIR DE N√çVEL (PRONTO!)`;
            }
        }

        function handleLevelUp() {
            const hero = gameState.hero;
            const expToNext = getExpRequired(hero.level);
            
            if (hero.exp >= expToNext) {
                hero.exp -= expToNext;
                hero.level += 1;
                
                // Aumenta as estat√≠sticas base por n√≠vel
                hero.baseStats.hp += 2;
                hero.baseStats.atk += 1;
                hero.baseStats.energy += 5;

                alert(`Parab√©ns! Voc√™ subiu para o N√≠vel ${hero.level}!`);

                updateHeroDisplay();
                checkLevelUp();
                // Opcional: Atualizar o mapa caso tenha desbloqueado uma nova regi√£o
                if(gameState.currentPanel === 'adventure-panel') renderAdventureMap(); 
            }
        }

        function handleTrainingAction(actionType) {
            const hero = gameState.hero;
            const cost = 25;
            const expGain = 10;
            
            if (hero.resources.energy >= cost) {
                hero.resources.energy -= cost;
                hero.exp += expGain;
                
                alert(`Voc√™ gastou ${cost} ‚ö° e ganhou ${expGain} EXP treinando ${actionType}.`);
                
                updateHeroDisplay();
                checkLevelUp();
            } else {
                alert('Energia insuficiente para treinar!');
            }
        }
        
        function handlePreparationAction(actionName) {
            const action = gameState.hero.preparation[actionName];
            if (action.inProgress) {
                alert('A√ß√£o j√° est√° em andamento!');
                return;
            }

            if (actionName === 'study') {
                if (gameState.hero.resources.energy < action.costEnergy) {
                    alert('Energia insuficiente para Estudar Magia!');
                    return;
                }
                gameState.hero.resources.energy -= action.costEnergy;
            } else if (actionName === 'blacksmith') {
                if (gameState.hero.resources.gold < action.costGold) {
                    alert('Ouro insuficiente para o Trabalho no Ferreiro!');
                    return;
                }
                gameState.hero.resources.gold -= action.costGold;
            }
            
            action.inProgress = true;
            action.cooldown = action.duration;
            alert(`A√ß√£o "${actionName}" iniciada. Tempo restante: ${action.duration}s`);
            updatePreparationDisplay();
            updateResourceDisplay();
        }

        function updatePreparationDisplay() {
            const prepActions = gameState.hero.preparation;
            const cooldownsDiv = document.getElementById('preparation-cooldowns');
            cooldownsDiv.innerHTML = '';
            
            for (const actionName in prepActions) {
                const action = prepActions[actionName];
                const button = document.getElementById(`action-${actionName}`);
                
                if (action.inProgress) {
                    button.disabled = true;
                    const cooldownDiv = document.createElement('div');
                    cooldownDiv.style.color = 'var(--color-accent)';
                    cooldownDiv.textContent = `Em Progresso (${action.cooldown}s restantes)`;
                    cooldownsDiv.appendChild(cooldownDiv);
                } else {
                    button.disabled = false;
                }
            }
        }
        
        function handleMissionComplete(missionName) {
            const mission = gameState.hero.missions[missionName];
            if (mission.completed) return;

            if (missionName === 'tutorialGold') {
                gameState.hero.resources.gold += mission.rewardGold;
                gameState.hero.resources.energy += mission.rewardEnergy;
                alert(`Miss√£o '${missionName}' conclu√≠da! Ganho: ${mission.rewardGold} üí∞ e ${mission.rewardEnergy} ‚ö°.`);
            } else if (missionName === 'tutorialHp') {
                gameState.hero.exp += mission.rewardExp;
                // O b√¥nus de HP j√° √© calculado em calculateStats()
                alert(`Miss√£o '${missionName}' conclu√≠da! Ganho: ${mission.rewardExp} EXP e +10 HP base permanente.`);
                checkLevelUp();
            } else if (missionName === 'dailyTraining') {
                gameState.hero.exp += mission.rewardExp;
                // O b√¥nus de ATK j√° √© calculado em calculateStats()
                alert(`Miss√£o Di√°ria conclu√≠da! Ganho: ${mission.rewardExp} EXP e +2 ATK base permanente (at√© a pr√≥xima miss√£o di√°ria).`);
                checkLevelUp();
            }

            mission.completed = true;
            updateHeroDisplay();
            renderTrainingPanelMissions();
            renderEquipmentPanel(); // Para atualizar o b√¥nus de stats
        }
        
        function renderTrainingPanelMissions() {
            // Esconde miss√µes √∫nicas completadas
            const uniqueMissionsDiv = document.getElementById('unique-missions');
            uniqueMissionsDiv.innerHTML = '';
            for (const missionName in gameState.hero.missions) {
                if (missionName.startsWith('tutorial') && !gameState.hero.missions[missionName].completed) {
                    // Recria o bot√£o se a miss√£o n√£o foi completada (simples para este exemplo)
                    const mission = gameState.hero.missions[missionName];
                     const button = document.createElement('button');
                     button.setAttribute('data-mission', missionName);
                     button.style.backgroundColor = '#2c3e50';
                     button.style.color = 'var(--color-text)';
                     button.style.border = 'none';
                     button.style.padding = '10px 15px';
                     button.style.borderRadius = '5px';
                     button.style.marginRight = '10px';
                     
                     if (missionName === 'tutorialHp') {
                         button.textContent = `Provar o Valor (Recompensa: 500 EXP | +10 HP B√¥nus!)`;
                     } else if (missionName === 'tutorialGold') {
                         button.textContent = `Finalizar Tutorial B√°sico (Recompensa: 100 üí∞ | 100 ‚ö°)`;
                     }
                     
                     button.addEventListener('click', () => handleMissionComplete(missionName));
                     uniqueMissionsDiv.appendChild(button);
                }
            }
            
            // L√≥gica de Cooldown para Miss√µes Di√°rias (Simplificada)
            const dailyTrainingBtn = document.querySelector('[data-mission="daily-training"]');
            const dailyMissionState = gameState.hero.missions.dailyTraining;
            if (dailyMissionState.completed) {
                 dailyTrainingBtn.textContent = `Exerc√≠cios de Treinamento (Em Cooldown: ${dailyMissionState.cooldown}h restantes)`;
                 dailyTrainingBtn.disabled = true;
            } else {
                 dailyTrainingBtn.textContent = `Exerc√≠cios de Treinamento (Recompensa: 200 EXP | +2 ATK B√¥nus!)`;
                 dailyTrainingBtn.disabled = false;
                 dailyTrainingBtn.addEventListener('click', () => handleMissionComplete('dailyTraining'));
            }
        }


        // ------------------------------------------------------------
        // VI. INICIALIZA√á√ÉO, EVENTOS E LOOP
        // ------------------------------------------------------------
        
        function initGame() {
            // Configura√ß√£o da M√∫sica
            const music = document.getElementById('background-music');
            music.volume = 0.5; // Valor inicial
            
            document.getElementById('start-volume-slider').addEventListener('input', (e) => {
                music.volume = parseFloat(e.target.value);
            });
            
            document.getElementById('audio-control-button').addEventListener('click', () => {
                if (music.paused) {
                    music.play().catch(e => console.log("Play failed:", e));
                    document.getElementById('audio-control-button').textContent = 'üîä';
                } else {
                    music.pause();
                    document.getElementById('audio-control-button').textContent = 'üîá';
                }
            });

            // Eventos do Menu Inicial
            document.getElementById('btn-new-game').addEventListener('click', () => {
                document.getElementById('start-menu').style.display = 'none';
                document.getElementById('character-creation-panel').style.display = 'flex';
                // music.play().catch(e => console.log("Play failed:", e));
            });

            // Eventos da Cria√ß√£o de Personagem
            renderClassSelection();
            document.getElementById('hero-name').addEventListener('input', checkCreationForm);
            document.getElementById('btn-confirm-creation').addEventListener('click', confirmCharacterCreation);

            // Eventos do Menu Lateral
            document.querySelectorAll('.sidebar-menu button').forEach(button => {
                button.addEventListener('click', (e) => showPanel(e.target.dataset.panel));
            });

            // Eventos de A√ß√£o de Treinamento
            document.getElementById('level-up-button').addEventListener('click', handleLevelUp);
            document.getElementById('action-tactic').addEventListener('click', () => handleTrainingAction('t√°tica'));
            document.getElementById('action-defense').addEventListener('click', () => handleTrainingAction('defesa'));
            
            // Eventos de A√ß√£o de Prepara√ß√£o
            document.getElementById('action-study').addEventListener('click', () => handlePreparationAction('study'));
            document.getElementById('action-blacksmith').addEventListener('click', () => handlePreparationAction('blacksmith'));
            
            // Inicializa√ß√£o do Loop do Jogo
            setInterval(gameLoop, 1000);
            
        }
        
        function renderClassSelection() {
            const container = document.getElementById('class-selection-container');
            container.innerHTML = '';
            for (const key in CLASSES) {
                const classData = CLASSES[key];
                const button = document.createElement('button');
                button.setAttribute('data-class', key);
                button.innerHTML = `<img src="${classData.icon}" alt="${classData.name}"><span>${classData.name}</span>`;
                button.addEventListener('click', () => selectClass(key));
                container.appendChild(button);
            }
        }
        
        let selectedClass = null;
        function selectClass(className) {
            selectedClass = className;
            document.querySelectorAll('#class-selection-container button').forEach(btn => {
                btn.style.border = '2px solid var(--color-primary)';
            });
            document.querySelector(`button[data-class="${className}"]`).style.border = '2px solid var(--color-energy)';
            checkCreationForm();
        }

        function checkCreationForm() {
            const name = document.getElementById('hero-name').value.trim();
            const confirmBtn = document.getElementById('btn-confirm-creation');
            confirmBtn.disabled = !(name.length > 0 && selectedClass !== null);
        }

        function confirmCharacterCreation() {
            const name = document.getElementById('hero-name').value.trim();
            if (name.length > 0 && selectedClass) {
                // Configura o novo her√≥i
                const classData = CLASSES[selectedClass];
                gameState.hero.name = name;
                gameState.hero.class = classData.name;
                gameState.hero.baseStats = { ...classData.baseStats };
                
                // Remove itens iniciais, caso a classe n√£o os use
                if (classData.name !== 'Mago') {
                     gameState.hero.inventory = gameState.hero.inventory.filter(i => i.id !== 'w1');
                     gameState.hero.equipment.weapon = null;
                }
                
                gameState.isCharacterCreated = true;
                
                // Transi√ß√£o para a tela principal
                document.getElementById('character-creation-panel').style.display = 'none';
                document.getElementById('app-wrapper').style.display = 'flex';
                document.getElementById('sidebar').style.display = 'block';
                document.getElementById('main-content').style.display = 'block';

                updateHeroDisplay();
                renderTrainingPanelMissions();
                renderEquipmentPanel();
            }
        }

        function gameLoop() {
            if (!gameState.isCharacterCreated) return;

            // Timer para A√ß√µes de Prepara√ß√£o
            for (const actionName in gameState.hero.preparation) {
                const action = gameState.hero.preparation[actionName];
                if (action.inProgress) {
                    action.cooldown -= 1;
                    if (action.cooldown <= 0) {
                        action.inProgress = false;
                        
                        // Recompensa
                        if (actionName === 'study') {
                            gameState.hero.resources.gold += action.rewardGold;
                            alert(`Estudo de Magia conclu√≠do! Ganho: ${action.rewardGold} üí∞.`);
                        } else if (actionName === 'blacksmith') {
                            // Assumindo que "rewardResource" √© um recurso n√£o rastreado explicitamente ainda, mas para o exemplo, damos energia
                            gameState.hero.resources.energy += action.rewardEnergy;
                            alert(`Trabalho no Ferreiro conclu√≠do! Ganho: ${action.rewardEnergy} ‚ö°.`);
                        }

                        updateResourceDisplay();
                    }
                }
            }
            updatePreparationDisplay();
            
            // Timer simplificado para Cooldown Di√°rio
            // gameState.hero.missions.dailyTraining.cooldown = Math.max(0, gameState.hero.missions.dailyTraining.cooldown - 1);
            // if (gameState.hero.missions.dailyTraining.cooldown === 0 && gameState.hero.missions.dailyTraining.completed) {
            //      gameState.hero.missions.dailyTraining.completed = false;
            //      renderTrainingPanelMissions();
            //      renderEquipmentPanel(); // Para remover o b√¥nus de ATK
            //      alert('As Miss√µes Di√°rias foram resetadas!');
            // }


        }


        // Inicia o jogo ao carregar a p√°gina
        window.onload = initGame;
    </script>

</body>
</html>
