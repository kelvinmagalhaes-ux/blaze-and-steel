<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BLAZE AND STEEL</title>
    <style>
        /* Vari√°veis de Cores (CSS Custom Properties) */
        :root {
            --color-primary: #1e1e2d;
            --color-secondary: #36364f;
            --color-text: #e0e0e0;
            --color-accent: #f39c12; /* Ouro */
            --color-combat: #c0392b; /* Combate/Aventura */
            --color-evolve: #8e44ad; /* Evoluir/Treinamento */
            --color-energy: #3498db; /* Energia */
            --color-soul: #9b59b6; /* Alma/Reencarna√ß√£o */
            --color-hp: #2ecc71; /* HP/Vida */
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--color-primary);
            color: var(--color-text);
            margin: 0;
            display: flex;
            min-height: 100vh;
            overflow: hidden; 
        }

        /* Estrutura Geral */
        #app-wrapper {
            display: flex;
            width: 100%;
        }

        /* Sidebar (Menu Lateral) */
        #sidebar {
            width: 200px;
            background-color: var(--color-secondary);
            padding: 20px 0;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.5);
            display: none; 
            flex-shrink: 0; 
        }

        .sidebar-menu button {
            display: block;
            width: 100%;
            padding: 15px 20px;
            text-align: left;
            background: none;
            border: none;
            color: var(--color-text);
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
            display: flex; 
            align-items: center;
        }

        .sidebar-menu button:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .sidebar-menu button.active {
            background-color: var(--color-evolve);
            font-weight: bold;
            color: white; 
        }
        
        .sidebar-menu button::before {
            content: ''; 
            margin-right: 10px;
            font-size: 1.2em;
            width: 25px; 
            text-align: center;
        }
        
        /* Defini√ß√£o de √çcones (Simplificada para emojis) */
        #btn-training::before { content: 'üè†'; } 
        #btn-adventure::before { content: 'üó∫Ô∏è'; } 
        #btn-upgrades::before { content: '‚è´'; } 
        #btn-equipment::before { content: '‚öîÔ∏è'; } 
        #btn-inventory::before { content: 'üì¶'; } 
        #btn-status::before { content: 'üë§'; } 
        #btn-expedition::before { content: 'üß≠'; } 


        /* √Årea de Conte√∫do Principal */
        #main-content {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            max-height: 100vh;
            display: none; 
            position: relative; 
        }
        
        /* Bot√£o de √Åudio (Dentro do Jogo) */
        #audio-control-button {
            background-color: var(--color-secondary);
            border: 1px solid var(--color-accent);
            color: var(--color-text);
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            z-index: 10;
        }

        /* Pain√©is de Conte√∫do (Geral) */
        .content-panel {
            background-color: var(--color-secondary);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        /* Menu Inicial (Start Menu) */
        #start-menu {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100vh;
            position: fixed; 
            top: 0;
            left: 0;
            background-color: var(--color-primary);
            z-index: 100;
        }
        
        .game-logo {
            max-width: 90%;
            width: 500px;
            height: auto;
            margin-bottom: 50px;
        }

        .menu-button-stack button {
            display: block;
            width: 300px;
            padding: 15px 20px;
            margin: 10px 0;
            border: 2px solid var(--color-accent);
            border-radius: 5px;
            background-color: var(--color-combat);
            color: var(--color-text);
            font-size: 1.2em;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            box-shadow: 0 4px var(--color-accent);
        }

        .menu-button-stack button:hover {
            background-color: #e74c3c;
            transform: translateY(-2px);
            box-shadow: 0 6px var(--color-accent);
        }

        .menu-button-stack button:active {
            transform: translateY(2px);
            box-shadow: 0 2px var(--color-accent);
        }
        
        /* Painel de Cria√ß√£o de Personagem - ESTILO ISOLADO */
        #character-creation-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--color-primary);
            z-index: 99;
            display: none; 
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
            box-sizing: border-box;
        }

        #character-creation-panel .content-panel {
            max-width: 700px;
            margin: auto;
            padding: 30px;
            border: 2px solid var(--color-accent);
        }
        
        /* Estilos para o Seletor de Classe */
        #class-selection-container {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        #class-selection-container button {
            background-color: var(--color-primary); 
            color: var(--color-text); 
            border: 2px solid var(--color-secondary); 
            padding: 10px 15px; 
            border-radius: 5px; 
            cursor: pointer;
            width: 150px;
            height: 150px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: border-color 0.2s, background-color 0.2s;
        }
        
        #class-selection-container button:hover {
            border-color: var(--color-accent);
        }

        #class-selection-container button.selected {
            border-color: var(--color-energy);
            background-color: rgba(52, 152, 219, 0.1); 
        }
        
        #class-selection-container button img {
            max-width: 80px; 
            max-height: 80px; 
            margin-bottom: 5px;
            border-radius: 5px;
            object-fit: cover;
        }


        /* Header e Display de Recursos */
        #header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px 20px 0;
            border-bottom: 1px solid var(--color-secondary);
            margin-bottom: 20px;
        }

        .resource-display {
            display: flex;
            gap: 15px;
        }

        .resource-item {
            font-size: 1.1em;
            font-weight: bold;
        }

        .resource-item span {
            margin-left: 5px;
        }
        
        /* Bot√µes de A√ß√£o (Geral) */
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Estilos do Invent√°rio */
        #inventory-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .inventory-item-card {
            background-color: var(--color-primary);
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
            border: 1px solid transparent;
        }

        .inventory-item-card.selected {
            border-color: var(--color-energy);
            background-color: rgba(52, 152, 219, 0.1);
        }
        
        .item-rarity-common { color: #aaa; }
        .item-rarity-uncommon { color: var(--color-hp); }
        .item-rarity-rare { color: var(--color-energy); }
        .item-rarity-epic { color: var(--color-evolve); }
        .item-rarity-legendary { color: var(--color-accent); }

        /* Estilo do Log de Combate */
        #combat-log {
            min-height: 150px;
            max-height: 300px;
            overflow-y: auto;
            background-color: var(--color-primary);
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-family: monospace;
            white-space: pre-wrap;
        }

    </style>
</head>
<body>

    <div id="app-wrapper">
        
        <div id="start-menu" style="display: flex;">
            <img src="assets/blaze-and-steel.png" alt="Blaze and Steel Logo" class="game-logo">
            <div class="menu-button-stack">
                <button id="btn-new-game">NOVO JOGO</button>
                <button id="btn-load-game">CARREGAR JOGO</button>
                <button id="btn-exit-game">SAIR</button>
            </div>
        </div>

        <div id="character-creation-panel" style="display: none;">
            <div class="content-panel">
                <h2>Crie Seu Her√≥i!</h2>
                <p>Escolha um nome e uma classe para come√ßar sua aventura.</p>
                
                <label for="hero-name">Nome do Her√≥i:</label>
                <input type="text" id="hero-name" placeholder="Ex: Her√≥i Blaze" style="width: 100%; padding: 10px; margin-bottom: 20px; box-sizing: border-box; background-color: var(--color-primary); color: var(--color-text); border: 1px solid var(--color-accent);">
                
                <h3>Selecione Sua Classe:</h3>
                <div id="class-selection-container">
                    </div>

                <div id="class-detail-display" class="content-panel" style="background-color: var(--color-primary); margin-top: 20px; padding: 15px;">
                    <h4>Detalhes da Classe: <span id="class-detail-name" style="color: var(--color-accent);">Nenhuma Selecionada</span></h4>
                    <p id="class-detail-desc">Selecione uma classe para ver suas informa√ß√µes, estat√≠sticas base e item inicial.</p>
                    <p>Estat√≠sticas Iniciais:</p>
                    <ul style="list-style: none; padding: 0; margin-top: 10px;">
                        <li style="color: var(--color-hp);">‚ù§Ô∏è HP Base: <span id="class-detail-hp">?</span></li>
                        <li style="color: var(--color-combat);">‚öîÔ∏è ATK Base: <span id="class-detail-atk">?</span></li>
                        <li style="color: var(--color-energy);">‚ö° Energia Base: <span id="class-detail-energy">?</span></li>
                    </ul>
                </div>
                <button id="btn-confirm-creation" disabled style="width: 100%; padding: 15px; margin-top: 30px; background-color: var(--color-evolve); color: white; border: none; border-radius: 5px; font-size: 1.1em; cursor: pointer;">CONFIRMAR CRIA√á√ÉO</button>
            </div>
        </div>
        
        <div id="sidebar">
            <div id="hero-info" style="padding: 0 20px 20px 20px; border-bottom: 1px solid var(--color-primary); margin-bottom: 10px;">
                <h3 id="hero-display-name">Her√≥i CLT</h3>
                <p>N√≠vel: <span id="hero-display-level">1</span></p>
                <p>Classe: <span id="hero-display-class">Guerreiro</span></p>
            </div>
            <div class="sidebar-menu">
                <button id="btn-training" data-panel="hero-training-panel" class="active">Quartel-General</button>
                <button id="btn-adventure" data-panel="adventure-panel">Aventura</button>
                <button id="btn-upgrades" data-panel="upgrades-panel">Upgrades</button>
                <button id="btn-equipment" data-panel="equipment-panel">Equipamento</button>
                <button id="btn-inventory" data-panel="inventory-panel">Invent√°rio</button>
                <button id="btn-status" data-panel="status-panel">Status</button>
                <button id="btn-expedition" data-panel="expedition-panel">Expedi√ß√£o</button>
            </div>
        </div>
        
        <div id="main-content">
            
            <div id="header">
                <h2 id="current-panel-title">Quartel-General</h2>
                <div class="resource-display">
                    <div class="resource-item" style="color: var(--color-energy);">‚ö° Energia: <span id="resource-energy">100</span></div>
                    <div class="resource-item" style="color: var(--color-accent);">üí∞ Ouro: <span id="resource-gold">0</span></div>
                    <div class="resource-item" style="color: var(--color-soul);">üîÆ Alma: <span id="resource-soul">0</span></div>
                    <button id="audio-control-button">üîä</button>
                </div>
            </div>

            <div id="hero-training-panel" class="content-panel" style="display: block;">
                
                <h3>Progresso e N√≠vel</h3>
                <p>
                    <span style="color: var(--color-accent);">üåü N√≠vel de Poder:</span> <span id="hero-level">1</span><br>
                    <span style="color: var(--color-energy);">‚ú® EXP:</span> <span id="hero-exp">0</span> / <span id="exp-to-next-level">50</span>
                </p>
                <button id="level-up-button" disabled>SUBIR DE N√çVEL (Falta: 50 EXP)</button>
                
                <h3 style="margin-top: 30px;">Recursos e Evolu√ß√£o</h3>
                <p>Use suas a√ß√µes para acumular recursos ou evoluir.</p>
                
                <div id="preparation-actions" style="display: flex; gap: 10px;">
                    <button id="action-study" data-action="study" style="background-color: var(--color-energy); color: white; border: none; padding: 10px 15px; border-radius: 5px;">
                        Estudo de Magia (Custo: 5 ‚ö° | Ganho: 50 üí∞)
                    </button>
                    <button id="action-blacksmith" data-action="blacksmith" style="background-color: var(--color-accent); color: var(--color-primary); border: none; padding: 10px 15px; border-radius: 5px;">
                        Trabalho no Ferreiro (Custo: 50 üí∞ | Ganho: 15 ‚ö°)
                    </button>
                </div>
                <div id="preparation-cooldowns" style="margin-top: 15px; display: flex; gap: 10px;">
                    </div>
                
                <h3 style="margin-top: 30px;">Miss√µes</h3>
                <div id="missions-container">
                    </div>

            </div>
            
            <div id="adventure-panel" class="content-panel" style="display: none;">
                
                <img src="assets/adventure.png" alt="ADVENTURE" id="adventure-title-logo">
                
                <div id="monster-selection-container">
                    </div>
                <div class="content-panel" style="display: flex; justify-content: space-between; align-items: flex-start; background-color: var(--color-primary);">
                    <div style="flex: 1;">
                        <h3>üÜö <span id="monster-name">Selecione um Monstro</span></h3>
                        <p>‚ù§Ô∏è HP: <span id="monster-hp-display">0</span> | ‚öîÔ∏è ATK: <span id="monster-atk-display">0</span></p>
                        <p style="color: var(--color-accent);">Recompensa: <span id="monster-reward-exp">0</span> EXP | <span id="monster-reward-gold">0</span> üí∞</p>
                    </div>
                    <div style="text-align: right;">
                        <button id="start-battle-button" disabled style="background-color: var(--color-combat); color: white; border: none; padding: 10px 15px; border-radius: 5px; font-size: 1.1em; cursor: pointer;">
                            Nenhum Monstro Aqui
                        </button>
                    </div>
                </div>

                <h4>üìú Log de Combate</h4>
                <div id="combat-log">
                    Selecione um monstro e clique em "Iniciar Batalha".
                </div>

            </div>
            
            <div id="upgrades-panel" class="content-panel" style="display: none;">
                <h2>‚è´ Upgrades</h2>
                <p>Aqui voc√™ poder√° gastar seus recursos (Ouro/Alma) para aprimorar permanentemente suas estat√≠sticas.</p>
            </div>

            <div id="equipment-panel" class="content-panel" style="display: none;">
                <h2>‚öîÔ∏è Equipamento & Estat√≠sticas</h2>
                
                <div style="display: flex; gap: 30px;">
                    
                    <div style="flex: 1;">
                        <h3 style="border-bottom: 1px solid var(--color-primary); padding-bottom: 10px;">Slots de Equipamento</h3>
                        <div id="equipment-slots-container">
                            </div>
                    </div>
                    
                    <div style="flex: 1;">
                        <h3 style="border-bottom: 1px solid var(--color-primary); padding-bottom: 10px;">Estat√≠sticas Totais</h3>
                        <p>‚ù§Ô∏è HP Total: <span id="stat-total-hp">0</span></p>
                        <p>‚öîÔ∏è ATK Total: <span id="stat-total-atk">0</span></p>
                        <p>‚ö° Energia M√°x: <span id="stat-total-energy">0</span></p>
                    </div>

                </div>
            </div>

            <div id="inventory-panel" class="content-panel" style="display: none;">
                <h2>üì¶ Invent√°rio</h2>
                <p>Seus itens e recursos. Clique em um item para inspecionar e equipar/usar.</p>
                
                <div id="inventory-items">
                    </div>

                <h3 style="margin-top: 30px;">Detalhes do Item: <span id="item-detail-name">Nenhum</span></h3>
                <div id="item-detail-panel" class="content-panel" style="background-color: var(--color-primary); padding: 15px;">
                    <p>Tipo: <span id="item-detail-type">?</span> | Raridade: <span id="item-detail-rarity" class="item-rarity-common">?</span></p>
                    <p>Descri√ß√£o: <span id="item-detail-desc">Selecione um item para ver os detalhes.</span></p>
                    <p id="item-detail-effects"></p>
                    <button id="btn-equip-item" style="background-color: var(--color-hp); color: var(--color-primary); border: none; padding: 8px 15px; border-radius: 5px; margin-top: 10px; display: none;">EQUIPAR</button>
                    <button id="btn-unequip-item" style="background-color: var(--color-combat); color: white; border: none; padding: 8px 15px; border-radius: 5px; margin-top: 10px; display: none;">DESEQUIPAR</button>
                    <button id="btn-sell-item" style="background-color: var(--color-accent); color: var(--color-primary); border: none; padding: 8px 15px; border-radius: 5px; margin-top: 10px; margin-left: 10px; display: none;">VENDER (0 üí∞)</button>
                </div>
            </div>
            
            <div id="status-panel" class="content-panel" style="display: none;">
                <h2>üë§ Status</h2>
                <p>Veja seu hist√≥rico, t√≠tulos e conquistas.</p>
            </div>
            
            <div id="expedition-panel" class="content-panel" style="display: none;">
                <h2>üß≠ Expedi√ß√£o</h2>
                <p>Envie companheiros para miss√µes autom√°ticas em troca de grandes recompensas.</p>
            </div>

        </div>
    </div>


    <script>
        // ====================================================================
        // I. ESTRUTURA DE DADOS DO JOGO (GAME STATE)
        // ====================================================================
        let gameState = {
            isGameStarted: false,
            isCharacterCreated: false,
            hero: {
                name: "Her√≥i CLT",
                class: "Guerreiro",
                level: 1,
                exp: 0,
                baseStats: {
                    hp: 50,
                    atk: 5,
                    energy: 100,
                },
                resources: {
                    gold: 0,
                    energy: 100,
                    soul: 0,
                },
                inventory: [],
                missions: {
                    tutorialCombat: { completed: false, rewardExp: 100, rewardGold: 50 }
                },
                preparation: {
                    study: { inProgress: false, cooldown: 0, duration: 60, costEnergy: 5, rewardGold: 50 },
                    blacksmith: { inProgress: false, cooldown: 0, duration: 30, costGold: 50, rewardEnergy: 15 },
                }
            },
            currentPanel: 'hero-training-panel',
        };
        
        // CORRE√á√ÉO: CLASSE LUTADOR ADICIONADA E DADOS DE CLASSES COMPLETOS
        const CLASSES = {
            // VERIFIQUE SE OS CAMINHOS DAS IMAGENS A SEGUIR EST√ÉO CORRETOS NA SUA ESTRUTURA DE PASTAS
            guerreiro: { name: "Guerreiro", icon: "assets/guerreiro.png", description: "Focado em for√ßa e defesa. Alto HP, bom ATK.", baseStats: { hp: 60, atk: 7, energy: 90 }, startingItem: { id: 's1', name: 'Espada de Ferro', type: 'weapon', rarity: 'common', stats: { atk: 3, hp: 0 }, desc: 'Uma espada padr√£o forjada em ferro.' } },
            mago: { name: "Mago", icon: "assets/mago.png", description: "Especialista em magias. Alto Energy, baixo HP.", baseStats: { hp: 45, atk: 4, energy: 120 }, startingItem: { id: 's2', name: 'Cajado de B√©tula', type: 'weapon', rarity: 'common', stats: { atk: 2, energy: 10 }, desc: 'Um cajado simples para iniciantes.' } },
            arqueiro: { name: "Arqueiro", icon: "assets/arqueiro.png", description: "√Ågil e preciso. Equil√≠brio entre ATK e Energy.", baseStats: { hp: 50, atk: 8, energy: 100 }, startingItem: { id: 's3', name: 'Arco Curto', type: 'weapon', rarity: 'common', stats: { atk: 4, hp: 0 }, desc: 'Um arco leve, bom para ca√ßa.' } },
            // CLASSE LUTADOR ADICIONADA
            lutador: { name: "Lutador", icon: "assets/lutador.png", description: "Combate corpo a corpo, focado em agilidade e ataque r√°pido.", baseStats: { hp: 55, atk: 9, energy: 95 }, startingItem: { id: 's4', name: 'Manopla Enfaixada', type: 'weapon', rarity: 'common', stats: { atk: 5, hp: 0 }, desc: 'Um par de luvas simples, mas eficazes.' } },
        };

        const EXP_BASE = 50;
        const EXP_MULTIPLIER = 1.5;
        let powerLevel = gameState.hero.level; 
        
        let currentHP = 0; // HP atual do her√≥i na batalha (usado na simula√ß√£o de combate)
        let isFighting = false; // Flag para evitar spam de batalha
        let selectedClass = null; // Usado na cria√ß√£o de personagem
        let inspectedItem = null; // Usado no invent√°rio

        // Slots de equipamento dispon√≠veis
        const EQUIPMENT_SLOTS = {
            weapon: { name: "Arma", currentItem: null, type: 'weapon' },
            armor: { name: "Armadura", currentItem: null, type: 'armor' },
            accessory: { name: "Acess√≥rio", currentItem: null, type: 'accessory' }
        };

        // Dados de Monstros (Agrupados por N√≠vel de Poder do Her√≥i)
        const MONSTERS_BY_LEVEL = {
            1: [
                { name: 'Slime', baseHP: 10, atk: 1, energyCost: 10, expReward: 5, goldReward: 1, combatDifficulty: 'F√°cil' },
                { name: 'Goblin', baseHP: 15, atk: 2, energyCost: 15, expReward: 8, goldReward: 2, combatDifficulty: 'Normal' }
            ],
            2: [
                { name: 'Lobo', baseHP: 25, atk: 4, energyCost: 20, expReward: 15, goldReward: 4, combatDifficulty: 'F√°cil' },
                { name: 'Bandido', baseHP: 35, atk: 6, energyCost: 30, expReward: 25, goldReward: 7, combatDifficulty: 'Normal' }
            ],
            3: [
                { name: 'Orc Guerreiro', baseHP: 60, atk: 10, energyCost: 40, expReward: 40, goldReward: 12, combatDifficulty: 'Normal' },
                { name: 'Aranha Gigante', baseHP: 50, atk: 12, energyCost: 45, expReward: 45, goldReward: 10, combatDifficulty: 'Dif√≠cil' }
            ]
            // Adicione mais n√≠veis conforme o jogo avan√ßa
        };
        
        let currentMonster = null; // Monstro atualmente selecionado para combate

        // ====================================================================
        // II. C√ÅLCULO DE ESTAT√çSTICAS
        // ====================================================================

        function getExpRequired(level) {
            if (level <= 1) return EXP_BASE;
            return Math.ceil(EXP_BASE * Math.pow(EXP_MULTIPLIER, level - 1));
        }

        function calculateStats() {
            const hero = gameState.hero;
            let totalHp = hero.baseStats.hp;
            let totalAtk = hero.baseStats.atk;
            let totalEnergy = hero.baseStats.energy;

            // B√¥nus de Equipamento
            for (const key in EQUIPMENT_SLOTS) {
                const item = EQUIPMENT_SLOTS[key].currentItem;
                if (item && item.stats) {
                    totalHp += item.stats.hp || 0;
                    totalAtk += item.stats.atk || 0;
                    totalEnergy += item.stats.energy || 0;
                }
            }
            
            // B√¥nus de Miss√µes/Upgrades (Placeholder)

            return { totalHp, totalAtk, totalEnergy };
        }

        // ====================================================================
        // III. RENDERIZA√á√ÉO GERAL E ATUALIZA√á√ÉO DA INTERFACE
        // ====================================================================

        function updateHeroDisplay() {
            const hero = gameState.hero;
            const expToNext = getExpRequired(hero.level);

            document.getElementById('hero-display-name').textContent = hero.name;
            document.getElementById('hero-display-level').textContent = hero.level;
            document.getElementById('hero-display-class').textContent = hero.class;

            document.getElementById('hero-level').textContent = hero.level;
            document.getElementById('hero-exp').textContent = hero.exp;
            document.getElementById('exp-to-next-level').textContent = expToNext;

            // Atualiza Level Up Button
            const levelUpBtn = document.getElementById('level-up-button');
            if (hero.exp >= expToNext) {
                levelUpBtn.textContent = `SUBIR DE N√çVEL (PRONTO!)`;
                levelUpBtn.disabled = false;
            } else {
                levelUpBtn.textContent = `SUBIR DE N√çVEL (Falta: ${expToNext - hero.exp} EXP)`;
                levelUpBtn.disabled = true;
            }

            updateResourceDisplay();
        }

        function updateResourceDisplay() {
            const resources = gameState.hero.resources;
            document.getElementById('resource-gold').textContent = resources.gold;
            document.getElementById('resource-energy').textContent = resources.energy;
            document.getElementById('resource-soul').textContent = resources.soul;
        }
        
        function showPanel(panelId) {
            document.querySelectorAll('.content-panel').forEach(panel => {
                panel.style.display = 'none';
            });
            document.getElementById(panelId).style.display = 'block';

            document.querySelectorAll('.sidebar-menu button').forEach(button => {
                button.classList.remove('active');
            });
            document.querySelector(`[data-panel="${panelId}"]`).classList.add('active');
            
            // Atualiza t√≠tulo do painel
            document.getElementById('current-panel-title').textContent = document.querySelector(`[data-panel="${panelId}"]`).textContent;

            // L√≥gica espec√≠fica de renderiza√ß√£o do painel
            if (panelId === 'equipment-panel') renderEquipment();
            if (panelId === 'inventory-panel') renderInventory();
            if (panelId === 'hero-training-panel') renderMissions();
            if (panelId === 'adventure-panel') {
                renderMonsterButtons(); 
                updateAdventurePanel();
            }

            gameState.currentPanel = panelId;
        }

        // ====================================================================
        // IV. L√ìGICA DE CRIA√á√ÉO DE PERSONAGEM
        // ====================================================================

        function renderClassSelection() {
            const container = document.getElementById('class-selection-container');
            container.innerHTML = '';
            for (const key in CLASSES) {
                const classData = CLASSES[key];
                const button = document.createElement('button');
                button.setAttribute('data-class', key);
                // √çcones de classe: Ajuste o caminho se necess√°rio (ex: assets/guerreiro.png)
                button.innerHTML = `<img src="${classData.icon}" alt="${classData.name}"><span>${classData.name}</span>`;
                button.addEventListener('click', () => selectClass(key));
                container.appendChild(button);
            }
            // Limpa os detalhes da classe ao renderizar a sele√ß√£o (apenas se n√£o houver sele√ß√£o pr√©via)
            if (!selectedClass) {
                 document.getElementById('class-detail-name').textContent = "Nenhuma Selecionada";
                 document.getElementById('class-detail-desc').textContent = "Selecione uma classe para ver suas informa√ß√µes, estat√≠sticas base e item inicial.";
                 document.getElementById('class-detail-hp').textContent = "?";
                 document.getElementById('class-detail-atk').textContent = "?";
                 document.getElementById('class-detail-energy').textContent = "?";
            }
        }
        
        function selectClass(className) {
            selectedClass = className;
            const classData = CLASSES[className]; // Obt√©m os dados da classe
            
            // 1. Remove o destaque de todos os bot√µes
            document.querySelectorAll('#class-selection-container button').forEach(btn => {
                btn.classList.remove('selected'); 
            });
            
            // 2. Adiciona o destaque ao bot√£o selecionado
            const selectedBtn = document.querySelector(`button[data-class="${className}"]`);
            if (selectedBtn) {
                selectedBtn.classList.add('selected'); 
            }
            
            // 3. NOVO: Atualiza o painel de detalhes da classe
            if (classData) {
                document.getElementById('class-detail-name').textContent = classData.name;
                document.getElementById('class-detail-desc').textContent = classData.description;
                document.getElementById('class-detail-hp').textContent = classData.baseStats.hp;
                document.getElementById('class-detail-atk').textContent = classData.baseStats.atk;
                document.getElementById('class-detail-energy').textContent = classData.baseStats.energy;
            }

            // 4. Verifica o formul√°rio para habilitar o bot√£o "CONFIRMAR CRIA√á√ÉO"
            checkCreationForm();
        }

        function checkCreationForm() {
            const name = document.getElementById('hero-name').value.trim();
            const confirmBtn = document.getElementById('btn-confirm-creation');
            confirmBtn.disabled = !(name.length > 0 && selectedClass !== null);
        }

        function confirmCharacterCreation() {
            const name = document.getElementById('hero-name').value.trim();
            if (name.length > 0 && selectedClass) {
                const classData = CLASSES[selectedClass];
                
                gameState.hero.name = name;
                gameState.hero.class = classData.name;
                // Aplica as estat√≠sticas base da classe
                gameState.hero.baseStats = { ...classData.baseStats }; 
                
                // Adiciona item inicial (e o equipa)
                if (classData.startingItem) {
                    // Cria uma c√≥pia profunda para garantir IDs √∫nicos
                    const item = JSON.parse(JSON.stringify(classData.startingItem)); 
                    item.id = `start-${Date.now()}`; // Garante ID √∫nico
                    gameState.hero.inventory.push(item);
                    equipItem(item, false); // Equipa sem alertar
                }
                
                gameState.isCharacterCreated = true;
                
                // Transi√ß√£o para a tela principal (CORRIGIDO: Garante que os containers apare√ßam)
                document.getElementById('character-creation-panel').style.display = 'none';
                document.getElementById('start-menu').style.display = 'none';
                document.getElementById('app-wrapper').style.display = 'flex';
                document.getElementById('sidebar').style.display = 'block';
                document.getElementById('main-content').style.display = 'block';

                // Recalcula o HP total para o combate inicial
                const stats = calculateStats();
                currentHP = stats.totalHp;

                updateHeroDisplay();
                renderMissions();
                renderEquipment();
                showPanel('hero-training-panel'); // Garante que o painel inicial seja exibido
                saveGame();
            }
        }

        // ====================================================================
        // V. L√ìGICA DE PROGRESS√ÉO E TREINAMENTO
        // ====================================================================
        
        function checkLevelUp() {
            const hero = gameState.hero;
            const expToNext = getExpRequired(hero.level);
            
            if (hero.exp >= expToNext) {
                const levelUpBtn = document.getElementById('level-up-button');
                levelUpBtn.disabled = false;
                levelUpBtn.textContent = `SUBIR DE N√çVEL (PRONTO!)`;
            }
        }

        function handleLevelUp() {
            const hero = gameState.hero;
            const expToNext = getExpRequired(hero.level);
            
            if (hero.exp >= expToNext) {
                hero.exp -= expToNext;
                hero.level += 1;
                powerLevel = hero.level; // Atualiza o n√≠vel global
                
                // Aumenta as estat√≠sticas base por n√≠vel
                hero.baseStats.hp += 5;
                hero.baseStats.atk += 2;
                hero.baseStats.energy += 10;

                alert(`Parab√©ns! Voc√™ subiu para o N√≠vel ${hero.level}!`);

                updateHeroDisplay();
                renderEquipment(); // Recalcula stats
                checkLevelUp();
                saveGame();
            }
        }
        
        function handlePreparationAction(actionName) {
            const action = gameState.hero.preparation[actionName];
            if (action.inProgress) {
                alert('A√ß√£o j√° est√° em andamento!');
                return;
            }

            if (actionName === 'study') {
                if (gameState.hero.resources.energy < action.costEnergy) {
                    alert('Energia insuficiente para Estudar Magia!');
                    return;
                }
                gameState.hero.resources.energy -= action.costEnergy;
            } else if (actionName === 'blacksmith') {
                if (gameState.hero.resources.gold < action.costGold) {
                    alert('Ouro insuficiente para o Trabalho no Ferreiro!');
                    return;
                }
                gameState.hero.resources.gold -= action.costGold;
            }
            
            action.inProgress = true;
            action.cooldown = action.duration;
            updatePreparationDisplay();
            updateResourceDisplay();
            saveGame();
        }

        function updatePreparationDisplay() {
            const prepActions = gameState.hero.preparation;
            const cooldownsDiv = document.getElementById('preparation-cooldowns');
            cooldownsDiv.innerHTML = '';
            
            for (const actionName in prepActions) {
                const action = prepActions[actionName];
                const button = document.getElementById(`action-${actionName}`);
                
                if (action.inProgress) {
                    button.disabled = true;
                    const cooldownDiv = document.createElement('div');
                    cooldownDiv.style.color = 'var(--color-accent)';
                    cooldownDiv.textContent = `${actionName.charAt(0).toUpperCase() + actionName.slice(1)} em Progresso (${action.cooldown}s restantes)`;
                    cooldownsDiv.appendChild(cooldownDiv);
                } else {
                    button.disabled = false;
                }
            }
        }
        
        function renderMissions() {
            const missionsContainer = document.getElementById('missions-container');
            missionsContainer.innerHTML = '<h4>Miss√µes √önicas</h4>';
            
            // Renderiza miss√µes √∫nicas (tutorial)
            for (const name in gameState.hero.missions) {
                const mission = gameState.hero.missions[name];
                if (mission.completed) continue;
                
                const button = document.createElement('button');
                button.textContent = `Concluir ${name} (Recompensa: ${mission.rewardExp} EXP | ${mission.rewardGold} üí∞)`;
                button.style.cssText = 'background-color: #2c3e50; color: var(--color-text); border: none; padding: 10px 15px; border-radius: 5px; margin-right: 10px; margin-bottom: 10px; cursor: pointer;';
                button.onclick = () => handleMissionComplete(name);
                missionsContainer.appendChild(button);
            }
        }
        
        function handleMissionComplete(missionName) {
            const mission = gameState.hero.missions[missionName];
            if (mission.completed) return;
            
            // L√≥gica de Recompensa (Apenas para miss√µes tutoriais por enquanto)
            gameState.hero.exp += mission.rewardExp;
            gameState.hero.resources.gold += mission.rewardGold;
            
            alert(`Miss√£o '${missionName}' conclu√≠da! Ganho: ${mission.rewardExp} EXP e ${mission.rewardGold} üí∞.`);

            mission.completed = true;
            updateHeroDisplay();
            renderMissions();
            checkLevelUp();
            saveGame();
        }


        // ====================================================================
        // VI. INVENT√ÅRIO E EQUIPAMENTO
        // ====================================================================

        function renderEquipment() {
            const stats = calculateStats();
            
            // 1. Atualiza Estat√≠sticas
            document.getElementById('stat-total-hp').textContent = stats.totalHp;
            document.getElementById('stat-total-atk').textContent = stats.totalAtk;
            document.getElementById('stat-total-energy').textContent = stats.totalEnergy;
            
            // 2. Atualiza Slots de Equipamento
            const slotsContainer = document.getElementById('equipment-slots-container');
            slotsContainer.innerHTML = '';
            
            for (const key in EQUIPMENT_SLOTS) {
                const slot = EQUIPMENT_SLOTS[key];
                const item = slot.currentItem;
                const slotDiv = document.createElement('div');
                slotDiv.className = 'equipment-slot';
                slotDiv.style.cssText = 'padding: 10px; border: 1px solid var(--color-primary); border-radius: 5px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center;';
                
                const itemName = item ? `${item.name} (${item.stats.atk ? `+${item.stats.atk} ATK` : ''} ${item.stats.hp ? `+${item.stats.hp} HP` : ''})` : 'Vazio';
                
                slotDiv.innerHTML = `
                    <span>${slot.name}:</span> 
                    <span class="item-name" style="color: ${item ? 'var(--color-accent)' : '#aaa'};">${itemName}</span>
                `;
                slotsContainer.appendChild(slotDiv);
            }
        }

        function renderInventory() {
            const inventoryContainer = document.getElementById('inventory-items');
            inventoryContainer.innerHTML = '';
            
            gameState.hero.inventory.forEach(item => {
                const card = document.createElement('div');
                // Verifica se o item est√° equipado
                const isEquipped = isItemEquipped(item);
                
                card.className = `inventory-item-card item-rarity-${item.rarity} ${item === inspectedItem ? 'selected' : ''}`;
                card.setAttribute('data-item-id', item.id);
                card.innerHTML = `
                    <p style="margin: 0;">${item.name}</p>
                    <small style="color: ${isEquipped ? 'var(--color-hp)' : '#999'};">
                        [${isEquipped ? 'E' : ''}] ${item.type.toUpperCase()}
                    </small>
                `;
                card.addEventListener('click', () => inspectItem(item));
                inventoryContainer.appendChild(card);
            });
            
            // Se o item inspecionado foi vendido/desequipado, limpa o painel
            if (!inspectedItem || !gameState.hero.inventory.some(i => i.id === inspectedItem.id)) {
                inspectedItem = null;
                // Limpa painel de detalhes
                document.getElementById('item-detail-name').textContent = "Nenhum";
                document.getElementById('item-detail-type').textContent = "?";
                document.getElementById('item-detail-rarity').textContent = "?";
                document.getElementById('item-detail-desc').textContent = "Selecione um item para ver os detalhes.";
                document.getElementById('item-detail-effects').innerHTML = '';
                document.getElementById('btn-equip-item').style.display = 'none';
                document.getElementById('btn-unequip-item').style.display = 'none';
                document.getElementById('btn-sell-item').style.display = 'none';
            } else {
                 // Reinspeciona para garantir que os bot√µes estejam corretos
                 inspectItem(inspectedItem, false);
            }
        }
        
        function isItemEquipped(item) {
             for (const key in EQUIPMENT_SLOTS) {
                if (EQUIPMENT_SLOTS[key].currentItem && EQUIPMENT_SLOTS[key].currentItem.id === item.id) {
                    return true;
                }
            }
            return false;
        }

        function inspectItem(item, shouldRenderInventory = true) {
            inspectedItem = item;

            // Atualiza detalhes
            document.getElementById('item-detail-name').textContent = item.name;
            document.getElementById('item-detail-type').textContent = item.type.toUpperCase();
            document.getElementById('item-detail-rarity').textContent = item.rarity.charAt(0).toUpperCase() + item.rarity.slice(1);
            document.getElementById('item-detail-rarity').className = `item-rarity-${item.rarity}`;
            document.getElementById('item-detail-desc').textContent = item.desc;
            
            let effectsHtml = '';
            if (item.stats) {
                for (const stat in item.stats) {
                    if(item.stats[stat] > 0) {
                        effectsHtml += `<p style="margin: 5px 0; color: var(--color-hp); font-weight: bold;">+${item.stats[stat]} ${stat.toUpperCase()}</p>`;
                    }
                }
            }
            document.getElementById('item-detail-effects').innerHTML = effectsHtml;

            // L√≥gica de Equipar/Desequipar
            const equipBtn = document.getElementById('btn-equip-item');
            const unequipBtn = document.getElementById('btn-unequip-item');
            const sellBtn = document.getElementById('btn-sell-item');
            
            equipBtn.style.display = 'none';
            unequipBtn.style.display = 'none';
            sellBtn.style.display = 'inline-block';
            
            // TODO: Criar l√≥gica de pre√ßo de venda (pode ser baseada na raridade/n√≠vel)
            const sellPrice = item.rarity === 'common' ? 5 : 10;
            sellBtn.textContent = `VENDER (${sellPrice} üí∞)`;
            sellBtn.onclick = () => sellItem(item, sellPrice);


            // Se for um item equip√°vel
            const isEquipable = EQUIPMENT_SLOTS[item.type];
            if (isEquipable) {
                const equipped = isItemEquipped(item);
                if (equipped) {
                    unequipBtn.style.display = 'inline-block';
                    unequipBtn.onclick = () => unequipItem(item);
                } else {
                    equipBtn.style.display = 'inline-block';
                    equipBtn.onclick = () => equipItem(item);
                }
            }
            
            if (shouldRenderInventory) {
                renderInventory();
            } else {
                 document.querySelectorAll('.inventory-item-card').forEach(card => {
                    card.classList.remove('selected');
                });
                const card = document.querySelector(`.inventory-item-card[data-item-id="${item.id}"]`);
                if(card) card.classList.add('selected');
            }
        }
        
        function equipItem(item, showAlert = true) {
            const slotKey = item.type;
            
            if (!EQUIPMENT_SLOTS[slotKey]) {
                if (showAlert) alert(`Tipo de item ${slotKey} n√£o √© equip√°vel.`);
                return;
            }
            
            // 1. Equipa o novo item
            EQUIPMENT_SLOTS[slotKey].currentItem = item;
            
            // 2. Atualiza todos os pain√©is
            renderEquipment();
            renderInventory();
            if (showAlert) inspectItem(item); // Reinspeciona para mostrar "DESEQUIPAR"
            updateHeroDisplay(); // Para atualizar recursos se houver b√¥nus de energia
            saveGame();
            if (showAlert) alert(`${item.name} equipado no slot de ${EQUIPMENT_SLOTS[slotKey].name}.`);
        }
        
        function unequipItem(item) {
            const slotKey = item.type;
            
            if (EQUIPMENT_SLOTS[slotKey].currentItem && EQUIPMENT_SLOTS[slotKey].currentItem.id === item.id) {
                 EQUIPMENT_SLOTS[slotKey].currentItem = null;
                 alert(`${item.name} desequipado.`);
            }
            
            // Atualiza todos os pain√©is
            renderEquipment();
            renderInventory();
            // Reinspeciona para atualizar o bot√£o para "EQUIPAR"
            if (inspectedItem) {
                inspectItem(inspectedItem); 
            }
            updateHeroDisplay(); // Para atualizar recursos se houver b√¥nus de energia
            saveGame();
        }
        
        function sellItem(item, price) {
            // 1. Verifica se o item est√° equipado
            if (isItemEquipped(item)) {
                if (!confirm(`O item ${item.name} est√° equipado. Voc√™ quer desequipar e vend√™-lo por ${price} üí∞?`)) {
                    return;
                }
                unequipItem(item);
            }
            
            // 2. Remove do invent√°rio
            const index = gameState.hero.inventory.findIndex(i => i.id === item.id);
            if (index > -1) {
                gameState.hero.inventory.splice(index, 1);
            }
            
            // 3. Adiciona ouro
            gameState.hero.resources.gold += price;
            
            alert(`${item.name} vendido por ${price} üí∞!`);
            
            // 4. Atualiza a interface
            inspectedItem = null; // Limpa a inspe√ß√£o
            renderInventory();
            updateResourceDisplay();
            saveGame();
        }

        // ====================================================================
        // VII. L√ìGICA DE COMBATE E AVENTURA
        // ====================================================================

        // Fun√ß√£o para renderizar os bot√µes de sele√ß√£o de monstros
        function renderMonsterButtons() {
            const monsterSelectionContainer = document.getElementById('monster-selection-container');
            if (!monsterSelectionContainer) return;

            monsterSelectionContainer.innerHTML = '<h3>Escolha Seu Desafio:</h3><div id="monster-button-area" style="display: flex; flex-wrap: wrap; gap: 10px;"></div>';
            const buttonArea = document.getElementById('monster-button-area');
            
            const heroLevel = gameState.hero.level;
            
            // Encontra os monstros dispon√≠veis para o n√≠vel atual do her√≥i
            const availableMonsters = MONSTERS_BY_LEVEL[heroLevel] || MONSTERS_BY_LEVEL[1] || []; 
            
            if (availableMonsters.length === 0) {
                 monsterSelectionContainer.innerHTML = `<h3 style="color: var(--color-accent);">Voc√™ atingiu o limite da aventura atual (N√≠vel ${heroLevel - 1}). Novo conte√∫do em breve!</h3>`;
                 currentMonster = null;
                 return;
            }

            availableMonsters.forEach((monster) => {
                // Cria um clone do objeto para definir o currentHP
                const monsterData = { ...monster, currentHP: monster.baseHP }; 
                const button = document.createElement('button');
                
                button.innerHTML = `${monster.name} (Lvl ${heroLevel}) | Recompensa: ${monster.expReward} EXP`;
                button.style.cssText = `
                    background-color: var(--color-combat); 
                    color: white; 
                    padding: 8px 15px; 
                    border: none; 
                    border-radius: 5px;
                    cursor: pointer;
                    transition: background-color 0.2s;
                `;
                
                // Define a a√ß√£o de clique para selecionar o monstro
                button.onclick = () => selectMonster(monsterData); 

                buttonArea.appendChild(button);
            });
            
            // Seleciona o primeiro monstro por padr√£o se nenhum estiver selecionado
            if (!currentMonster || currentMonster.level !== heroLevel) {
                 selectMonster({ ...availableMonsters[0], currentHP: availableMonsters[0].baseHP });
            }
        }
        
        // Fun√ß√£o para selecionar o monstro e atualizar a interface de combate
        function selectMonster(monsterData) {
            currentMonster = monsterData; 
            currentMonster.currentHP = currentMonster.baseHP; 
            updateAdventurePanel(); 
            logToCombat(`Monstro selecionado: ${currentMonster.name}. Pronto para a batalha!`);
        }

        function updateAdventurePanel() {
            const startBattleButton = document.getElementById('start-battle-button');
            const heroEnergy = gameState.hero.resources.energy;
            
            if (!currentMonster) {
                document.getElementById('monster-name').textContent = "Nenhum Monstro Dispon√≠vel";
                document.getElementById('monster-hp-display').textContent = "0";
                document.getElementById('monster-atk-display').textContent = "0";
                document.getElementById('monster-reward-exp').textContent = "0"; 
                document.getElementById('monster-reward-gold').textContent = "0"; 
                startBattleButton.textContent = "Nenhum Monstro Aqui"; 
                startBattleButton.disabled = true; 
                return;
            }
            
            // Atualiza informa√ß√µes do monstro
            document.getElementById('monster-name').textContent = currentMonster.name; 
            document.getElementById('monster-hp-display').textContent = currentMonster.currentHP; 
            document.getElementById('monster-atk-display').textContent = currentMonster.atk; 
            document.getElementById('monster-reward-exp').textContent = currentMonster.expReward;
            document.getElementById('monster-reward-gold').textContent = currentMonster.goldReward;
            
            
            startBattleButton.textContent = `Iniciar Batalha! (Custo: ${currentMonster.energyCost} ‚ö°)`;
            
            const hasEnoughEnergy = heroEnergy >= currentMonster.energyCost;
            startBattleButton.disabled = isFighting || !hasEnoughEnergy;
            
            if (isFighting) {
                startBattleButton.textContent = "Em Combate...";
            } else if (!hasEnoughEnergy) {
                startBattleButton.textContent = `Energia Insuficiente (Requer: ${currentMonster.energyCost} ‚ö°)`;
            }

        }

        function logToCombat(message) {
            const log = document.getElementById('combat-log');
            const now = new Date();
            const timeString = now.toLocaleTimeString();
            log.textContent = `[${timeString}] ${message}\n` + log.textContent;
        }

        function startBattle() {
            if (isFighting || !currentMonster) return;
            
            const heroEnergy = gameState.hero.resources.energy;
            if (heroEnergy < currentMonster.energyCost) {
                alert('Energia insuficiente para iniciar a batalha!');
                return;
            }
            
            isFighting = true;
            gameState.hero.resources.energy -= currentMonster.energyCost;
            updateAdventurePanel();
            updateResourceDisplay();
            
            logToCombat(`--- Batalha Iniciada: ${gameState.hero.name} vs ${currentMonster.name} ---`);
            
            // Clone do monstro para o combate
            let monsterHP = currentMonster.baseHP;
            let heroHP = calculateStats().totalHp; 
            const heroATK = calculateStats().totalAtk;
            
            const maxRounds = 10;
            let rounds = 0;
            let battleLog = "";
            let winner = null;

            while (rounds < maxRounds && monsterHP > 0 && heroHP > 0) {
                rounds++;
                
                // Ataque do Her√≥i
                const heroDamage = heroATK; 
                monsterHP -= heroDamage;
                battleLog += `[R${rounds}] Her√≥i ataca! Dano: ${heroDamage}. ${currentMonster.name} HP: ${Math.max(0, monsterHP)}\n`;

                if (monsterHP <= 0) {
                    winner = 'Heroi';
                    break;
                }
                
                // Ataque do Monstro
                const monsterDamage = currentMonster.atk;
                heroHP -= monsterDamage;
                battleLog += `[R${rounds}] ${currentMonster.name} ataca! Dano: ${monsterDamage}. Her√≥i HP: ${Math.max(0, heroHP)}\n`;
                
                if (heroHP <= 0) {
                    winner = 'Monstro';
                    break;
                }
            }

            // Exibe o Log do Combate
            logToCombat(battleLog);

            // Resultados
            if (winner === 'Heroi') {
                logToCombat(`*** VIT√ìRIA! *** Her√≥i derrotou ${currentMonster.name} em ${rounds} rodadas.`);
                gameState.hero.exp += currentMonster.expReward;
                gameState.hero.resources.gold += currentMonster.goldReward;
                logToCombat(`Ganho: ${currentMonster.expReward} EXP e ${currentMonster.goldReward} Ouro.`);
                
                // Verifica e conclui miss√£o de tutorial (se for o primeiro combate)
                if(!gameState.hero.missions.tutorialCombat.completed) {
                    handleMissionComplete('tutorialCombat');
                }
            } else if (winner === 'Monstro') {
                logToCombat(`*** DERROTA! *** Her√≥i foi derrotado por ${currentMonster.name}.`);
                // Penalidade (ex: 50% de perda de EXP da luta)
            } else {
                logToCombat('Combate terminado por limite de rodadas (Empate?).');
            }
            
            isFighting = false;
            currentMonster.currentHP = 0; // Monstro morto ou fugiu
            
            // Recarrega o monstro para a pr√≥xima luta (ou seleciona o pr√≥ximo)
            selectMonster(currentMonster); 
            updateHeroDisplay();
            checkLevelUp();
            saveGame();
        }


        // ====================================================================
        // VIII. SALVAR/CARREGAR
        // ====================================================================

        function saveGame() {
            localStorage.setItem('blazeAndSteelSave', JSON.stringify({
                gameState: gameState,
                equipment: EQUIPMENT_SLOTS, // Salva o estado dos slots
                currentMonster: currentMonster 
            }));
        }

        function loadGame() {
            const savedData = localStorage.getItem('blazeAndSteelSave');
            if (savedData) {
                const data = JSON.parse(savedData);
                
                // 1. Carrega gameState
                gameState = data.gameState;
                powerLevel = gameState.hero.level; 
                
                // 2. Carrega Equipment
                for (const key in data.equipment) {
                    if (EQUIPMENT_SLOTS[key]) {
                        // Garante que o item seja carregado, mesmo que seja null
                        EQUIPMENT_SLOTS[key].currentItem = data.equipment[key].currentItem;
                    }
                }
                
                // 3. Carrega currentMonster
                currentMonster = data.currentMonster;
                
                // 4. Se o her√≥i foi criado, inicia o jogo
                if (gameState.isCharacterCreated) {
                    document.getElementById('start-menu').style.display = 'none';
                    document.getElementById('app-wrapper').style.display = 'flex';
                    document.getElementById('sidebar').style.display = 'block';
                    document.getElementById('main-content').style.display = 'block';
                    
                    // Renderiza√ß√£o inicial
                    updateHeroDisplay();
                    renderEquipment();
                    renderMissions();
                    
                    // Mostra o painel correto
                    showPanel(gameState.currentPanel); 
                }
                
                alert('Jogo carregado com sucesso!');

            } else {
                // Jogo n√£o iniciado
            }
            
            // Atualiza o estado do bot√£o de Carregar Jogo ap√≥s a tentativa de load
            document.getElementById('btn-load-game').disabled = !localStorage.getItem('blazeAndSteelSave');
        }
        
        function clearGame() {
            if (confirm("Tem certeza que deseja DELETAR TODO o seu progresso?")) {
                 localStorage.removeItem('blazeAndSteelSave');
                 location.reload(); // Recarrega a p√°gina para resetar o estado
            }
        }


        // ====================================================================
        // IX. INICIALIZA√á√ÉO
        // ====================================================================

        function initGame() {
            // Eventos do Menu Inicial
            document.getElementById('btn-new-game').addEventListener('click', () => {
                document.getElementById('start-menu').style.display = 'none';
                document.getElementById('character-creation-panel').style.display = 'flex';
                renderClassSelection();
            });
            
            document.getElementById('btn-load-game').addEventListener('click', loadGame);

            document.getElementById('btn-exit-game').addEventListener('click', clearGame); // Usa clearGame como "sair" tempor√°rio

            // Eventos da Cria√ß√£o de Personagem
            document.getElementById('hero-name').addEventListener('input', checkCreationForm);
            document.getElementById('btn-confirm-creation').addEventListener('click', confirmCharacterCreation);

            // Eventos do Menu Lateral
            document.querySelectorAll('.sidebar-menu button').forEach(button => {
                button.addEventListener('click', (e) => showPanel(e.target.dataset.panel));
            });
            
            // Eventos de Treinamento
            document.getElementById('level-up-button').addEventListener('click', handleLevelUp);
            document.getElementById('action-study').addEventListener('click', () => handlePreparationAction('study'));
            document.getElementById('action-blacksmith').addEventListener('click', () => handlePreparationAction('blacksmith'));

            // Evento de Combate
            document.getElementById('start-battle-button').addEventListener('click', startBattle);

            // Loop principal
            setInterval(gameLoop, 1000);
            
            // Carrega o jogo salvo ao iniciar a p√°gina (se houver)
            loadGame();
        }

        function gameLoop() {
            if (!gameState.isCharacterCreated) return;

            // Timer para A√ß√µes de Prepara√ß√£o
            let changed = false;
            for (const actionName in gameState.hero.preparation) {
                const action = gameState.hero.preparation[actionName];
                if (action.inProgress) {
                    action.cooldown -= 1;
                    changed = true;
                    
                    if (action.cooldown <= 0) {
                        action.inProgress = false;
                        
                        // Recompensa
                        if (actionName === 'study') {
                            gameState.hero.resources.gold += action.rewardGold;
                            alert(`Estudo de Magia conclu√≠do! Ganho: ${action.rewardGold} üí∞.`);
                        } else if (actionName === 'blacksmith') {
                            gameState.hero.resources.energy += action.rewardEnergy;
                            alert(`Trabalho no Ferreiro conclu√≠do! Ganho: ${action.rewardEnergy} ‚ö°.`);
                        }
                    }
                }
            }
            
            if (changed) {
                updatePreparationDisplay();
                updateResourceDisplay();
                saveGame();
            }

        }


        // Inicia o jogo ao carregar a p√°gina
        window.onload = initGame;
    </script>

</body>
</html>
