<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BLAZE AND STEEL - O JOGO RPG</title>
    <style>
        /* Vari√°veis de Cores (CSS Custom Properties) */
        :root {
            --color-primary: #1e1e2d;
            --color-secondary: #36364f;
            --color-text: #e0e0e0;
            --color-accent: #f39c12; /* Ouro */
            --color-combat: #c0392b; /* Combate/Aventura */
            --color-evolve: #8e44ad; /* Evoluir/Treinamento */
            --color-energy: #3498db; /* Energia */
            --color-soul: #9b59b6; /* Alma/Reencarna√ß√£o */
            --color-hp: #2ecc71; /* HP/Vida */
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--color-primary);
            color: var(--color-text);
            margin: 0;
            display: flex;
            min-height: 100vh;
            overflow: hidden; 
        }

        /* Estrutura Geral */
        #game-container {
            display: flex;
            width: 100%;
        }

        /* Menu Lateral (Sidebar) */
        #sidebar {
            width: 250px;
            background-color: var(--color-secondary);
            padding: 20px 10px;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #hero-info, #stats-summary {
            width: 100%;
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 5px;
            background-color: rgba(0, 0, 0, 0.2);
        }

        #stats-summary p {
            margin: 5px 0;
            font-size: 0.9em;
        }

        /* Bot√µes de Navega√ß√£o */
        #navigation-menu button {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            background-color: var(--color-accent);
            color: var(--color-primary);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.2s;
        }

        #navigation-menu button:hover {
            background-color: #e67e22;
        }

        /* √Årea de Conte√∫do (Main Content) */
        #content-area {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            max-height: 100vh;
        }

        /* Pain√©is de Conte√∫do */
        .content-panel {
            background-color: var(--color-secondary);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .content-panel h3 {
            border-bottom: 1px solid var(--color-accent);
            padding-bottom: 5px;
            margin-top: 0;
            color: var(--color-accent);
        }

        /* Estilos de Combate */
        #combat-panel button {
            padding: 15px 25px;
            background-color: var(--color-combat);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            margin-top: 10px;
            transition: background-color 0.2s;
        }

        #combat-panel button:hover {
            background-color: #a5281b;
        }

        /* Estilo para barra de progresso (HP e EXP) */
        .progress-bar {
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            overflow: hidden;
            height: 18px;
            margin-top: 5px;
        }

        .progress-fill {
            height: 100%;
            transition: width 0.3s;
            text-align: center;
            color: white;
            font-weight: bold;
            line-height: 18px;
        }

        #exp-bar .progress-fill { background-color: var(--color-evolve); }
        #hp-bar .progress-fill { background-color: var(--color-hp); }

        /* Estilos para o Invent√°rio e Equipamento */
        #inventory-grid, #equipment-slots {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .item-slot, .equipment-slot {
            width: 60px;
            height: 60px;
            background-color: var(--color-primary);
            border: 2px solid var(--color-secondary);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
        }

        .item-slot.full {
            border-color: var(--color-accent);
        }

        .item-slot.rarity-Comum { border-color: #ffffff; }
        .item-slot.rarity-Raro { border-color: var(--color-energy); }
        .item-slot.rarity-√âpico { border-color: var(--color-evolve); }

        .equipment-slot {
            width: 70px;
            height: 70px;
            border: 2px dashed var(--color-text);
            flex-direction: column;
            font-size: 0.7em;
            text-align: center;
        }

        .item-slot img {
            width: 50px;
            height: 50px;
            object-fit: contain;
        }
        
        .item-slot .item-quantity {
            position: absolute;
            bottom: 0;
            right: 2px;
            background: rgba(0, 0, 0, 0.7);
            padding: 0 3px;
            border-radius: 3px;
            font-size: 0.8em;
        }

        /* Estilos para o Painel de Cria√ß√£o */
        #class-selection-grid {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 20px;
        }

        .class-card {
            background-color: var(--color-primary);
            border: 2px solid var(--color-secondary);
            border-radius: 8px;
            padding: 15px;
            width: 200px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s, border-color 0.2s;
        }

        .class-card:hover {
            transform: translateY(-5px);
            border-color: var(--color-accent);
        }

        .class-card.selected {
            border-color: var(--color-evolve);
            box-shadow: 0 0 15px var(--color-evolve);
        }

        .class-card img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 50%;
            margin-bottom: 10px;
        }
        
        /* Estilos de Bot√£o de Status */
        #primary-stats-container button {
            background-color: var(--color-evolve); 
            color: white; 
            padding: 5px 10px; 
            margin-left: 10px; 
            border: none; 
            border-radius: 3px; 
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.2s;
        }
        
        #primary-stats-container button:hover:not(:disabled) {
            background-color: #a55aed;
        }
        
        #primary-stats-container button:disabled {
            background-color: #5d3470;
            cursor: not-allowed;
        }
        
    </style>
</head>
<body>

<div id="game-container">
    
    <div id="sidebar">
        <div id="hero-info">
            <h3 id="hero-name-display">Novo Her√≥i</h3>
            <p>N√≠vel: <span id="power-level-display">1</span></p>
            <p>EXP:</p>
            <div id="exp-bar" class="progress-bar"><div class="progress-fill" style="width: 0%;">0/50</div></div>
        </div>

        <div id="stats-summary">
            <h3>Estat√≠sticas R√°pidas</h3>
            <p>‚ù§Ô∏è HP: <span id="hp-current-display">10</span>/<span id="hp-max-display">10</span></p>
            <div id="hp-bar" class="progress-bar"><div class="progress-fill" style="width: 100%;">100%</div></div>
            <p>‚öîÔ∏è ATK: <span id="atk-display">1</span></p>
            <p>üí∞ Gold: <span id="gold-display">0</span></p>
            <p>üåå Soul: <span id="soul-display">0</span></p>
        </div>

        <div id="navigation-menu">
            <button onclick="showPanel('combat-panel')">Aventura (Combate)</button>
            <button onclick="showPanel('status-panel')">Atributos (Status)</button>
            <button onclick="showPanel('inventory-panel')">Invent√°rio</button>
            <button onclick="showPanel('equipment-panel')">Equipamento</button>
            <button onclick="showPanel('shop-panel')">Loja</button>
            <button onclick="saveGame(true)">Salvar Jogo</button>
            <button onclick="deleteGame(true)" style="background-color: var(--color-combat);">Reiniciar Jogo</button>
        </div>
    </div>

    <div id="content-area">

        <div id="creation-panel" style="display: none;">
            <h1>Bem-vindo a Blaze and Steel!</h1>
            <div class="content-panel">
                <h3>Passo 1: Nomeie seu Her√≥i</h3>
                <input type="text" id="hero-name-input" placeholder="Digite o nome do seu her√≥i..." style="width: 100%; padding: 10px; font-size: 1.1em; margin-bottom: 20px; box-sizing: border-box;">
                
                <h3>Passo 2: Escolha sua Classe</h3>
                <div id="class-selection-grid">
                    <div class="class-card" data-class="warrior" onclick="selectClass('warrior')">
                        <img src="image_6309cc.jpg" alt="Guerreiro">
                        <strong>Guerreiro</strong>
                    </div>
                    <div class="class-card" data-class="archer" onclick="selectClass('archer')">
                        <img src="image_631587.png" alt="Arqueiro">
                        <strong>Arqueiro</strong>
                    </div>
                    <div class="class-card" data-class="mage" onclick="selectClass('mage')">
                        <img src="image_63192f.png" alt="Mago">
                        <strong>Mago</strong>
                    </div>
                     <div class="class-card" data-class="assassin" onclick="selectClass('assassin')">
                        <img src="image_0b9ca2.jpg" alt="Assassino">
                        <strong>Assassino</strong>
                    </div>
                </div>
            </div>
            
            <div id="class-details-panel" class="content-panel" style="display: none;">
                <h3>Detalhes da Classe: <span id="selected-class-name"></span></h3>
                <p id="class-description"></p>
                
                <h4>Estat√≠sticas Iniciais</h4>
                <p><strong>FOR/AGI/VIT:</strong> <span id="class-base-hp"></span></p>
                <p><strong>INT/DES/SOR:</strong> <span id="class-base-atk"></span></p>
                <p><strong>Energia Inicial:</strong> <span id="class-initial-energy"></span></p>
                
                <button onclick="finalizeCreation()" style="background-color: var(--color-evolve); padding: 10px 20px; font-size: 1.1em; margin-top: 15px; width: 100%;">COME√áAR JOGO</button>
            </div>
        </div>

        <div id="combat-panel" style="display: none;">
            <h1>üó∫Ô∏è Aventurar-se</h1>
            <div class="content-panel">
                <h3>Treinamento Cont√≠nuo</h3>
                <p>Voc√™ precisa de <span id="energy-needed-display">0</span> de Energia para o pr√≥ximo ataque/a√ß√£o.</p>
                <p>Energia atual: <span id="energy-display">0</span></p>
                <button onclick="performAction()">ATACAR / PROGREDIR</button>
                <p id="combat-log" style="margin-top: 15px; padding: 10px; background-color: rgba(0, 0, 0, 0.3); border-radius: 5px;">Aguardando a√ß√£o...</p>
            </div>
            
            <div class="content-panel">
                <h3>Miss√µes Ativas</h3>
                <p>Voc√™ est√° atualmente em: <span id="current-quest-display">Nenhuma</span>.</p>
                <p>Derrote 50 inimigos do tipo 'Goblins' para ganhar uma recompensa.</p>
            </div>
        </div>
        
        <div id="status-panel" style="display: none;">
            <h2>üë§ Atributos do Her√≥i</h2>
            
            <div class="content-panel" style="text-align: center;">
                <p style="font-size: 1.2em; font-weight: bold; color: var(--color-evolve);">
                    Pontos Dispon√≠veis: <span id="stat-points-display">0</span>
                </p>
                <p style="font-style: italic;">
                    Gaste seus pontos para aumentar seus atributos e poder!
                </p>
            </div>

            <div class="content-panel" id="primary-stats-container">
                </div>
            
            <div class="content-panel">
                <h3>Estat√≠sticas Calculadas (Totais)</h3>
                <p>‚ù§Ô∏è **HP M√°ximo:** <span id="total-max-hp-display">0</span></p>
                <p>‚öîÔ∏è **ATK F√≠sico Total:** <span id="total-atk-display">0</span></p>
                <p>‚ú® **ATK M√°gico Total:** <span id="total-matk-display">0</span></p>
                <p>üõ°Ô∏è **DEF F√≠sica (Soft):** <span id="total-def-display">0</span></p>
                <p>üîÆ **DEF M√°gica (Soft):** <span id="total-mdef-display">0</span></p>
                <p>üí® **Esquiva:** <span id="total-evasion-display">0</span></p>
                <p>üéØ **Precis√£o:** <span id="total-hit-display">0</span></p>
                <p>üí• **Cr√≠tico:** <span id="total-crit-display">0</span>%</p>
            </div>
        </div>

        <div id="inventory-panel" style="display: none;">
            <h1>üéí Invent√°rio</h1>
            <div class="content-panel">
                <h3>Itens (Capacidade: 50)</h3>
                <div id="inventory-grid">
                    </div>
            </div>

            <div id="item-inspection-panel" class="content-panel" style="display: none;">
                <h3>Detalhes do Item: <span id="inspected-item-name"></span></h3>
                <p>Raridade: <span id="inspected-item-rarity"></span></p>
                <p>Tipo: <span id="inspected-item-type"></span></p>
                <p>Descri√ß√£o: <span id="inspected-item-description"></span></p>
                <p id="inspected-item-stats"></p>
                <button id="equip-unequip-button" onclick="" style="background-color: var(--color-accent); padding: 8px 15px; margin-top: 10px;">Equipar</button>
            </div>
        </div>

        <div id="equipment-panel" style="display: none;">
            <h1>‚öôÔ∏è Equipamento</h1>
            <div class="content-panel">
                <div id="equipment-slots">
                    </div>
            </div>
        </div>
        
        <div id="shop-panel" style="display: none;">
            <h1>üõçÔ∏è Loja da Cidade</h1>
            <div class="content-panel">
                <h3>Itens em Destaque (Compre com Gold)</h3>
                <div id="shop-items-display">
                    </div>
            </div>
        </div>
        
    </div>
</div>

<script>
    // Flag de Jogo Iniciado
    let gameInitialized = false;
    let selectedClass = null;
    let inspectedItem = null;

    // ====================================================================
    // I. VARI√ÅVEIS GLOBAIS E ESTRUTURAS DE DADOS
    // ====================================================================

    // VARI√ÅVEIS DO JOGO (Status, N√≠vel, Recursos)
    let heroName = "Her√≥i Desconhecido";
    let powerLevel = 1;
    let currentExp = 0;
    let expToNextLevel = 50;
    let energy = 0;
    let gold = 0;
    let soul = 0;

    // === ATRIBUTOS PRINCIPAIS (NOVOS) ===
    let availableStatPoints = 0; // Pontos para distribuir ao subir de n√≠vel
    let FOR = 1; // For√ßa
    let AGI = 1; // Agilidade
    let VIT = 1; // Vitalidade
    let INT = 1; // Intelig√™ncia
    let DES = 1; // Destreza
    let SOR = 1; // Sorte

    // VARI√ÅVEIS DE COMBATE E ESTAT√çSTICAS CALCULADAS
    let heroCurrentHP = 10; // HP Atual (din√¢mico)
    let heroMaxHP = 10; // HP M√°ximo (calculado)
    let heroTotalATK = 1; // ATK Total (calculado)
    let heroTotalMATK = 0; // ATQM Total (calculado)
    let heroTotalDEF = 0; // DEF Soft (calculado)
    let heroTotalMDEF = 0; // DEFM Soft (calculado)
    let heroTotalEvasion = 0; // Esquiva (calculado)
    let heroTotalHit = 0; // Precis√£o (calculado)
    let heroTotalCrit = 0; // Cr√≠tico (calculado)

    // VARI√ÅVEIS DE UPGRADES (Manter por compatibilidade de save)
    let energyPerClick = 1;
    let atkUpgradeCost = 50;
    let hpUpgradeCost = 50;

    // Estrutura do Invent√°rio (Inicia Vazio para o Novo Jogo)
    let inventory = [];

    // Estrutura de Classes do Personagem (ATUALIZADA com atributos)
    const CLASSES = {
        warrior: {
            name: "Guerreiro",
            description: "Especialista em combate corpo-a-corpo, focado em vida e dano balanceado.",
            initialEnergy: 50,
            imagePath: "image_6309cc.jpg",
            // Atributos Iniciais (foco em FOR e VIT)
            initialStats: { FOR: 10, AGI: 5, VIT: 8, INT: 1, DES: 3, SOR: 3 },
            startingItems: [ 
                { id: 1, name: "Espada Curta", type: "weapon", atk: 2, rarity: "Comum", description: "Uma l√¢mina b√°sica de treinamento." }, 
                { id: 2, name: "Armadura de Couro", type: "armor", hpBonus: 10, rarity: "Comum", description: "Prote√ß√£o leve e confi√°vel." } 
            ]
        },
        archer: {
            name: "Arqueiro",
            description: "Mestre em combate a longa dist√¢ncia, focando em precis√£o e velocidade.",
            initialEnergy: 50,
            imagePath: "image_631587.png",
            // Atributos Iniciais (foco em DES e AGI)
            initialStats: { FOR: 3, AGI: 8, VIT: 3, INT: 1, DES: 10, SOR: 5 },
            startingItems: [ 
                { id: 5, name: "Arco Curto", type: "weapon", atk: 3, rarity: "Comum", description: "Um arco simples para iniciantes." }, 
                { id: 2, name: "Armadura de Couro", type: "armor", hpBonus: 10, rarity: "Comum", description: "Prote√ß√£o leve e confi√°vel." } 
            ]
        },
        mage: {
            name: "Mago",
            description: "Fr√°gil, mas com alto potencial de dano m√°gico e grande reserva de energia.",
            initialEnergy: 150,
            imagePath: "image_63192f.png",
            // Atributos Iniciais (foco em INT e DES)
            initialStats: { FOR: 1, AGI: 3, VIT: 5, INT: 10, DES: 8, SOR: 3 },
            startingItems: [ 
                { id: 3, name: "Cajado de Madeira", type: "weapon", atk: 1, energyBonus: 50, rarity: "Comum", description: "Um cajado simples para canalizar magia." }, 
                { id: 4, name: "Manto de Pano", type: "armor", hpBonus: 5, energyBonus: 5, rarity: "Comum", description: "Um manto b√°sico para prote√ß√£o e foco." } 
            ]
        },
        assassin: {
            name: "Assassino",
            description: "√Ågil e mortal, capaz de desferir ataques cr√≠ticos e desviar de golpes com facilidade.",
            initialEnergy: 75,
            imagePath: "image_0b9ca2.jpg",
            // Atributos Iniciais (foco em AGI e SOR)
            initialStats: { FOR: 5, AGI: 10, VIT: 3, INT: 1, DES: 5, SOR: 8 },
            startingItems: [ 
                { id: 6, name: "Katars de Treinamento", type: "weapon", atk: 4, rarity: "Comum", description: "L√¢minas duplas para velocidade e precis√£o." }, 
                { id: 2, name: "Armadura de Couro", type: "armor", hpBonus: 10, rarity: "Comum", description: "Prote√ß√£o leve e confi√°vel." } 
            ]
        }
    };
    
    // Slots de Equipamento
    const EQUIPMENT_SLOTS = {
        weapon: { name: "Arma", currentItem: null },
        armor: { name: "Armadura", currentItem: null },
        // ... outros slots, se houver
    };

    // Itens da Loja
    const SHOP_ITEMS = [
        { id: 10, name: "Po√ß√£o de HP", type: "consumable", effect: { hp: 50 }, price: 20, rarity: "Comum", description: "Restaura uma pequena quantidade de vida." },
        { id: 11, name: "Amuleto B√°sico", type: "accessory", atk: 2, hpBonus: 5, price: 100, rarity: "Raro", description: "Um pequeno b√¥nus em ATK e HP." },
    ];


    // ====================================================================
    // II. FUN√á√ïES DE DISPLAY E NAVEGA√á√ÉO
    // ====================================================================

    function showPanel(panelId) {
        // Oculta todos os pain√©is
        document.querySelectorAll('#content-area > div').forEach(panel => {
            panel.style.display = 'none';
        });
        // Exibe o painel solicitado
        const panel = document.getElementById(panelId);
        if (panel) {
            panel.style.display = 'block';
        }
    }

    function updateDisplay() {
        // === ATUALIZA√á√ÉO PARA C√ÅLCULO DE STATUS ===
        calculateStats(); // 1. Garante que os stats secund√°rios estejam atualizados
        renderStatusPanel(); // 2. Renderiza o painel de Status
        // =========================================

        // Recursos
        document.getElementById('power-level-display').textContent = powerLevel;
        document.getElementById('gold-display').textContent = gold;
        document.getElementById('soul-display').textContent = soul;
        document.getElementById('energy-display').textContent = energy;
        document.getElementById('hero-name-display').textContent = heroName;

        // EXP Bar
        const expPercentage = Math.min(100, (currentExp / expToNextLevel) * 100);
        document.getElementById('exp-bar').querySelector('.progress-fill').style.width = `${expPercentage}%`;
        document.getElementById('exp-bar').querySelector('.progress-fill').textContent = `${currentExp}/${expToNextLevel}`;
        
        // HP Bar
        const hpPercentage = Math.min(100, (heroCurrentHP / heroMaxHP) * 100);
        document.getElementById('hp-bar').querySelector('.progress-fill').style.width = `${hpPercentage}%`;
        document.getElementById('hp-bar').querySelector('.progress-fill').textContent = `${heroCurrentHP}/${heroMaxHP}`;
        document.getElementById('hp-current-display').textContent = heroCurrentHP;
        document.getElementById('hp-max-display').textContent = heroMaxHP;
        
        // Stats de Combate no Menu Lateral
        document.getElementById('atk-display').textContent = heroTotalATK;
        
        // Combat Panel
        document.getElementById('energy-needed-display').textContent = energyPerClick;
        
        // Inventory and Equipment
        renderInventory();
        renderEquipment();
        renderShop();

        // Controla qual painel mostrar
        if (!gameInitialized) {
            showPanel('creation-panel');
        } else {
            // Garante que o painel principal esteja vis√≠vel ap√≥s o load/start
            if (document.getElementById('creation-panel').style.display === 'none') {
                 // Mant√©m o painel atual ou volta para combate se nenhum estiver ativo
                 const visiblePanel = Array.from(document.querySelectorAll('#content-area > div')).find(p => p.style.display === 'block');
                 if (!visiblePanel) {
                    showPanel('combat-panel');
                 }
            }
        }
    }

    // ====================================================================
    // III. CRIA√á√ÉO DE PERSONAGEM
    // ====================================================================

    function selectClass(clsKey) {
        // Remove a sele√ß√£o de todas as cards
        document.querySelectorAll('.class-card').forEach(card => {
            card.classList.remove('selected');
        });

        // Adiciona a sele√ß√£o √† card clicada
        const selectedCard = document.querySelector(`.class-card[data-class="${clsKey}"]`);
        if (selectedCard) {
            selectedCard.classList.add('selected');
        }

        // Exibe os detalhes
        const cls = CLASSES[clsKey];
        selectedClass = clsKey;
        
        document.getElementById('selected-class-name').textContent = cls.name;
        document.getElementById('class-description').textContent = cls.description;
        
        // ATUALIZA√á√ÉO: Exibir Atributos Iniciais
        document.getElementById('class-base-hp').innerHTML = `${cls.initialStats.FOR} (FOR), ${cls.initialStats.AGI} (AGI), ${cls.initialStats.VIT} (VIT)`;
        document.getElementById('class-base-atk').innerHTML = `${cls.initialStats.INT} (INT), ${cls.initialStats.DES} (DES), ${cls.initialStats.SOR} (SOR)`;
        
        document.getElementById('class-initial-energy').textContent = cls.initialEnergy;
        
        document.getElementById('class-details-panel').style.display = 'block';
    }

    function finalizeCreation() {
        const nameInput = document.getElementById('hero-name-input').value.trim();
        if (!nameInput || !selectedClass) {
            alert("Por favor, digite o nome do seu her√≥i e selecione uma classe.");
            return;
        }

        const cls = CLASSES[selectedClass];
        
        // 1. Resetar vari√°veis e definir status iniciais
        heroName = nameInput;
        powerLevel = 1;
        currentExp = 0;
        expToNextLevel = 50;
        energy = cls.initialEnergy; 
        gold = 0;
        soul = 0;
        availableStatPoints = 0; 
        
        // NOVO: Define os atributos baseados na classe
        FOR = cls.initialStats.FOR;
        AGI = cls.initialStats.AGI;
        VIT = cls.initialStats.VIT;
        INT = cls.initialStats.INT;
        DES = cls.initialStats.DES;
        SOR = cls.initialStats.SOR;
        
        // HP e ATK iniciais s√£o definidos pelos atributos
        calculateStats(); // Calcula o heroMaxHP e heroTotalATK com os novos atributos
        heroCurrentHP = heroMaxHP; // HP atual come√ßa no m√°ximo

        // 2. Itens Iniciais
        inventory = [];
        for (const slotKey in EQUIPMENT_SLOTS) {
             EQUIPMENT_SLOTS[slotKey].currentItem = null;
        }
        cls.startingItems.forEach(item => {
            addItemToInventory(item, 1, false); 
            // Equipamento inicial deve ser equipado ap√≥s ser adicionado ao invent√°rio
            if(item.type === 'weapon' || item.type === 'armor') {
                equipItem(item, false);
            }
        });


        // 3. Inicia o Jogo
        gameInitialized = true;
        showPanel('combat-panel');
        saveGame();
        updateDisplay();
        alert(`O her√≥i ${heroName}, o ${cls.name}, come√ßou sua aventura!`);
    }

    // ====================================================================
    // IV. FUN√á√ïES DE ATRIBUTOS E C√ÅLCULO DE STATUS (NOVO SISTEMA)
    // ====================================================================

    /**
     * Calcula todos os atributos secund√°rios (ATK, HP Max, DEF, etc.)
     * com base nos atributos principais (FOR, AGI, VIT, INT, DES, SOR)
     * e nos b√¥nus de equipamento.
     */
    function calculateStats() {
        // 1. Inicializa√ß√£o de Valores Base
        let baseHP = 100; // HP Base Fixo (Ajuste se necess√°rio)
        let baseATK_Status = 0; // ATQ dado pelos atributos (Status ATK)
        let baseMATK_Status = 0; // ATQM dado pelos atributos (Status MATK)
        let softDEF = 0;
        let softMDEF = 0;
        let evasion = 0;
        let hit = 0;
        let crit = 0; 

        // 2. Aplica√ß√µes por Atributo (Seguindo as regras fornecidas)

        // FOR√áA (FOR)
        baseATK_Status += FOR * 1; // Ataque f√≠sico base +1 por FOR (Curta dist√¢ncia)

        // AGI
        evasion += AGI * 1; // Esquiva +1 por AGI
        softDEF += Math.floor(AGI / 5) * 1; // Defesa f√≠sica b√°sica +1 a cada 5 AGI

        // VITALIDADE (VIT)
        baseHP *= (1 + VIT / 100); // HP m√°ximo +1% por VIT (multiplicativo)
        softDEF += Math.floor(VIT / 2) * 1; // Defesa f√≠sica base +1 a cada 2 VIT
        softMDEF += Math.floor(VIT / 5) * 1; // Defesa m√°gica base +1 a cada 5 VIT

        // INTELIG√äNCIA (INT)
        baseMATK_Status += INT * 1.5; // Ataque m√°gico base +1,5 por INT
        softMDEF += Math.floor(INT / 2) * 1; // Defesa m√°gica base +1 a cada 2 INT

        // DESTREZA (DES)
        hit += DES * 1; // Precis√£o +1 por DES
        baseATK_Status += Math.floor(DES / 5) * 1; // ATQ f√≠sico base (curta dist√¢ncia) +1 a cada 5 DES
        baseMATK_Status += Math.floor(DES / 5) * 1; // ATQ m√°gico base +1 a cada 5 DES
        softMDEF += Math.floor(DES / 5) * 1; // Defesa m√°gica base +1 a cada 5 DES

        // SORTE (SOR)
        crit = Math.floor(SOR * 0.3); // CRIT = (SOR * 0,3) + Modificadores (Regra prim√°ria)
        baseATK_Status += Math.floor(SOR / 3) * 1; // ATQ f√≠sico base +1 a cada 3 SOR
        baseMATK_Status += Math.floor(SOR / 3) * 1; // ATQ m√°gico base +1 a cada 3 SOR
        hit += Math.floor(SOR / 3) * 1; // Precis√£o +1 a cada 3 SOR
        evasion += Math.floor(SOR / 5) * 1; // Esquiva +1 a cada 5 SOR
        crit += Math.floor(SOR / 3) * 1; // Cr√≠tico +1 a cada 3 SOR (Regra secund√°ria)
        
        // 3. B√¥nus por Equipamento
        let equipBonusATK = 0;
        let equipBonusHP = 0;
        let weaponATK = 0;

        for (const slotKey in EQUIPMENT_SLOTS) {
            const item = EQUIPMENT_SLOTS[slotKey].currentItem;
            if (item) {
                equipBonusHP += item.hpBonus || 0;
                if (item.type === 'weapon') {
                    weaponATK = item.atk || 0;
                } else {
                    // Outros b√¥nus de ATK (ATQ de Equipamentos)
                    equipBonusATK += item.atk || 0;
                }
            }
        }
        
        // 4. B√¥nus por N√≠vel (Simplificado)
        // O aumento do HP leva em considera√ß√£o o n√≠vel de base
        const levelHPBonus = powerLevel * 50; 
        
        // 5. C√°lculo Final de Status

        // ATK Total = (Status ATK) + (ATQ de Equipamentos) + (ATQ da Arma)
        heroTotalATK = baseATK_Status + equipBonusATK + weaponATK; 
        
        heroTotalMATK = baseMATK_Status; // Simplificado
        heroMaxHP = Math.floor(baseHP + levelHPBonus + equipBonusHP);
        heroTotalDEF = softDEF; 
        heroTotalMDEF = softMDEF;
        heroTotalEvasion = evasion;
        heroTotalHit = hit;
        heroTotalCrit = crit;

        // Garante que o HP atual n√£o ultrapasse o m√°ximo
        heroCurrentHP = Math.min(heroCurrentHP, heroMaxHP);
    }

    /**
     * Aumenta um atributo e gasta 1 ponto dispon√≠vel.
     * @param {string} statType - A chave do atributo (FOR, AGI, etc.)
     */
    function increaseStat(statType) {
        if (availableStatPoints <= 0) {
            alert("Voc√™ n√£o tem pontos de atributo dispon√≠veis.");
            return;
        }
        
        // Aloca o ponto (Usando a sintaxe window[statType] para acessar a vari√°vel global)
        switch(statType) {
            case 'FOR': FOR++; break;
            case 'AGI': AGI++; break;
            case 'VIT': VIT++; break;
            case 'INT': INT++; break;
            case 'DES': DES++; break;
            case 'SOR': SOR++; break;
            default: return;
        }
        
        availableStatPoints--;
        
        // Recalcula e atualiza o display
        calculateStats();
        saveGame();
    }

    /**
     * Renderiza o painel de Status e os bot√µes de distribui√ß√£o de pontos.
     */
    function renderStatusPanel() {
        // Atualiza Stats Calculados no painel HTML
        document.getElementById('stat-points-display').textContent = availableStatPoints;
        document.getElementById('total-max-hp-display').textContent = heroMaxHP;
        document.getElementById('total-atk-display').textContent = heroTotalATK;
        document.getElementById('total-matk-display').textContent = heroTotalMATK;
        document.getElementById('total-def-display').textContent = heroTotalDEF;
        document.getElementById('total-mdef-display').textContent = heroTotalMDEF;
        document.getElementById('total-evasion-display').textContent = heroTotalEvasion;
        document.getElementById('total-hit-display').textContent = heroTotalHit;
        document.getElementById('total-crit-display').textContent = heroTotalCrit;

        const statsContainer = document.getElementById('primary-stats-container');
        statsContainer.innerHTML = '<h3>Atributos Principais</h3>';
        
        const stats = [
            { key: 'FOR', name: 'For√ßa' },
            { key: 'AGI', name: 'Agilidade' },
            { key: 'VIT', name: 'Vitalidade' },
            { key: 'INT', name: 'Intelig√™ncia' },
            { key: 'DES', name: 'Destreza' },
            { key: 'SOR', name: 'Sorte' }
        ];
        
        stats.forEach(stat => {
            const value = window[stat.key]; // Acessa a vari√°vel global (FOR, AGI, etc.)
            const statLine = document.createElement('p');
            
            statLine.innerHTML = `
                <strong>${stat.name} (${stat.key}):</strong> ${value} 
                <button onclick="increaseStat('${stat.key}')" 
                        ${availableStatPoints <= 0 ? 'disabled' : ''}>
                    +1
                </button>
            `;
            statsContainer.appendChild(statLine);
        });
    }

    // ====================================================================
    // V. FUN√á√ïES DE JOGO (A√á√ÉO, N√çVEL)
    // ====================================================================

    function performAction() {
        if (!gameInitialized) return;
        
        if (energy >= energyPerClick) {
            energy -= energyPerClick;
            const expGained = 10;
            const goldGained = 5;
            currentExp += expGained;
            gold += goldGained;
            
            document.getElementById('combat-log').textContent = `Voc√™ atacou um monstro, ganhou ${expGained} EXP e ${goldGained} Gold.`;
            
            if (currentExp >= expToNextLevel) {
                levelUp();
            }
            
            updateDisplay();
            saveGame();
        } else {
            document.getElementById('combat-log').textContent = "Energia insuficiente. Descanse ou compre po√ß√µes!";
        }
    }

    function levelUp() {
        if (currentExp < expToNextLevel) {
            return; 
        }
        
        powerLevel++;
        currentExp -= expToNextLevel;
        expToNextLevel = Math.round(expToNextLevel * 1.5);
        
        // NOVO: Ganha pontos de atributo
        const pointsGained = 5; // 5 pontos por n√≠vel
        availableStatPoints += pointsGained;
        
        alert(`üéâ Voc√™ subiu para o N√≠vel ${powerLevel} e ganhou ${pointsGained} pontos de atributo!`);
        
        // Garante que o HP √© restaurado e o novo maxHP √© calculado
        calculateStats(); 
        heroCurrentHP = heroMaxHP;

        updateDisplay();
        saveGame();
    }
    
    // Simula√ß√£o de regenera√ß√£o de energia
    setInterval(() => {
        if (gameInitialized) {
            energy = Math.min(energy + 1, 200); // Limite de 200 de energia
            updateDisplay();
        }
    }, 5000); // Regenera 1 energia a cada 5 segundos


    // ====================================================================
    // VI. INVENT√ÅRIO E EQUIPAMENTO
    // ====================================================================

    function addItemToInventory(item, quantity = 1, showAlert = true) {
        // L√≥gica de adicionar item...
        const existingItem = inventory.find(i => i.id === item.id);
        if (existingItem) {
            existingItem.quantity += quantity;
        } else {
            inventory.push({ ...item, quantity: quantity });
        }
        renderInventory();
        saveGame();
        if (showAlert) alert(`${item.name} (${quantity}) adicionado ao invent√°rio.`);
    }

    function removeItemFromInventory(item, quantity = 1) {
        // L√≥gica de remover item...
        const index = inventory.findIndex(i => i.id === item.id);
        if (index !== -1) {
            if (inventory[index].quantity > quantity) {
                inventory[index].quantity -= quantity;
            } else {
                inventory.splice(index, 1);
            }
            renderInventory();
            saveGame();
            return true;
        }
        return false;
    }

    function renderInventory() {
        const grid = document.getElementById('inventory-grid');
        grid.innerHTML = '';
        inventory.forEach(item => {
            const slot = document.createElement('div');
            slot.className = `item-slot full rarity-${item.rarity.replace(/ /g, '')}`;
            slot.title = item.name;
            slot.onclick = () => inspectItem(item);
            
            // Simula√ß√£o de √≠cone (usando texto/emoji ou uma imagem simples)
            slot.innerHTML = `
                <span style="font-size: 24px;">${item.type === 'weapon' ? '‚öîÔ∏è' : item.type === 'armor' ? 'üõ°Ô∏è' : '‚ú®'}</span>
                <span class="item-quantity">${item.quantity}</span>
            `;
            grid.appendChild(slot);
        });
        // Adiciona slots vazios
        for(let i = inventory.length; i < 50; i++) {
            const slot = document.createElement('div');
            slot.className = 'item-slot';
            grid.appendChild(slot);
        }
    }

    function renderEquipment() {
        const slotsContainer = document.getElementById('equipment-slots');
        slotsContainer.innerHTML = '';
        for (const key in EQUIPMENT_SLOTS) {
            const slotData = EQUIPMENT_SLOTS[key];
            const slot = document.createElement('div');
            slot.className = 'equipment-slot';
            slot.innerHTML = `<strong>${slotData.name}</strong>`;
            
            if (slotData.currentItem) {
                 const item = slotData.currentItem;
                 // Exibe item equipado
                 slot.className += ` full rarity-${item.rarity.replace(/ /g, '')}`;
                 slot.title = item.name;
                 slot.innerHTML += `<span style="font-size: 24px;">${item.type === 'weapon' ? '‚öîÔ∏è' : item.type === 'armor' ? 'üõ°Ô∏è' : '‚ú®'}</span>`;
                 slot.onclick = () => inspectItem(item);
            }
            slotsContainer.appendChild(slot);
        }
    }
    
    function inspectItem(item) {
        inspectedItem = item;
        const panel = document.getElementById('item-inspection-panel');
        
        document.getElementById('inspected-item-name').textContent = item.name;
        document.getElementById('inspected-item-rarity').textContent = item.rarity;
        document.getElementById('inspected-item-type').textContent = item.type;
        document.getElementById('inspected-item-description').textContent = item.description;
        
        let statsHtml = '';
        if (item.atk) statsHtml += `ATK: +${item.atk}<br>`;
        if (item.hpBonus) statsHtml += `HP M√°x: +${item.hpBonus}<br>`;
        if (item.energyBonus) statsHtml += `Energia: +${item.energyBonus}<br>`;
        document.getElementById('inspected-item-stats').innerHTML = statsHtml;

        const equipButton = document.getElementById('equip-unequip-button');
        const isEquipped = EQUIPMENT_SLOTS[item.type] && EQUIPMENT_SLOTS[item.type].currentItem && EQUIPMENT_SLOTS[item.type].currentItem.id === item.id;
        
        if (isEquipped) {
            equipButton.textContent = 'DESEQUIPAR';
            equipButton.onclick = () => unequipItem(item);
        } else if (item.type === 'weapon' || item.type === 'armor' || item.type === 'accessory') {
            equipButton.textContent = 'EQUIPAR';
            equipButton.onclick = () => equipItem(item);
        } else if (item.type === 'consumable') {
            equipButton.textContent = 'USAR';
            equipButton.onclick = () => useItem(item);
        } else {
             equipButton.textContent = '...';
             equipButton.onclick = () => {};
             equipButton.disabled = true;
        }

        panel.style.display = 'block';
    }

    function equipItem(item, showAlert = true) {
        const slotKey = item.type;
        
        if (!EQUIPMENT_SLOTS[slotKey]) {
            if (showAlert) alert(`N√£o h√° slot de equipamento para o tipo: ${slotKey}.`);
            return;
        }

        // Se o item est√° sendo equipado, ent√£o ele substitui o item atual no slot
        EQUIPMENT_SLOTS[slotKey].currentItem = item;
        
        // Atualiza todos os pain√©is
        renderEquipment();
        renderInventory();
        if (showAlert) inspectItem(item); // Reinspeciona para mostrar "DESEQUIPAR"
        saveGame();
        if (showAlert) alert(`${item.name} equipado no slot de ${EQUIPMENT_SLOTS[slotKey].name}.`);
    }
    
    // Desequipa o item
    function unequipItem(item) {
        const slotKey = item.type;
        
        if (EQUIPMENT_SLOTS[slotKey].currentItem && EQUIPMENT_SLOTS[slotKey].currentItem.id === item.id) {
             EQUIPMENT_SLOTS[slotKey].currentItem = null;
             alert(`${item.name} desequipado.`);
        }
        
        // Atualiza todos os pain√©is
        renderEquipment();
        renderInventory();
        // Reinspeciona para atualizar o bot√£o para "EQUIPAR"
        if (inspectedItem) {
            inspectItem(inspectedItem); 
        }
        saveGame();
    }
    
    function useItem(item) {
        if (item.type !== 'consumable') {
            alert(`Voc√™ n√£o pode usar ${item.name} desta forma.`);
            return;
        }

        if (removeItemFromInventory(item, 1)) {
            // Aplica o efeito (Simplificado: s√≥ HP)
            if (item.effect && item.effect.hp) {
                const healAmount = item.effect.hp;
                heroCurrentHP = Math.min(heroCurrentHP + healAmount, heroMaxHP);
                alert(`Voc√™ usou ${item.name} e recuperou ${healAmount} HP.`);
            }
            
            // Recalcula, atualiza o display e salva
            calculateStats();
            updateDisplay();
            saveGame();
        }
    }


    // ====================================================================
    // VII. LOJA
    // ====================================================================
    
    function renderShop() {
        const shopDisplay = document.getElementById('shop-items-display');
        shopDisplay.innerHTML = '';
        
        SHOP_ITEMS.forEach(item => {
            const itemDiv = document.createElement('div');
            itemDiv.className = 'content-panel';
            itemDiv.style.border = `2px solid ${item.rarity === 'Raro' ? var(--color-energy) : 'white'}`;
            itemDiv.innerHTML = `
                <h4>${item.name}</h4>
                <p>${item.description}</p>
                <p>Custo: üí∞ ${item.price} Gold</p>
                <button onclick="buyItem(${item.id})" style="background-color: var(--color-hp); padding: 8px 15px;">Comprar</button>
            `;
            shopDisplay.appendChild(itemDiv);
        });
    }

    function buyItem(itemId) {
        const itemToBuy = SHOP_ITEMS.find(item => item.id === itemId);
        if (!itemToBuy) return;

        if (gold >= itemToBuy.price) {
            gold -= itemToBuy.price;
            addItemToInventory(itemToBuy, 1, true);
            alert(`Voc√™ comprou ${itemToBuy.name} por ${itemToBuy.price} Gold.`);
            updateDisplay();
        } else {
            alert("Gold insuficiente para comprar este item.");
        }
    }


    // ====================================================================
    // VIII. SALVAMENTO E CARREGAMENTO
    // ====================================================================

    function saveGame(showAlert = false) {
        const gameData = {
            gameInitialized: gameInitialized,
            heroName: heroName,
            selectedClass: selectedClass,
            powerLevel: powerLevel,
            currentExp: currentExp,
            expRequired: expToNextLevel,
            energy: energy,
            gold: gold,
            soul: soul,
            heroCurrentHP: heroCurrentHP,
            
            // NOVO: ATRIBUTOS PRINCIPAIS
            availableStatPoints: availableStatPoints,
            FOR: FOR,
            AGI: AGI,
            VIT: VIT,
            INT: INT,
            DES: DES,
            SOR: SOR,

            // Outras vari√°veis
            inventory: inventory,
            equipment: {
                weapon: EQUIPMENT_SLOTS.weapon.currentItem,
                armor: EQUIPMENT_SLOTS.armor.currentItem,
            },
            energyPerClick: energyPerClick,
            atkCost: atkUpgradeCost,
            hpCost: hpUpgradeCost,
        };
        localStorage.setItem('blazeAndSteelSave', JSON.stringify(gameData));
        if (showAlert) alert("Jogo Salvo!");
    }

    function loadGame(shouldAlert = false) {
        const savedData = localStorage.getItem('blazeAndSteelSave');
        if (savedData) {
            const gameData = JSON.parse(savedData);

            gameInitialized = gameData.gameInitialized || false;
            if (!gameInitialized) return;

            heroName = gameData.heroName || "Her√≥i Desconhecido";
            selectedClass = gameData.selectedClass || null;
            
            // Carrega N√≠vel e Recursos
            powerLevel = gameData.powerLevel || 1;
            currentExp = gameData.currentExp || 0;
            expToNextLevel = gameData.expRequired || 50;
            energy = gameData.energy || 0;
            gold = gameData.gold || 0;
            soul = gameData.soul || 0;
            heroCurrentHP = gameData.heroCurrentHP || 10;
            
            // NOVO: Carrega Atributos
            availableStatPoints = gameData.availableStatPoints || 0;
            FOR = gameData.FOR || 1;
            AGI = gameData.AGI || 1;
            VIT = gameData.VIT || 1;
            INT = gameData.INT || 1;
            DES = gameData.DES || 1;
            SOR = gameData.SOR || 1;
            
            // Carrega Upgrades (Manter por compatibilidade)
            energyPerClick = gameData.energyPerClick || 1;
            atkUpgradeCost = gameData.atkCost || 50;
            hpUpgradeCost = gameData.hpCost || 50;

            // Carrega Invent√°rio e Equipamento
            inventory = gameData.inventory || [];
            if (gameData.equipment) {
                EQUIPMENT_SLOTS.weapon.currentItem = gameData.equipment.weapon;
                EQUIPMENT_SLOTS.armor.currentItem = gameData.equipment.armor;
            }

            if (shouldAlert) alert("Jogo Carregado!");
            
            // Calcula e atualiza o display
            calculateStats();
            updateDisplay();
        }
    }

    function deleteGame(showAlert = false) {
        if (confirm("Tem certeza que deseja REINICIAR o jogo? Todo o progresso ser√° perdido.")) {
            localStorage.removeItem('blazeAndSteelSave');
            gameInitialized = false;
            location.reload(); // Recarrega a p√°gina para resetar as vari√°veis
        }
    }


    // ====================================================================
    // IX. INICIALIZA√á√ÉO
    // ====================================================================

    // Tenta carregar o jogo salvo ao iniciar a p√°gina. 
    loadGame();
    
</script>

</body>
</html>
