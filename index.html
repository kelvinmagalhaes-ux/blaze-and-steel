<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BLAZE AND STEEL</title>
    <style>
        /* Vari√°veis de Cores (CSS Custom Properties) */
        :root {
            --color-primary: #1e1e2d;
            --color-secondary: #36364f;
            --color-text: #e0e0e0;
            --color-accent: #f39c12; /* Ouro */
            --color-combat: #c0392b; /* Combate/Aventura */
            --color-evolve: #8e44ad; /* Evoluir/Treinamento */
            /* --color-energy: #3498db; REMOVIDO */
            --color-soul: #9b59b6; /* Alma/Reencarna√ß√£o */
            --color-hp: #2ecc71; /* HP/Vida */
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--color-primary);
            color: var(--color-text);
            margin: 0;
            display: flex;
            min-height: 100vh;
            overflow: hidden;
        }

        /* Estrutura Geral */
        #app-wrapper {
            display: flex;
            width: 100%;
        }

        /* Sidebar (Menu Lateral) */
        #sidebar {
            width: 200px;
            background-color: var(--color-secondary);
            padding: 20px 0;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.5);
            display: none; 
            flex-shrink: 0;
        }

        .sidebar-menu button {
            display: block;
            width: 100%;
            padding: 15px 20px;
            text-align: left;
            background: none;
            border: none;
            color: var(--color-text);
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
            display: flex; 
            align-items: center;
        }

        .sidebar-menu button:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .sidebar-menu button.active {
            background-color: var(--color-evolve);
            font-weight: bold;
            color: white; 
        }
        
        .sidebar-menu button::before {
            content: '';
            margin-right: 10px;
            font-size: 1.2em;
            width: 25px; 
            text-align: center;
        }
        
        /* Defini√ß√£o de √çcones */
        #btn-training::before { content: 'üè†'; color: var(--color-evolve); } 
        #btn-adventure::before { content: 'üó∫Ô∏è'; color: var(--color-combat); } 
        #btn-upgrades::before { content: '‚è´'; color: var(--color-accent); } 
        #btn-equipment::before { content: '‚öîÔ∏è'; color: var(--color-hp); } 
        #btn-inventory::before { content: 'üì¶'; color: var(--color-accent); }
        #btn-status::before { content: 'üë§'; color: var(--color-soul); } 
        #btn-expedition::before { content: 'üß≠'; color: #f1c40f; } 


        /* √Årea de Conte√∫do Principal */
        #main-content {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            max-height: 100vh;
            display: none; 
            position: relative;
        }
        
        /* Bot√£o de √Åudio (Dentro do Jogo) */
        #audio-control-button {
            background-color: var(--color-secondary);
            border: 1px solid var(--color-accent);
            color: var(--color-text);
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            z-index: 10;
        }

        /* Pain√©is de Conte√∫do (Geral) */
        .content-panel {
            background-color: var(--color-secondary);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        /* Menu Inicial (Start Menu) */
        #start-menu {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100vh;
            position: fixed; 
            top: 0;
            left: 0;
            background-color: var(--color-primary);
            z-index: 100;
        }
        
        .game-logo {
            max-width: 90%;
            width: 500px;
            height: auto;
            margin-bottom: 50px;
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
        }

        .menu-button-stack button {
            display: block;
            width: 300px;
            padding: 15px 20px;
            margin: 10px 0;
            border: 2px solid var(--color-accent);
            border-radius: 5px;
            background-color: var(--color-combat);
            color: var(--color-text);
            font-size: 1.2em;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            box-shadow: 0 4px var(--color-accent);
        }

        .menu-button-stack button:hover {
            background-color: #e74c3c;
            transform: translateY(-2px);
            box-shadow: 0 6px var(--color-accent);
        }

        .menu-button-stack button:active {
            transform: translateY(2px);
            box-shadow: 0 2px var(--color-accent);
        }
        
        /* Estilo para o Slider de Volume */
        .volume-control-container {
            margin-top: 20px;
            padding: 10px;
            background-color: var(--color-secondary);
            border-radius: 5px;
            width: 300px;
            text-align: center;
        }

        .volume-control-container label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        /* Ajuste a posi√ß√£o do controle de volume para o menu inicial */
        #start-menu .volume-control-container {
            position: absolute;
            bottom: 33px; 
            left: 50%;
            transform: translateX(-50%);
            width: 90%; 
            max-width: 300px;
        }


        /* Painel de Cria√ß√£o de Personagem - ESTILO ISOLADO */
        #character-creation-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--color-primary);
            z-index: 99;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
            box-sizing: border-box;
        }

        #character-creation-panel .content-panel {
            max-width: 600px;
            margin: auto;
            padding: 30px;
            border: 2px solid var(--color-accent);
        }
        
        /* Header e Display de Recursos */
        #header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px 20px 0;
            border-bottom: 1px solid var(--color-secondary);
            margin-bottom: 20px;
        }

        .resource-display {
            display: flex;
            gap: 15px;
        }

        .resource-item {
            font-size: 1.1em;
            font-weight: bold;
        }

        .resource-item span {
            margin-left: 5px;
        }
        
        /* Bot√µes de A√ß√£o (Geral) */
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Estilo do Bot√£o Level Up */
        #hero-training-panel button#level-up-button {
            background-color: var(--color-evolve);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            margin-top: 10px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        #hero-training-panel button#level-up-button:hover:not(:disabled) {
            background-color: #6c3483;
        }
        
        /* Estilo para o logo ADVENTURE */
        #adventure-title-logo {
            display: block;
            margin: 0 auto 20px auto;
            max-width: 300px; 
            height: auto;
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
        }

        /* Estilo para os bot√µes de sele√ß√£o de classe */
        #class-selection-container button {
            background-color: var(--color-secondary);
            color: var(--color-text); 
            border: 2px solid var(--color-primary); 
            padding: 10px 15px; 
            border-radius: 5px; 
            cursor: pointer;
            width: 150px;
            height: 150px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: border-color 0.2s, background-color 0.2s;
        }
        
        #class-selection-container button img {
            max-width: 80px;
            max-height: 80px; 
            margin-bottom: 5px;
            border-radius: 5px;
        }
        
        #class-selection-container button:hover {
            border-color: var(--color-accent);
        }

        /* Estilos para o Invent√°rio e Equipamento */
        .item-card {
            background-color: #2c3e50;
            border: 2px solid var(--color-secondary);
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
        }

        .item-card:hover {
            background-color: #34495e;
            border-color: var(--color-accent);
        }
        
        .item-card.equipped {
            border-color: var(--color-hp);
            box-shadow: 0 0 5px var(--color-hp);
        }

        .item-card p {
            margin: 5px 0 0 0;
            font-size: 0.9em;
        }

        .slot-container {
            display: flex;
            align-items: center;
            padding: 10px;
            border: 1px dashed var(--color-accent);
            border-radius: 5px;
            background-color: #1a1a25;
        }

        .slot-label {
            width: 100px;
            font-weight: bold;
            color: var(--color-accent);
        }

        .equipped-item-display {
            flex-grow: 1;
            padding: 5px;
            background-color: #2c3e50;
            border-radius: 3px;
        }

        .empty-slot {
            font-style: italic;
            color: #7f8c8d;
        }
        
        /* -------------------------------------- */
        /* RESPONSIVIDADE (MOBILE / TELAS PEQUENAS) */
        /* -------------------------------------- */
        @media (max-width: 768px) {
            
            /* Estrutura Principal */
            body {
                overflow-y: auto;
            }

            #app-wrapper {
                flex-direction: column;
            }
            
            /* Sidebar (Menu) */
            #sidebar {
                width: 100%;
                padding: 10px 0;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
                order: -1;
            }

            .sidebar-menu {
                display: flex;
                flex-wrap: wrap;
                justify-content: space-around;
                gap: 5px;
            }

            .sidebar-menu button {
                width: 45%;
                text-align: center;
                padding: 8px 10px;
                font-size: 0.9em;
                justify-content: center; 
            }
            
            /* Remove o √≠cone extra para economizar espa√ßo no mobile */
            .sidebar-menu button::before {
                content: none !important;
                margin-right: 0;
                width: auto;
            }

            /* Conte√∫do Principal */
            #main-content {
                padding: 10px;
            }

            /* Header (Recursos) */
            #header {
                flex-direction: column;
                align-items: flex-start;
                padding-bottom: 10px;
                margin-bottom: 10px;
            }

            .resource-display {
                flex-wrap: wrap;
                gap: 8px 15px; 
            }
            
            /* Logo de Aventura */
            #adventure-title-logo {
                max-width: 100%;
            }
            
            /* Bot√µes do Menu Inicial */
            .menu-button-stack button {
                width: 250px;
            }
            
            /* Cria√ß√£o de Personagem Mobile */
            #character-creation-panel .content-panel {
                margin: 20px 10px;
                padding: 20px;
            }
            
            #class-selection-container {
                flex-direction: column;
                align-items: center;
            }

            #class-selection-container button {
                width: 80%;
                height: auto;
                padding: 10px;
            }

            /* √Åudio Control - Ajuste para mobile */
            #audio-control-button {
                top: 10px;
                right: 10px;
            }
        }
    </style>
</head>
<body>
    
    <audio id="game-theme-music" loop>
        <source src="assets/theme_music.mp3" type="audio/mpeg"> 
        Seu navegador n√£o suporta a tag de √°udio.
    </audio>

    <div id="app-wrapper">

        <div id="start-menu">
            <img src="assets/blaze-and-steel.png" alt="Blaze and Steel Logo" class="game-logo"> 
            
            <div class="menu-button-stack">
                <button onclick="showCharacterCreation()">NOVO JOGO</button> 
                <button onclick="loadGame(true)">CARREGAR JOGO</button>
                <button onclick="alert('Sair: Por enquanto, feche a aba.')">SAIR</button>
            </div>
            
            <div class="volume-control-container">
                <label for="volume-slider-start">üé∂ Volume: <span id="volume-label-start">100</span></label>
                <input type="range" id="volume-slider-start" min="0" max="100" value="100" oninput="setVolume(this.value)">
            </div>
        </div>

        <div id="character-creation-panel" style="display: none;">
            <div class="content-panel" style="text-align: center;">
                <h2>Crie Seu Her√≥i!</h2>
                <p>Escolha um nome e uma classe para come√ßar sua aventura.</p>
               
                <div style="margin: 20px 0;">
                    <label for="hero-name-input" style="font-weight: bold; display: block; margin-bottom: 5px;">Nome do Her√≥i:</label>
                    <input type="text" id="hero-name-input" placeholder="Ex: Her√≥i Blaze" maxlength="20" style="padding: 10px; font-size: 1.2em; width: 80%; max-width: 300px; border-radius: 5px; border: 1px solid var(--color-accent); background-color: var(--color-primary); color: var(--color-text);">
                </div>
                
                <h3>Selecione Sua Classe:</h3>
                <div id="class-selection-container" style="display: flex; justify-content: center; flex-wrap: wrap; gap: 15px;">
                    </div>
                
                <div id="class-details" class="content-panel" style="margin-top: 20px; display: none; text-align: left; max-width: 500px; margin-left: auto; margin-right: auto;">
                    <h4>Detalhes da Classe Selecionada</h4>
                    <p><strong>Classe:</strong> <span id="selected-class-name"></span></p>
                    <p><strong>Estat√≠sticas Iniciais:</strong></p>
                    <ul>
                        <li>‚ù§Ô∏è HP Base: <span id="class-base-hp"></span></li>
                        <li>‚öîÔ∏è ATK Base: <span id="class-base-atk"></span></li>
                        <li style="font-weight: bold;">‚öîÔ∏è Equipamento Inicial: <span id="class-initial-equipment"></span></li>
                    </ul>
                    <p style="font-style: italic;"></p>
                    
                    <button id="confirm-creation-button" disabled onclick="finalizeCreation()" style="background-color: var(--color-evolve); color: white; padding: 12px 25px; border: none; border-radius: 5px; margin-top: 15px; width: 100%;">
                        INICIAR JOGO!
                    </button>
                </div>
            </div>
        </div>

        <div id="sidebar">
            <div id="hero-info" style="text-align: center; margin-bottom: 20px;">
                <h3 id="hero-name"></h3>
                <p>N√≠vel: <span id="power-level">1</span></p>
            </div>
            <nav class="sidebar-menu">
                <button id="btn-training" onclick="showPanel('training-panel')" class="active">Quartel-General</button>
                <button id="btn-adventure" onclick="showPanel('adventure-panel')">Aventura</button>
                <button id="btn-upgrades" onclick="showPanel('upgrades-panel')">Upgrades</button>
                <button id="btn-equipment" onclick="showPanel('equipment-panel')">Equipamento</button>
                <button id="btn-inventory" onclick="showPanel('inventory-panel')">Invent√°rio</button>
                <button id="btn-status" onclick="showPanel('status-panel')">Status</button>
                <button id="btn-expedition" onclick="showPanel('expedition-panel')">Expedi√ß√£o</button>
            </nav>
        </div>

        <div id="main-content">
            
            <div style="position: absolute; top: 10px; right: 10px; z-index: 10; text-align: right;">
                <button id="audio-control-button" onclick="toggleMute()" style="margin-bottom: 5px;">
                    üîä Mute
                </button>
                
                <div class="volume-control-container" style="width: 150px; padding: 5px; margin-left: auto;">
                    <label for="volume-slider-game" style="font-size: 0.8em; margin: 0;">Volume: <span id="volume-label-game">100</span></label>
                    <input type="range" id="volume-slider-game" min="0" max="100" value="100" oninput="setVolume(this.value)">
                </div>
            </div>


            <div id="header">
                <h2></h2>
                <div class="resource-display">
                    <div class="resource-item" style="color: var(--color-accent);">üí∞ Ouro: <span id="gold-count">0</span></div>
                    <div class="resource-item" style="color: var(--color-soul);">üíÄ Alma: <span id="soul-count">0</span></div>
                </div>
            </div>

            <div id="content-area">
                
                <div id="training-panel" style="display: none;">
                    
                    <div id="special-missions-panel" class="content-panel" style="text-align: center;">
                        <h3>Miss√µes Especiais</h3>
                        <p>Progresso r√°pido e recompensas raras!</p>

                        <div id="daily-missions" style="margin-bottom: 15px;">
                            <h4>Di√°rias (Reseta em 24h)</h4>
                            <button id="daily-scouting" class="mission-button mission-daily" onclick="startDailyMission('scouting')">
                                Fazer Patrulha (Recompensa: 100 EXP | 50 üí∞)
                            </button>
                            <button id="daily-training-drills" class="mission-button mission-daily" onclick="startDailyMission('drills')">
                                Exerc√≠cios de Treinamento (Recompensa: 200 EXP | +2 ATK B√¥nus!)
                            </button>
                        </div>

                        <div id="unique-missions">
                            <h4>√önicas (Desaparecem ap√≥s concluir)</h4>
                            <button id="unique-first-quest" class="mission-button mission-unique" onclick="startUniqueMission('firstQuest')">
                                Provar o Valor (Recompensa: 500 EXP | +10 HP B√¥nus!)
                            </button>
                            <button id="unique-tutorial-complete" class="mission-button mission-unique" onclick="startUniqueMission('tutorialComplete')">
                                Finalizar Tutorial B√°sico (Recompensa: 100 üí∞) </button>
                        </div>
                    </div>

                    <div id="resource-missions-panel" class="content-panel" style="text-align: center;">
                        <h3>Obten√ß√£o de Recursos (Cooldowns)</h3>
                        
                        <button id="work-gold-button" onclick="startMission('workGold')" style="background-color: var(--color-accent); color: black; padding: 10px; margin: 5px;">
                            Trabalhar por Ouro (60s | Ganho: 20 üí∞)
                        </button>
                    </div>

                    
                    <div id="hero-training-panel" class="content-panel" style="text-align: center;">
                        <h3>Treinamento & Progresso</h3>
                        <p>Gaste Ouro para aumentar sua EXP e preparo.</p> <button onclick="trainForStats('attack')" style="background-color: var(--color-combat); color: white; padding: 10px; margin: 5px;">
                            Estudar T√°ticas (Custo: 25 üí∞ | Ganho: 10 EXP) </button>
                        
                        <button onclick="trainForStats('defense')" style="background-color: var(--color-hp); color: white; padding: 10px; margin: 5px;">
                            Preparar Defesas (Custo: 25 üí∞ | Ganho: 10 EXP) </button>

                        <div style="margin-top: 20px;">
                            <p>üåü N√≠vel de Poder: <span id="power-level-display">1</span></p>
                            <p>‚ú® EXP: <span id="exp-count">0</span> / <span id="exp-required">50</span></p>
                            <button id="level-up-button" onclick="levelUp()" disabled style="background-color: var(--color-evolve); color: white;">
                                SUBIR DE N√çVEL (Falta: 50 EXP)
                            </button>
                        </div>
                    </div>
                </div>

                <div id="adventure-panel" style="display: none;">
                    
                    <img src="assets/adventure.png" alt="ADVENTURE" id="adventure-title-logo">
                    
                    <div class="content-panel" style="display: flex; justify-content: space-between;">
                        
                        <div style="flex: 1; margin-right: 20px;">
                            <h2 id="monster-name">Monstro</h2>
                            <div id="monster-image" style="background-color: #7f8c8d; width: 150px; height: 150px; border-radius: 8px; margin-bottom: 10px;">
                                </div>
                            <p>‚ù§Ô∏è HP: <span id="monster-hp-display">0</span></p>
                            <p>‚öîÔ∏è ATK: <span id="monster-atk-display">0</span></p>
                            <p style="font-size: 0.9em; color: var(--color-combat);">Custo da Batalha: <span id="monster-cost-display">0</span> üí∞</p>
                        </div>

                        <div style="flex: 2; display: flex; flex-direction: column; justify-content: space-between;">
                            <div>
                                <h3>Recompensas Estimadas:</h3>
                                <p>‚ú® EXP: <span id="monster-reward-exp">0</span></p>
                                <p>üí∞ Ouro: <span id="monster-reward-gold">0</span></p>
                                <p>üíÄ Alma: <span id="monster-reward-soul">0</span></p>
                                
                                <div id="combat-log" style="height: 150px; overflow-y: auto; background-color: #1a1a25; padding: 10px; border-radius: 5px; margin-top: 10px; font-size: 0.9em;">
                                    <p style="color: #7f8c8d;">[Log de Combate]</p>
                                </div>
                            </div>
                            
                            <div style="margin-top: 15px;">
                                <button onclick="startBattle()" id="start-battle-button" style="background-color: var(--color-combat); color: white; padding: 12px 20px; border: none; border-radius: 5px; cursor: pointer; width: 100%;">
                                    Iniciar Batalha!
                                </button>
                                <button onclick="selectMonsterByLevel()" style="background-color: var(--color-secondary); color: var(--color-text); padding: 8px 15px; border: 1px solid var(--color-accent); border-radius: 5px; cursor: pointer; width: 100%; margin-top: 5px;">
                                    Encontrar Outro Monstro
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="upgrades-panel" style="display: none;">
                    <h2>‚è´ Upgrades & Melhorias</h2>

                    <div id="basic-upgrades" class="content-panel">
                        <h3>Melhorias B√°sicas</h3>
                        <p>Aumente suas estat√≠sticas base gastando Ouro.</p>

                        <div style="display: flex; gap: 20px; text-align: center;">
                            <div style="flex: 1; text-align: center;">
                                <h3>Aumento de Ataque</h3>
                                <p>‚öîÔ∏è ATK Base Atual: <span id="upgrade-atk-display">1</span></p>
                                <p>Pr√≥ximo N√≠vel: +1 ATK</p>
                                <button id="buy-atk-upgrade" onclick="buyUpgrade('atk')" style="background-color: var(--color-combat);">
                                    Comprar (Custo: <span id="atk-cost">50</span> üí∞)
                                </button>
                            </div>
                            <div style="flex: 1; text-align: center;">
                                <h3>Aumento de Vida</h3>
                                <p>‚ù§Ô∏è HP Base Atual: <span id="upgrade-hp-display">10</span></p>
                                <p>Pr√≥ximo N√≠vel: +10 HP</p>
                                <button id="buy-hp-upgrade" onclick="buyUpgrade('hp')" style="background-color: var(--color-hp);">
                                    Comprar (Custo: <span id="hp-cost">50</span> üí∞)
                                </button>
                            </div>
                        </div>
                    </div>

                    </div>

                <div id="equipment-panel" style="display: none;">
                    <h2>üõ°Ô∏è Equipamento & Estat√≠sticas</h2>
                    
                    <div style="display: flex; gap: 20px; margin-top: 20px;">
                        <div class="content-panel" style="flex: 1; min-width: 300px;">
                            <h3>Slots de Equipamento</h3>
                            <div id="equipment-list" style="display: flex; flex-direction: column; gap: 10px;">
                                </div>
                        </div>
                        <div class="content-panel" style="flex: 1;">
                            <h3>Estat√≠sticas Totais</h3>
                            <div id="hero-stats-equipment">
                                <p>‚ù§Ô∏è HP M√°ximo: <span id="eq-max-hp">0</span> (Base: <span id="eq-base-hp">0</span> + B√¥nus: <span id="eq-bonus-hp">0</span>)</p>
                                <p>‚öîÔ∏è ATK Total: <span id="eq-total-atk">0</span> (Base: <span id="eq-base-atk">0</span> + B√¥nus: <span id="eq-bonus-atk">0</span>)</p>
                                <p>‚ö° Multiplicador de Dano (N√≠vel): <span id="hero-level-multiplier">1.0</span>x</p>
                                <p>‚≠ê HP Atual: <span id="hero-current-hp">0</span></p>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="inventory-panel" style="display: none;">
                    <h2>üì¶ Invent√°rio</h2>
                    
                    <div style="display: flex; gap: 20px; margin-top: 20px;">
                        <div class="content-panel" style="flex: 2;">
                            <h3>Itens Coletados (<span id="inventory-count">0</span>)</h3>
                            <div id="inventory-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px;">
                                </div>
                        </div>
                        
                        <div id="item-inspection-panel" class="content-panel" style="flex: 1; min-width: 250px; display: none;">
                            <h3>Detalhes do Item</h3>
                            <p><strong>Nome:</strong> <span id="inspected-item-name"></span></p>
                            <p><strong>Tipo:</strong> <span id="inspected-item-type"></span></p>
                            <p><strong>Raridade:</strong> <span id="inspected-item-rarity"></span></p>
                            <p id="inspected-item-stats"></p>
                            <p style="font-style: italic; font-size: 0.9em; color: #7f8c8d;">"<span id="inspected-item-description"></span>"</p>
                            
                            <div style="margin-top: 15px;">
                                <button id="item-action-button" onclick="" style="padding: 10px; border-radius: 5px; width: 100%; margin-bottom: 5px;"></button>
                                <button id="item-sell-button" onclick="" style="background-color: var(--color-combat); color: white; padding: 10px; border-radius: 5px; width: 100%;">
                                    Vender (10 üí∞)
                                </button>
                            </div>
                        </div>
                    </div>
                </div>


                <div id="status-panel" style="display: none;">
                    <h2>üë§ Status do Her√≥i</h2>
                    <div class="content-panel">
                        <h3>Estat√≠sticas Principais</h3>
                        <p><strong>Nome:</strong> <span id="status-hero-name"></span></p>
                        <p><strong>Classe:</strong> <span id="status-hero-class"></span></p>
                        <p><strong>N√≠vel de Poder:</strong> <span id="status-power-level">1</span></p>
                        <p><strong>EXP:</strong> <span id="status-exp">0</span> / <span id="status-exp-needed">50</span></p>
                    </div>
                    
                    <div class="content-panel">
                        <h3>Valores Atuais</h3>
                        <p>‚ù§Ô∏è HP M√°ximo: <span id="status-max-hp">0</span></p>
                        <p>‚öîÔ∏è ATK Total: <span id="status-total-atk">0</span></p>
                    </div>
                    
                    <div class="content-panel">
                        <h3>Recursos</h3>
                        <p>üí∞ Ouro: <span id="status-gold">0</span></p>
                        <p>üíÄ Alma: <span id="status-soul">0</span></p>
                    </div>
                </div>
                
                <div id="expedition-panel" style="display: none;">
                    <h2>üß≠ Expedi√ß√£o (Futuro)</h2>
                    <div class="content-panel">
                        <p>Aqui voc√™ poder√° enviar seus her√≥is para miss√µes longas e autom√°ticas para coletar recursos raros e Almas.</p>
                        <button disabled style="padding: 10px 15px;">Em Desenvolvimento...</button>
                    </div>
                </div>


            </div> 
            
            <div id="footer-controls" style="padding-top: 20px; text-align: center;">
                <button onclick="saveGame(true)" style="background-color: var(--color-accent); color: var(--color-primary); padding: 10px 20px; border: none; border-radius: 5px; margin: 0 10px;">
                    Salvar Jogo
                </button>
                <button onclick="deleteGame(true)" style="background-color: var(--color-combat); color: white; padding: 10px 20px; border: none; border-radius: 5px; margin: 0 10px;">
                    Reiniciar Jogo (CUIDADO!)
                </button>
            </div>
            
        </div>
    </div>


    <script>
        // ====================================================================
        // I. VARI√ÅVEIS GLOBAIS E ESTRUTURAS DE DADOS
        // ====================================================================

        let gameInitialized = false;
        let selectedClassKey = null; // Chave da classe selecionada ('warrior', 'mage', 'assassin')
        let inspectedItem = null; 

        // VARI√ÅVEIS DO JOGO (Status, N√≠vel, Recursos)
        let heroName = "Her√≥i Desconhecido";
        let powerLevel = 1;
        let currentExp = 0;
        let expToNextLevel = 50;
        let gold = 0;
        let soul = 0;
        // let currentEnergy = 10; // REMOVIDO
        // let maxEnergy = 10;     // REMOVIDO
        
        // Vari√°veis de Combate
        let heroBaseHP = 10; 
        let heroBaseATK = 1; 
        let heroCurrentHP = 10;
        let heroMaxHP = 10;
        let heroTotalATK = 1;
        let monsterHP = 0;
        let currentMonster = null;
        
        // Vari√°veis de Upgrades
        let atkUpgradeCost = 50;
        let hpUpgradeCost = 50;
        
        // Estrutura do Invent√°rio
        let inventory = []; // [{id: 1, name: 'Espada Curta', type: 'weapon', ...}, ...]

        // Estrutura de Classes do Personagem (AGORA COM ASSASSINO E SEM ENERGIA)
        const CLASSES = {
            warrior: {
                key: 'warrior',
                name: "Guerreiro",
                description: "Especialista em combate corpo-a-corpo, focado em vida e dano balanceado.",
                initialHP: 15,
                initialATK: 2,
                imagePath: "image_6309cc.jpg",
                startingItems: [ 
                    { id: 1, name: "Espada Curta", type: "weapon", atk: 2, rarity: "Comum", description: "Uma l√¢mina b√°sica de treinamento." }, 
                    { id: 2, name: "Armadura de Couro", type: "armor", hpBonus: 10, rarity: "Comum", description: "Prote√ß√£o leve e confi√°vel." } 
                ]
            },
            mage: {
                key: 'mage',
                name: "Mago",
                description: "Fr√°gil, mas com alto potencial de dano m√°gico.",
                initialHP: 10,
                initialATK: 1,
                imagePath: "image_63192f.png",
                startingItems: [ 
                    { id: 3, name: "Cajado de Madeira", type: "weapon", atk: 1, rarity: "Comum", description: "Um cajado simples para canalizar magia." }, 
                    { id: 4, name: "Manto de Pano", type: "armor", hpBonus: 5, rarity: "Comum", description: "Um manto b√°sico para prote√ß√£o e foco." } 
                ]
            },
            assassin: { // CLASSE ASSASSINO ADICIONADA
                key: 'assassin',
                name: "Assassino",
                description: "Focado em dano explosivo e evas√£o. Come√ßa com uma adaga.",
                initialHP: 12, 
                initialATK: 3,
                imagePath: "image_0b9ca2.jpg",
                startingItems: [ 
                    { id: 5, name: "Adaga R√°pida", type: "weapon", atk: 3, rarity: "Comum", description: "Uma adaga leve para ataques r√°pidos." }, 
                    { id: 6, name: "Capuz Sombrio", type: "armor", hpBonus: 7, rarity: "Comum", description: "Um capuz que oferece pouca, mas essencial, prote√ß√£o." } 
                ]
            }
        };
        
        // Slots de Equipamento (ADICIONADO ACCESSORY)
        const EQUIPMENT_SLOTS = {
            weapon: { name: "Arma", currentItem: null },
            armor: { name: "Armadura", currentItem: null },
            // accessory: { name: "Acess√≥rio", currentItem: null } // Manteremos simples por enquanto
        };
        
        // Estrutura de Itens (Para refer√™ncia r√°pida)
        const ITEM_DATABASE = [
            // Itens Iniciais (IDs 1-6)
            { id: 1, name: "Espada Curta", type: "weapon", atk: 2, rarity: "Comum", description: "Uma l√¢mina b√°sica de treinamento." }, 
            { id: 2, name: "Armadura de Couro", type: "armor", hpBonus: 10, rarity: "Comum", description: "Prote√ß√£o leve e confi√°vel." },
            { id: 3, name: "Cajado de Madeira", type: "weapon", atk: 1, rarity: "Comum", description: "Um cajado simples para canalizar magia." }, 
            { id: 4, name: "Manto de Pano", type: "armor", hpBonus: 5, rarity: "Comum", description: "Um manto b√°sico para prote√ß√£o e foco." },
            { id: 5, name: "Adaga R√°pida", type: "weapon", atk: 3, rarity: "Comum", description: "Uma adaga leve para ataques r√°pidos." },
            { id: 6, name: "Capuz Sombrio", type: "armor", hpBonus: 7, rarity: "Comum", description: "Um capuz que oferece pouca, mas essencial, prote√ß√£o." },
            // Itens de Loja/Drop
            { id: 10, name: "Po√ß√£o de HP", type: "consumable", effect: { hp: 50 }, price: 20, rarity: "Comum", description: "Restaura uma pequena quantidade de vida." },
            { id: 11, name: "Amuleto B√°sico", type: "accessory", atk: 2, hpBonus: 5, price: 100, rarity: "Raro", description: "Um pequeno b√¥nus em ATK e HP." },
        ];

        // Estrutura de Monstros
        const MONSTERS = [
            { id: 1, name: "Goblin Fraco", level: 1, baseATK: 1, baseHP: 10, expReward: 10, goldReward: 5, goldCost: 5, dropItems: [{ itemId: 10, chance: 0.1 }] },
            { id: 2, name: "Slime", level: 1, baseATK: 0, baseHP: 20, expReward: 10, goldReward: 8, goldCost: 5, dropItems: [{ itemId: 10, chance: 0.2 }] },
            { id: 3, name: "Lobo da Floresta", level: 2, baseATK: 3, baseHP: 15, expReward: 15, goldReward: 10, goldCost: 8, dropItems: [{ itemId: 10, chance: 0.05 }] },
            { id: 4, name: "Orc B√°sico", level: 5, baseATK: 5, baseHP: 30, expReward: 30, goldReward: 20, goldCost: 15, dropItems: [{ itemId: 11, chance: 0.02 }] },
        ];
        
        
        // ====================================================================
        // II. FUN√á√ïES DE C√ÅLCULO E DISPLAY
        // ====================================================================

        /**
         * Calcula o total de ATK e HP do her√≥i, incluindo b√¥nus de n√≠vel e equipamento.
         */
        function calculateStats() {
            // 1. Inicializa√ß√£o de Valores Base (Upgrade)
            let totalHPBonus = heroBaseHP; 
            let totalATK = heroBaseATK;
            
            // 2. B√¥nus por Equipamento
            for (const slotKey in EQUIPMENT_SLOTS) {
                const item = EQUIPMENT_SLOTS[slotKey].currentItem;
                if (item) {
                    totalHPBonus += item.hpBonus || 0;
                    totalATK += item.atk || 0;
                }
            }
            
            // 3. B√¥nus por N√≠vel (Simplificado)
            const levelHPBonus = powerLevel * 20; 
            const levelATKBonus = powerLevel * 1; 

            // 4. C√°lculo Final de Status
            heroTotalATK = totalATK + levelATKBonus; 
            heroMaxHP = totalHPBonus + levelHPBonus;
            
            // Garante que o HP atual n√£o ultrapasse o m√°ximo
            heroCurrentHP = Math.min(heroCurrentHP, heroMaxHP);
        }
        
        /**
         * Atualiza todos os displays e pain√©is na tela.
         */
        function updateDisplay() {
            calculateStats(); // Recalcula antes de exibir
            
            // Recusa exibir o resto se o jogo n√£o estiver inicializado (Menu Inicial)
            if (!gameInitialized) return;
            
            // Header e Hero Info
            document.getElementById('hero-name').textContent = heroName;
            document.getElementById('power-level').textContent = powerLevel;
            document.getElementById('gold-count').textContent = gold;
            document.getElementById('soul-count').textContent = soul;
            // document.getElementById('energy-count').textContent = `${currentEnergy}/${maxEnergy}`; // REMOVIDO
            
            // Painel de Treinamento
            document.getElementById('power-level-display').textContent = powerLevel;
            document.getElementById('exp-count').textContent = currentExp;
            document.getElementById('exp-required').textContent = expToNextLevel;
            document.getElementById('level-up-button').textContent = `SUBIR DE N√çVEL (Falta: ${expToNextLevel - currentExp} EXP)`;
            document.getElementById('level-up-button').disabled = (currentExp < expToNextLevel);

            // Painel de Upgrades
            renderUpgradePanel();

            // Painel de Equipamento e Status
            renderEquipmentPanel();
            renderStatusPanel();
            
            // Painel de Invent√°rio
            renderInventoryPanel();

            // Painel de Aventura
            if (!currentMonster) {
                selectMonsterByLevel();
            } else {
                renderAdventurePanel();
            }
        }
        
        /**
         * Altera o painel principal e atualiza o menu lateral.
         */
        function showPanel(panelId) {
            if (!gameInitialized) return;

            document.querySelectorAll('#content-area > div').forEach(panel => {
                panel.style.display = 'none';
            });
            document.getElementById(panelId).style.display = 'block';

            document.querySelectorAll('.sidebar-menu button').forEach(button => {
                button.classList.remove('active');
            });
            document.querySelector(`#sidebar button[onclick="showPanel('${panelId}')"`).classList.add('active');
            
            // Atualiza o display (para recalcular HP e ATK no caso de voltar do combate)
            updateDisplay();
        }
        
        // ====================================================================
        // III. INICIALIZA√á√ÉO E CRIA√á√ÉO
        // ====================================================================
        
        /**
         * Exibe a tela de cria√ß√£o de personagem.
         */
        function showCharacterCreation() {
            document.getElementById('start-menu').style.display = 'none';
            document.getElementById('character-creation-panel').style.display = 'flex';
            renderClassSelection();
            startThemeMusic(); 
        }

        /**
         * Renderiza as op√ß√µes de classe na tela de cria√ß√£o.
         */
        function renderClassSelection() {
            const container = document.getElementById('class-selection-container');
            container.innerHTML = '';
            
            for (const key in CLASSES) {
                const cls = CLASSES[key];
                const button = document.createElement('button');
                button.setAttribute('data-class', key);
                button.onclick = () => selectClass(key);
                button.innerHTML = `
                    <img src="${cls.imagePath}" alt="${cls.name}">
                    <strong>${cls.name}</strong>
                `;
                container.appendChild(button);
            }
        }

        /**
         * Seleciona uma classe e mostra seus detalhes.
         */
        function selectClass(clsKey) {
            document.querySelectorAll('#class-selection-container button').forEach(card => {
                card.style.border = '2px solid var(--color-primary)';
                card.style.backgroundColor = 'var(--color-secondary)';
            });

            const selectedCard = document.querySelector(`#class-selection-container button[data-class="${clsKey}"]`);
            if (selectedCard) {
                selectedCard.style.border = '2px solid var(--color-evolve)';
                selectedCard.style.backgroundColor = 'var(--color-primary)';
            }

            const cls = CLASSES[clsKey];
            selectedClassKey = clsKey;
            
            document.getElementById('selected-class-name').textContent = cls.name;
            document.getElementById('class-base-hp').textContent = cls.initialHP;
            document.getElementById('class-base-atk').textContent = cls.initialATK;
            // document.getElementById('class-initial-energy').textContent = cls.initialEnergy; // REMOVIDO
            
            const startingItemsList = cls.startingItems.map(item => `${item.name} (+${item.atk || item.hpBonus || 0})`).join(', ');
            document.getElementById('class-initial-equipment').textContent = startingItemsList;
            
            document.getElementById('class-details').style.display = 'block';
            document.getElementById('confirm-creation-button').disabled = false;
        }

        /**
         * Finaliza a cria√ß√£o, configura o estado inicial do jogo e inicia o loop.
         */
        function finalizeCreation() {
            const nameInput = document.getElementById('hero-name-input').value.trim();
            if (!nameInput || !selectedClassKey) {
                alert("Por favor, digite o nome do seu her√≥i e selecione uma classe.");
                return;
            }

            const cls = CLASSES[selectedClassKey];
            
            // 1. Resetar vari√°veis e definir status iniciais
            heroName = nameInput;
            powerLevel = 1;
            currentExp = 0;
            expToNextLevel = 50;
            gold = 0;
            soul = 0;
            // currentEnergy = cls.initialEnergy; // REMOVIDO
            // maxEnergy = cls.initialEnergy;     // REMOVIDO
            
            // Define o ATK/HP base da classe
            heroBaseHP = cls.initialHP;
            heroBaseATK = cls.initialATK; 

            // HP inicial e total √© calculado
            calculateStats(); 
            heroCurrentHP = heroMaxHP; 

            // 2. Itens Iniciais (Limpa e Adiciona)
            inventory = [];
            for (const slotKey in EQUIPMENT_SLOTS) {
                 EQUIPMENT_SLOTS[slotKey].currentItem = null;
            }
            cls.startingItems.forEach(item => {
                addItemToInventory(item, 1, false); 
                // Equipar automaticamente os itens iniciais
                if(item.type === 'weapon' || item.type === 'armor') {
                    equipItem(item, false);
                }
            });

            // 3. Inicializa o Jogo e a UI
            gameInitialized = true;
            document.getElementById('character-creation-panel').style.display = 'none';
            document.getElementById('start-menu').style.display = 'none';
            document.getElementById('sidebar').style.display = 'flex';
            document.getElementById('main-content').style.display = 'block';
            
            selectMonsterByLevel(); // Seleciona o primeiro monstro
            showPanel('training-panel');
            saveGame();
            updateDisplay();
            
            alert(`O her√≥i ${heroName}, o ${cls.name}, come√ßou sua aventura!`);
        }
        
        /**
         * Sobe o n√≠vel do her√≥i.
         */
        function levelUp() {
            if (currentExp < expToNextLevel) {
                return; 
            }
            
            powerLevel++;
            currentExp -= expToNextLevel;
            expToNextLevel = Math.round(expToNextLevel * 1.5);
            
            // Recalcula e restaura o HP
            calculateStats(); 
            heroCurrentHP = heroMaxHP; 

            alert(`üéâ Voc√™ subiu para o N√≠vel ${powerLevel}! HP totalmente restaurado.`);

            updateDisplay();
            saveGame();
        }


        // ====================================================================
        // IV. TREINAMENTO, UPGRADES E MISS√ïES
        // ====================================================================
        
        /**
         * Inicia uma miss√£o de cooldown (Trabalhar por Ouro)
         */
        function startMission(missionKey) {
            // Apenas o WorkGold √© implementado por enquanto
            if (missionKey === 'workGold') {
                const button = document.getElementById('work-gold-button');
                button.disabled = true;
                const duration = 60; // 60 segundos
                let countdown = duration;
                
                button.textContent = `Trabalhando... (${countdown}s)`;

                const interval = setInterval(() => {
                    countdown--;
                    button.textContent = `Trabalhando... (${countdown}s)`;
                    
                    if (countdown <= 0) {
                        clearInterval(interval);
                        gold += 20;
                        alert("Trabalho conclu√≠do! Ganhou 20 Ouro.");
                        button.textContent = `Trabalhar por Ouro (60s | Ganho: 20 üí∞)`;
                        button.disabled = false;
                        updateDisplay();
                        saveGame();
                    }
                }, 1000);
            }
        }
        
        /**
         * Realiza um treinamento que consome Gold e d√° EXP.
         */
        function trainForStats(type) {
            const cost = 25; // Gold
            const expGain = 10;
            
            if (gold >= cost) {
                gold -= cost;
                currentExp += expGain;
                
                let message = `Voc√™ gastou ${cost} üí∞ e ganhou ${expGain} EXP.`;
                
                alert(message);
                
                // Checa se subiu de n√≠vel
                if (currentExp >= expToNextLevel) {
                    levelUp();
                } else {
                    updateDisplay();
                }
                saveGame();
            } else {
                alert("Ouro insuficiente para treinar!");
            }
        }

        /**
         * Renderiza o painel de upgrades.
         */
        function renderUpgradePanel() {
            document.getElementById('upgrade-atk-display').textContent = heroBaseATK;
            document.getElementById('upgrade-hp-display').textContent = heroBaseHP;
            document.getElementById('atk-cost').textContent = atkUpgradeCost;
            document.getElementById('hp-cost').textContent = hpUpgradeCost;
        }

        /**
         * Compra um upgrade.
         */
        function buyUpgrade(type) {
            let cost = (type === 'atk') ? atkUpgradeCost : hpUpgradeCost;
            
            if (gold >= cost) {
                gold -= cost;
                if (type === 'atk') {
                    heroBaseATK += 1;
                    atkUpgradeCost = Math.round(atkUpgradeCost * 1.2); 
                } else if (type === 'hp') {
                    heroBaseHP += 10; 
                    hpUpgradeCost = Math.round(hpUpgradeCost * 1.2); 
                }
                
                alert(`${type === 'atk' ? 'Ataque Base' : 'HP Base'} melhorado!`);
                calculateStats(); // Recalcula o HP M√°ximo
                updateDisplay();
                saveGame();
            } else {
                alert("Ouro insuficiente!");
            }
        }

        // ====================================================================
        // V. AVENTURA (COMBATE)
        // ====================================================================
        
        /**
         * Seleciona um monstro apropriado para o n√≠vel do her√≥i e o define como o alvo atual.
         */
        function selectMonsterByLevel() {
            // L√≥gica simples: Pega um monstro aleat√≥rio cujo n√≠vel seja <= ao n√≠vel do her√≥i + 5
            const availableMonsters = MONSTERS.filter(m => m.level <= powerLevel + 5);
            
            if (availableMonsters.length === 0) {
                alert("N√£o h√° monstros dispon√≠veis para o seu n√≠vel no momento. Tente subir de n√≠vel!");
                return;
            }

            const randomIndex = Math.floor(Math.random() * availableMonsters.length);
            currentMonster = availableMonsters[randomIndex];
            monsterHP = currentMonster.baseHP; // Reseta HP do monstro

            renderAdventurePanel();
        }

        /**
         * Renderiza as informa√ß√µes do monstro atual no painel de aventura.
         */
        function renderAdventurePanel() {
            if (!currentMonster) return;

            document.getElementById('monster-name').textContent = currentMonster.name;
            document.getElementById('monster-hp-display').textContent = `${monsterHP}/${currentMonster.baseHP}`;
            document.getElementById('monster-atk-display').textContent = currentMonster.baseATK;
            document.getElementById('monster-cost-display').textContent = currentMonster.goldCost;
            document.getElementById('monster-reward-exp').textContent = currentMonster.expReward;
            document.getElementById('monster-reward-gold').textContent = currentMonster.goldReward;
            document.getElementById('monster-reward-soul').textContent = 0; // Soul √© zero por enquanto
            
            document.getElementById('start-battle-button').textContent = `Iniciar Batalha! (Custo: ${currentMonster.goldCost} üí∞)`;
            
            // Verifica se o her√≥i tem gold suficiente
            if (gold < currentMonster.goldCost) {
                document.getElementById('start-battle-button').disabled = true;
                document.getElementById('combat-log').innerHTML = '<p style="color: red;">[Voc√™ precisa de mais Ouro para esta batalha.]</p>';
            } else {
                document.getElementById('start-battle-button').disabled = false;
            }
        }

        /**
         * Inicia o ciclo de combate (uma √∫nica a√ß√£o).
         */
        function startBattle() {
            if (!currentMonster) {
                selectMonsterByLevel();
                return;
            }
            
            if (gold < currentMonster.goldCost) {
                alert("Ouro insuficiente para iniciar a batalha!");
                return;
            }

            // Custo da Batalha (Gold)
            gold -= currentMonster.goldCost;
            
            // 1. Dano do Her√≥i (Simplificado: ATK Total)
            const heroDamage = heroTotalATK;
            monsterHP -= heroDamage;
            
            // 2. Dano do Monstro (Simplificado: 50% do ATK do monstro + um fator aleat√≥rio)
            const monsterDamage = Math.max(1, Math.floor(currentMonster.baseATK * 0.5 + Math.random() * currentMonster.baseATK * 0.5));
            heroCurrentHP -= monsterDamage;

            let log = document.getElementById('combat-log');
            let logMessage = '';

            // Monstro Morreu?
            if (monsterHP <= 0) {
                const exp = currentMonster.expReward;
                const goldR = currentMonster.goldReward;
                
                currentExp += exp;
                gold += goldR;

                logMessage += `[Vit√≥ria!] Voc√™ derrotou o ${currentMonster.name}! Ganhou ${exp} EXP e ${goldR} üí∞.<br>`;
                
                // Loot (Implementa√ß√£o simples)
                const drops = currentMonster.dropItems || [];
                drops.forEach(drop => {
                    if (Math.random() < drop.chance) {
                        const item = ITEM_DATABASE.find(i => i.id === drop.itemId);
                        if (item) {
                            addItemToInventory(item, 1, false);
                            logMessage += `[Loot] Voc√™ encontrou 1x ${item.name}.<br>`;
                        }
                    }
                });

                // Seleciona o pr√≥ximo monstro
                selectMonsterByLevel();
                
            } else if (heroCurrentHP <= 0) {
                // Her√≥i Morreu (Simples: Reseta HP)
                heroCurrentHP = 1; // Deixa com 1 HP para n√£o travar
                logMessage += `<span style="color: red;">[Derrota!] Voc√™ foi derrotado pelo ${currentMonster.name}! HP foi resetado para 1.</span><br>`;
                selectMonsterByLevel(); // Muda de monstro ap√≥s derrota
                
            } else {
                // Combate Continua
                logMessage += `Voc√™ atacou ${currentMonster.name} (${heroDamage} Dano).<br>`;
                logMessage += `${currentMonster.name} contra-atacou (${monsterDamage} Dano).<br>`;
            }

            log.innerHTML = logMessage + log.innerHTML;
            
            // Checa se subiu de n√≠vel
            if (currentExp >= expToNextLevel) {
                levelUp();
            } else {
                updateDisplay();
            }
            saveGame();
        }

        // ====================================================================
        // VI. INVENT√ÅRIO E EQUIPAMENTO
        // ====================================================================

        function findItemInDatabase(itemId) {
            return ITEM_DATABASE.find(item => item.id === itemId);
        }

        /**
         * Adiciona um item ao invent√°rio.
         */
        function addItemToInventory(item, quantity = 1, showAlert = true) {
            const existingItem = inventory.find(i => i.id === item.id);
            if (existingItem) {
                existingItem.quantity += quantity;
            } else {
                inventory.push({ ...item, quantity: quantity });
            }
            renderInventoryPanel();
            saveGame();
            if (showAlert) alert(`${item.name} (${quantity}) adicionado ao invent√°rio.`);
        }

        /**
         * Remove um item do invent√°rio.
         */
        function removeItemFromInventory(item, quantity = 1) {
            const index = inventory.findIndex(i => i.id === item.id);
            if (index !== -1) {
                if (inventory[index].quantity > quantity) {
                    inventory[index].quantity -= quantity;
                } else {
                    inventory.splice(index, 1);
                }
                renderInventoryPanel();
                saveGame();
                return true;
            }
            return false;
        }

        /**
         * Renderiza o painel do invent√°rio.
         */
        function renderInventoryPanel() {
            const grid = document.getElementById('inventory-grid');
            grid.innerHTML = '';
            
            document.getElementById('inventory-count').textContent = inventory.length;

            inventory.forEach(item => {
                const isEquipped = EQUIPMENT_SLOTS[item.type] && EQUIPMENT_SLOTS[item.type].currentItem && EQUIPMENT_SLOTS[item.type].currentItem.id === item.id;
                
                const card = document.createElement('div');
                card.className = `item-card ${isEquipped ? 'equipped' : ''}`;
                card.title = item.name;
                card.onclick = () => inspectItem(item);
                
                card.innerHTML = `
                    <span style="font-size: 24px;">${item.type === 'weapon' ? '‚öîÔ∏è' : item.type === 'armor' ? 'üõ°Ô∏è' : '‚ú®'}</span>
                    <p>${item.name}</p>
                    <p style="font-size: 0.8em; color: var(--color-accent);">x${item.quantity}</p>
                `;
                grid.appendChild(card);
            });
            
            // Esconde o painel de inspe√ß√£o se o item inspecionado sumiu
            if (inspectedItem && !inventory.some(i => i.id === inspectedItem.id)) {
                document.getElementById('item-inspection-panel').style.display = 'none';
                inspectedItem = null;
            }
        }
        
        /**
         * Renderiza o painel de equipamento.
         */
        function renderEquipmentPanel() {
            const equipmentList = document.getElementById('equipment-list');
            equipmentList.innerHTML = '';

            for (const key in EQUIPMENT_SLOTS) {
                const slotData = EQUIPMENT_SLOTS[key];
                const item = slotData.currentItem;

                const slotDiv = document.createElement('div');
                slotDiv.className = 'slot-container';

                const itemDisplay = item 
                    ? `<div class="equipped-item-display item-card" onclick="inspectItem(${JSON.stringify(item).replace(/"/g, '&quot;')})">
                         <span style="font-size: 1.5em;">${item.type === 'weapon' ? '‚öîÔ∏è' : 'üõ°Ô∏è'}</span>
                         <p>${item.name}</p>
                         <p style="font-size: 0.8em; color: var(--color-hp);">ATK:${item.atk||0} HP:${item.hpBonus||0}</p>
                       </div>`
                    : `<span class="empty-slot">Vazio</span>`;

                slotDiv.innerHTML = `<span class="slot-label">${slotData.name}</span>${itemDisplay}`;
                equipmentList.appendChild(slotDiv);
            }
            
            // Atualiza o painel de Stats no Equipment
            document.getElementById('eq-max-hp').textContent = heroMaxHP;
            document.getElementById('eq-base-hp').textContent = heroBaseHP + (powerLevel * 20); // Base + N√≠vel
            document.getElementById('eq-total-atk').textContent = heroTotalATK;
            document.getElementById('eq-base-atk').textContent = heroBaseATK + (powerLevel * 1); // Base + N√≠vel
            
            let bonusHp = 0;
            let bonusAtk = 0;
            for (const slotKey in EQUIPMENT_SLOTS) {
                const item = EQUIPMENT_SLOTS[slotKey].currentItem;
                if (item) {
                    bonusHp += item.hpBonus || 0;
                    bonusAtk += item.atk || 0;
                }
            }
            document.getElementById('eq-bonus-hp').textContent = bonusHp;
            document.getElementById('eq-bonus-atk').textContent = bonusAtk;
            document.getElementById('hero-current-hp').textContent = heroCurrentHP;
        }

        /**
         * Exibe os detalhes de um item inspecionado.
         */
        function inspectItem(item) {
            inspectedItem = item;
            const panel = document.getElementById('item-inspection-panel');
            
            document.getElementById('inspected-item-name').textContent = item.name;
            document.getElementById('inspected-item-rarity').textContent = item.rarity;
            document.getElementById('inspected-item-type').textContent = item.type;
            document.getElementById('inspected-item-description').textContent = item.description;
            
            let statsHtml = '';
            if (item.atk) statsHtml += `ATK: +${item.atk}<br>`;
            if (item.hpBonus) statsHtml += `HP M√°x: +${item.hpBonus}<br>`;
            document.getElementById('inspected-item-stats').innerHTML = statsHtml;

            const actionButton = document.getElementById('item-action-button');
            const sellButton = document.getElementById('item-sell-button');
            
            sellButton.textContent = `Vender (${item.price || 10} üí∞)`;
            sellButton.onclick = () => sellItem(item);

            const isEquipped = EQUIPMENT_SLOTS[item.type] && EQUIPMENT_SLOTS[item.type].currentItem && EQUIPMENT_SLOTS[item.type].currentItem.id === item.id;
            
            if (isEquipped) {
                actionButton.textContent = 'DESEQUIPAR';
                actionButton.onclick = () => unequipItem(item);
                actionButton.style.backgroundColor = 'var(--color-combat)';
                actionButton.disabled = false;
            } else if (item.type === 'weapon' || item.type === 'armor') {
                actionButton.textContent = 'EQUIPAR';
                actionButton.onclick = () => equipItem(item);
                actionButton.style.backgroundColor = 'var(--color-accent)';
                actionButton.disabled = false;
            } else if (item.type === 'consumable') {
                actionButton.textContent = 'USAR';
                actionButton.onclick = () => useItem(item);
                actionButton.style.backgroundColor = 'var(--color-hp)';
                actionButton.disabled = false;
            } else {
                 actionButton.textContent = '...';
                 actionButton.onclick = () => {};
                 actionButton.disabled = true;
                 actionButton.style.backgroundColor = 'var(--color-secondary)';
            }

            panel.style.display = 'block';
        }

        /**
         * Equipa um item.
         */
        function equipItem(item, showAlert = true) {
            const slotKey = item.type;
            
            if (!EQUIPMENT_SLOTS[slotKey]) {
                if (showAlert) alert(`N√£o h√° slot de equipamento para o tipo: ${slotKey}.`);
                return;
            }

            // O item est√° sendo equipado, ent√£o ele substitui o item atual no slot
            EQUIPMENT_SLOTS[slotKey].currentItem = item;
            
            // Atualiza todos os pain√©is
            renderEquipmentPanel();
            renderInventoryPanel();
            if (showAlert) inspectItem(item); // Reinspeciona para mostrar "DESEQUIPAR"
            saveGame();
            if (showAlert) alert(`${item.name} equipado no slot de ${EQUIPMENT_SLOTS[slotKey].name}.`);
        }
        
        /**
         * Desequipa o item.
         */
        function unequipItem(item) {
            const slotKey = item.type;
            
            if (EQUIPMENT_SLOTS[slotKey].currentItem && EQUIPMENT_SLOTS[slotKey].currentItem.id === item.id) {
                 EQUIPMENT_SLOTS[slotKey].currentItem = null;
                 alert(`${item.name} desequipado.`);
            }
            
            // Atualiza todos os pain√©is
            renderEquipmentPanel();
            renderInventoryPanel();
            // Reinspeciona para atualizar o bot√£o para "EQUIPAR"
            if (inspectedItem) {
                inspectItem(inspectedItem); 
            }
            saveGame();
        }
        
        /**
         * Usa um item consum√≠vel.
         */
        function useItem(item) {
            if (item.type !== 'consumable') {
                alert(`Voc√™ n√£o pode usar ${item.name} desta forma.`);
                return;
            }

            if (removeItemFromInventory(item, 1)) {
                if (item.effect && item.effect.hp) {
                    const healAmount = item.effect.hp;
                    heroCurrentHP = Math.min(heroCurrentHP + healAmount, heroMaxHP);
                    alert(`Voc√™ usou ${item.name} e recuperou ${healAmount} HP.`);
                }
                
                calculateStats();
                updateDisplay();
                saveGame();
            }
        }
        
        /**
         * Vende o item inspecionado.
         */
        function sellItem(item) {
            const price = item.price || 10; // Pre√ßo base
            
            if (removeItemFromInventory(item, 1)) {
                gold += price;
                alert(`Voc√™ vendeu 1x ${item.name} por ${price} Gold.`);
                
                // Esconde o painel de inspe√ß√£o se o item acabou
                const inventoryItem = inventory.find(i => i.id === item.id);
                if (!inventoryItem || inventoryItem.quantity === 0) {
                     document.getElementById('item-inspection-panel').style.display = 'none';
                     inspectedItem = null;
                }
                
                updateDisplay();
                saveGame();
            }
        }
        
        // ====================================================================
        // VII. PAINEL DE STATUS
        // ====================================================================

        function renderStatusPanel() {
            document.getElementById('status-hero-name').textContent = heroName;
            document.getElementById('status-hero-class').textContent = selectedClassKey ? CLASSES[selectedClassKey].name : 'N/A';
            document.getElementById('status-power-level').textContent = powerLevel;
            document.getElementById('status-exp').textContent = currentExp;
            document.getElementById('status-exp-needed').textContent = expToNextLevel;
            
            document.getElementById('status-max-hp').textContent = heroMaxHP;
            document.getElementById('status-total-atk').textContent = heroTotalATK;
            
            document.getElementById('status-gold').textContent = gold;
            document.getElementById('status-soul').textContent = soul;
            // document.getElementById('status-energy').textContent = `${currentEnergy}/${maxEnergy}`; // REMOVIDO
        }


        // ====================================================================
        // VIII. SALVAMENTO E CARREGAMENTO
        // ====================================================================

        /**
         * Salva o estado atual do jogo no LocalStorage.
         */
        function saveGame(showAlert = false) {
            const gameData = {
                gameInitialized: gameInitialized,
                heroName: heroName,
                selectedClassKey: selectedClassKey,
                powerLevel: powerLevel,
                currentExp: currentExp,
                expRequired: expToNextLevel,
                gold: gold,
                soul: soul,
                heroCurrentHP: heroCurrentHP,
                
                // Vari√°veis de Status e Upgrades
                heroBaseHP: heroBaseHP,
                heroBaseATK: heroBaseATK,
                atkCost: atkUpgradeCost,
                hpCost: hpUpgradeCost,

                inventory: inventory,
                equipment: {
                    weapon: EQUIPMENT_SLOTS.weapon.currentItem,
                    armor: EQUIPMENT_SLOTS.armor.currentItem,
                    // accessory: EQUIPMENT_SLOTS.accessory.currentItem,
                },
                
                currentMonster: currentMonster,
                monsterHP: monsterHP,
            };
            localStorage.setItem('blazeAndSteelSave', JSON.stringify(gameData));
            if (showAlert) alert("Jogo Salvo!");
        }

        /**
         * Carrega o estado do jogo do LocalStorage.
         */
        function loadGame(shouldAlert = false) {
            const savedData = localStorage.getItem('blazeAndSteelSave');
            if (savedData) {
                const gameData = JSON.parse(savedData);

                gameInitialized = gameData.gameInitialized || false;
                if (!gameInitialized) {
                    if (shouldAlert) alert("Nenhum jogo salvo encontrado.");
                    return;
                }

                heroName = gameData.heroName || "Her√≥i Desconhecido";
                selectedClassKey = gameData.selectedClassKey || null;
                
                // Carrega N√≠vel e Recursos
                powerLevel = gameData.powerLevel || 1;
                currentExp = gameData.currentExp || 0;
                expToNextLevel = gameData.expRequired || 50;
                gold = gameData.gold || 0;
                soul = gameData.soul || 0;
                heroCurrentHP = gameData.heroCurrentHP || 10;
                // currentEnergy = gameData.currentEnergy || 10; // REMOVIDO
                // maxEnergy = gameData.maxEnergy || 10;         // REMOVIDO
                
                // Carrega Upgrades
                heroBaseHP = gameData.heroBaseHP || 10;
                heroBaseATK = gameData.heroBaseATK || 1;
                atkUpgradeCost = gameData.atkCost || 50;
                hpUpgradeCost = gameData.hpCost || 50;

                // Carrega Invent√°rio e Equipamento
                inventory = gameData.inventory || [];
                if (gameData.equipment) {
                    EQUIPMENT_SLOTS.weapon.currentItem = gameData.equipment.weapon;
                    EQUIPMENT_SLOTS.armor.currentItem = gameData.equipment.armor;
                    // EQUIPMENT_SLOTS.accessory.currentItem = gameData.equipment.accessory;
                }
                
                // Carrega Combate
                currentMonster = gameData.currentMonster || null;
                monsterHP = gameData.monsterHP || 0;


                if (shouldAlert) alert("Jogo Carregado!");
                
                document.getElementById('start-menu').style.display = 'none';
                document.getElementById('sidebar').style.display = 'flex';
                document.getElementById('main-content').style.display = 'block';
                
                calculateStats();
                updateDisplay();
                startThemeMusic(); 
                showPanel('training-panel'); // Volta para a tela principal
            } else if (shouldAlert) {
                alert("Nenhum jogo salvo encontrado.");
            }
        }

        /**
         * Deleta o jogo salvo e reinicia a p√°gina.
         */
        function deleteGame(showAlert = false) {
            if (confirm("Tem certeza que deseja REINICIAR o jogo? Todo o progresso ser√° perdido.")) {
                localStorage.removeItem('blazeAndSteelSave');
                gameInitialized = false;
                location.reload(); 
            }
        }

        /**
         * Tenta iniciar a m√∫sica tema.
         */
        function startThemeMusic() {
            const audio = document.getElementById('game-theme-music');
            if (audio) {
                // Tenta dar play na m√∫sica. Navegadores modernos podem bloquear o autoplay
                // at√© que o usu√°rio interaja com a p√°gina (um clique, por exemplo).
                audio.play().catch(error => {
                    // console.log("Autoplay bloqueado. O usu√°rio pode ter que interagir.");
                });
            }
        }
        
        /**
         * Alterna o estado Mute/Unmute.
         */
        function toggleMute() {
             const audio = document.getElementById('game-theme-music');
             const button = document.getElementById('audio-control-button');
             if (audio.muted) {
                 audio.muted = false;
                 button.textContent = 'üîä Mute';
             } else {
                 audio.muted = true;
                 button.textContent = 'üîá Unmute';
             }
        }
        
        /**
         * Define o volume do √°udio.
         */
        function setVolume(value) {
            const volume = value / 100;
            const audio = document.getElementById('game-theme-music');
            const labelStart = document.getElementById('volume-label-start');
            const labelGame = document.getElementById('volume-label-game');
            const sliderStart = document.getElementById('volume-slider-start');
            const sliderGame = document.getElementById('volume-slider-game');

            if (audio) audio.volume = volume;
            if (labelStart) labelStart.textContent = value;
            if (labelGame) labelGame.textContent = value;
            if (sliderStart) sliderStart.value = value;
            if (sliderGame) sliderGame.value = value;
        }

        // ====================================================================
        // IX. INICIALIZA√á√ÉO
        // ====================================================================

        loadGame();
        
        // Define o volume inicial nos sliders, mesmo que o loadGame n√£o tenha iniciado o jogo
        setVolume(100); 

    </script>

</body>
</html>
