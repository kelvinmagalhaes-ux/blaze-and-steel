<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BLAZE AND STEEL</title>
    <style>
        /* Vari√°veis de Cores (CSS Custom Properties) */
        :root {
            --color-primary: #1e1e2d;
            --color-secondary: #36364f;
            --color-text: #e0e0e0;
            --color-accent: #f39c12; /* Ouro */
            --color-combat: #c0392b; /* Combate/Aventura */
            --color-evolve: #8e44ad; /* Evoluir/Treinamento */
            --color-energy: #3498db; /* Energia */
            --color-soul: #9b59b6; /* Alma/Reencarna√ß√£o */
            --color-hp: #2ecc71; /* HP/Vida */
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--color-primary);
            color: var(--color-text);
            margin: 0;
            display: flex;
            min-height: 100vh;
            overflow: hidden; 
        }

        /* Estrutura Geral */
        #app-wrapper {
            display: flex;
            width: 100%;
        }

        /* Sidebar (Menu Lateral) */
        #sidebar {
            width: 200px;
            background-color: var(--color-secondary);
            padding: 20px 0;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.5);
            display: none; 
            flex-shrink: 0; 
        }

        .sidebar-menu button {
            display: block;
            width: 100%;
            padding: 15px 20px;
            text-align: left;
            background: none;
            border: none;
            color: var(--color-text);
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
            display: flex; 
            align-items: center;
        }

        .sidebar-menu button:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .sidebar-menu button.active {
            background-color: var(--color-evolve);
            font-weight: bold;
            color: white; 
        }
        
        .sidebar-menu button::before {
            content: ''; 
            margin-right: 10px;
            font-size: 1.2em;
            width: 25px; 
            text-align: center;
        }
        
        /* Defini√ß√£o de √çcones */
        #btn-training::before { content: 'üè†'; color: var(--color-evolve); } 
        #btn-adventure::before { content: 'üó∫Ô∏è'; color: var(--color-combat); } 
        #btn-upgrades::before { content: '‚è´'; color: var(--color-accent); } 
        #btn-equipment::before { content: '‚öîÔ∏è'; color: var(--color-hp); } 
        #btn-inventory::before { content: 'üì¶'; color: var(--color-energy); } 
        #btn-status::before { content: 'üë§'; color: var(--color-soul); } 
        #btn-expedition::before { content: 'üß≠'; color: #f1c40f; } 


        /* √Årea de Conte√∫do Principal */
        #main-content {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            max-height: 100vh;
            display: none; 
            position: relative; 
        }
        
        /* Bot√£o de √Åudio (Dentro do Jogo) */
        #audio-control-button {
            background-color: var(--color-secondary);
            border: 1px solid var(--color-accent);
            color: var(--color-text);
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            z-index: 10;
        }

        /* Pain√©is de Conte√∫do (Geral) */
        .content-panel {
            background-color: var(--color-secondary);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        /* Menu Inicial (Start Menu) */
        #start-menu {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100vh;
            position: fixed; 
            top: 0;
            left: 0;
            background-color: var(--color-primary);
            z-index: 100;
        }
        
        .game-logo {
            max-width: 90%;
            width: 500px;
            height: auto;
            margin-bottom: 50px;
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
        }

        .menu-button-stack button {
            display: block;
            width: 300px;
            padding: 15px 20px;
            margin: 10px 0;
            border: 2px solid var(--color-accent);
            border-radius: 5px;
            background-color: var(--color-combat);
            color: var(--color-text);
            font-size: 1.2em;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            box-shadow: 0 4px var(--color-accent);
        }

        .menu-button-stack button:hover {
            background-color: #e74c3c;
            transform: translateY(-2px);
            box-shadow: 0 6px var(--color-accent);
        }

        .menu-button-stack button:active {
            transform: translateY(2px);
            box-shadow: 0 2px var(--color-accent);
        }
        
        /* Estilo para o Slider de Volume */
        .volume-control-container {
            margin-top: 20px;
            padding: 10px;
            background-color: var(--color-secondary);
            border-radius: 5px;
            width: 300px;
            text-align: center;
        }

        .volume-control-container label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        /* Ajuste a posi√ß√£o do controle de volume para o menu inicial */
        #start-menu .volume-control-container {
            position: absolute;
            bottom: 33px; 
            left: 50%;
            transform: translateX(-50%);
            width: 90%; 
            max-width: 300px;
        }


        /* Painel de Cria√ß√£o de Personagem - ESTILO ISOLADO */
        #character-creation-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--color-primary);
            z-index: 99;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
            box-sizing: border-box;
        }

        #character-creation-panel .content-panel {
            max-width: 600px;
            margin: auto;
            padding: 30px;
            border: 2px solid var(--color-accent);
        }
        
        /* Header e Display de Recursos */
        #header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px 20px 0;
            border-bottom: 1px solid var(--color-secondary);
            margin-bottom: 20px;
        }

        .resource-display {
            display: flex;
            gap: 15px;
        }

        .resource-item {
            font-size: 1.1em;
            font-weight: bold;
        }

        .resource-item span {
            margin-left: 5px;
        }
        
        /* Bot√µes de A√ß√£o (Geral) */
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Estilo do Bot√£o Level Up */
        #hero-training-panel button#level-up-button {
            background-color: var(--color-evolve);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            margin-top: 10px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        #hero-training-panel button#level-up-button:hover:not(:disabled) {
            background-color: #6c3483;
        }
        
        /* Estilo para o logo ADVENTURE */
        #adventure-title-logo {
            display: block;
            margin: 0 auto 20px auto;
            max-width: 300px; 
            height: auto;
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
        }

        /* Estilo para os bot√µes de sele√ß√£o de classe */
        #class-selection-container button {
            background-color: var(--color-secondary); 
            color: var(--color-text); 
            border: 2px solid var(--color-primary); 
            padding: 10px 15px; 
            border-radius: 5px; 
            cursor: pointer;
            width: 150px;
            height: 150px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: border-color 0.2s, background-color 0.2s;
        }
        
        #class-selection-container button img {
            max-width: 80px; 
            max-height: 80px; 
            margin-bottom: 5px;
            border-radius: 5px;
        }
        
        #class-selection-container button:hover {
            border-color: var(--color-energy);
        }

        /* Estilos para o Invent√°rio */
        .item-card {
            background-color: #2c3e50;
            border: 2px solid var(--color-secondary);
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
        }

        .item-card:hover {
            background-color: #34495e;
            border-color: var(--color-accent);
        }
        
        .item-card.equipped {
            border-color: var(--color-hp); 
            box-shadow: 0 0 5px var(--color-hp);
        }

        .item-card p {
            margin: 5px 0 0 0;
            font-size: 0.9em;
        }

        /* -------------------------------------- */
        /* NOVO CSS: PAINEL DE EQUIPAMENTO VISUAL */
        /* -------------------------------------- */
        
        #equipment-layout {
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }
        
        #hero-display-container {
            position: relative; 
            width: 300px; 
            min-width: 300px;
            height: 450px; 
            background-color: #2c3e50; /* Fundo escuro para a √°rea */
            border-radius: 8px;
            margin: 0 auto;
        }

        #hero-image-display {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain; /* Ajusta a imagem sem distorcer */
            image-rendering: pixelated; 
            opacity: 0.8; /* Leve transpar√™ncia para focar no equipamento */
        }
        
        /* Estilo Base dos Slots Flutuantes */
        .equipment-slot-floating {
            position: absolute;
            width: 90px;
            height: 90px; 
            padding: 5px;
            background-color: rgba(52, 73, 94, 0.8); /* Azul escuro semi-transparente */
            border: 2px dashed var(--color-accent);
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
            font-size: 0.8em;
            overflow: hidden;
            transition: background-color 0.2s, transform 0.1s;
        }
        
        .equipment-slot-floating:hover {
            background-color: rgba(52, 73, 94, 1.0);
            transform: scale(1.05);
        }
        
        .slot-name {
            display: block;
            font-weight: bold;
            color: var(--color-energy);
            margin-bottom: 2px;
        }

        .slot-item-name {
            color: var(--color-text);
            font-size: 0.9em;
        }

        .slot-empty {
            color: #7f8c8d;
            font-style: italic;
        }

        /* Posicionamento dos Slots */
        /* Lado Esquerdo do Her√≥i */
        #slot-helmet { top: 10px; left: 10px; }
        #slot-weapon { top: 100px; left: 10px; }
        #slot-gloves { top: 190px; left: 10px; }
        #slot-boots { top: 380px; left: 10px; }

        /* Lado Direito do Her√≥i */
        #slot-armor { top: 10px; right: 10px; }
        #slot-accessory { top: 100px; right: 10px; }
        #slot-ring { top: 190px; right: 10px; }
        #slot-amulet { top: 280px; right: 10px; }

        /* O slot de armadura √© o maior na silhueta, mas o item de "armor" (peito) geralmente fica no lado direito na interface cl√°ssica */
        
        /* -------------------------------------- */
        /* RESPONSIVIDADE (MOBILE / TELAS PEQUENAS) */
        /* -------------------------------------- */
        @media (max-width: 768px) {
            
            /* Estrutura Principal */
            body {
                overflow-y: auto; 
            }

            #app-wrapper {
                flex-direction: column; 
            }
            
            /* Sidebar (Menu) */
            #sidebar {
                width: 100%; 
                padding: 10px 0;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
                order: -1; 
            }

            .sidebar-menu {
                display: flex; 
                flex-wrap: wrap;
                justify-content: space-around;
                gap: 5px;
            }

            .sidebar-menu button {
                width: 45%; 
                text-align: center;
                padding: 8px 10px;
                font-size: 0.9em;
                justify-content: center; 
            }
            
            /* Remove o √≠cone extra para economizar espa√ßo no mobile */
            .sidebar-menu button::before {
                content: none !important; 
                margin-right: 0;
                width: auto;
            }

            /* Conte√∫do Principal */
            #main-content {
                padding: 10px;
            }

            /* Header (Recursos) */
            #header {
                flex-direction: column;
                align-items: flex-start;
                padding-bottom: 10px;
                margin-bottom: 10px;
            }

            .resource-display {
                flex-wrap: wrap;
                gap: 8px 15px; 
            }
            
            /* Logo de Aventura */
            #adventure-title-logo {
                max-width: 100%;
            }
            
            /* Equipamento Mobile: Layout em coluna, o display do her√≥i vem primeiro */
            #equipment-layout {
                flex-direction: column;
                align-items: center;
            }
            
            #hero-display-container {
                width: 100%;
                max-width: 400px;
                height: 400px;
                margin-bottom: 20px;
            }
            
            /* Ajuste o posicionamento dos slots para o Mobile (mantendo as propor√ß√µes) */
            .equipment-slot-floating {
                width: 80px;
                height: 80px;
            }

            /* Lado Esquerdo do Her√≥i */
            #slot-helmet { top: 10px; left: 10px; }
            #slot-weapon { top: 100px; left: 10px; }
            #slot-gloves { top: 190px; left: 10px; }
            #slot-boots { top: 310px; left: 10px; } /* Ajustado para caber */

            /* Lado Direito do Her√≥i */
            #slot-armor { top: 10px; right: 10px; }
            #slot-accessory { top: 100px; right: 10px; }
            #slot-ring { top: 190px; right: 10px; }
            #slot-amulet { top: 280px; right: 10px; }
        }
    </style>
</head>
<body>
    
    <audio id="game-theme-music" loop>
        <source src="assets/theme_music.mp3" type="audio/mpeg"> 
        Seu navegador n√£o suporta a tag de √°udio.
    </audio>

    <div id="app-wrapper">

        <div id="start-menu">
            <img src="assets/blaze-and-steel.png" alt="Blaze and Steel Logo" class="game-logo"> 
            
            <div class="menu-button-stack">
                <button onclick="showCharacterCreation()">NOVO JOGO</button> 
                <button onclick="loadGame(true)">CARREGAR JOGO</button>
                <button onclick="alert('Sair: Por enquanto, feche a aba.')">SAIR</button>
            </div>
            
            <div class="volume-control-container">
                <label for="volume-slider-start">üé∂ Volume: <span id="volume-label-start">100</span></label>
                <input type="range" id="volume-slider-start" min="0" max="100" value="100" oninput="setVolume(this.value)">
            </div>
        </div>

        <div id="character-creation-panel" style="display: none;">
            <div class="content-panel" style="text-align: center;">
                <h2>Crie Seu Her√≥i!</h2>
                <p>Escolha um nome e uma classe para come√ßar sua aventura.</p>
                
                <div style="margin: 20px 0;">
                    <label for="hero-name-input" style="font-weight: bold; display: block; margin-bottom: 5px;">Nome do Her√≥i:</label>
                    <input type="text" id="hero-name-input" placeholder="Ex: Her√≥i Blaze" maxlength="20" style="padding: 10px; font-size: 1.2em; width: 80%; max-width: 300px; border-radius: 5px; border: 1px solid var(--color-accent); background-color: var(--color-primary); color: var(--color-text);">
                </div>
                
                <h3>Selecione Sua Classe:</h3>
                <div id="class-selection-container" style="display: flex; justify-content: center; flex-wrap: wrap; gap: 15px;">
                    </div>
                
                <div id="class-details" class="content-panel" style="margin-top: 20px; display: none; text-align: left; max-width: 500px; margin-left: auto; margin-right: auto;">
                    <h4>Detalhes da Classe Selecionada</h4>
                    <p><strong>Classe:</strong> <span id="selected-class-name"></span></p>
                    <p><strong>Estat√≠sticas Iniciais:</strong></p>
                    <ul>
                        <li>‚ù§Ô∏è HP Base: <span id="class-base-hp"></span></li>
                        <li>‚öîÔ∏è ATK Base: <span id="class-base-atk"></span></li>
                        <li>‚ö° Energia Inicial: <span id="class-initial-energy"></span></li>
                        <li style="font-weight: bold;">‚öîÔ∏è Equipamento Inicial: <span id="class-initial-equipment"></span></li>
                    </ul>
                    <p style="font-style: italic;"></p>
                    
                    <button id="confirm-creation-button" disabled onclick="finalizeCreation()" style="background-color: var(--color-evolve); color: white; padding: 12px 25px; border: none; border-radius: 5px; margin-top: 15px; width: 100%;">
                        INICIAR JOGO!
                    </button>
                </div>
            </div>
        </div>

        <div id="sidebar">
            <div id="hero-info" style="text-align: center; margin-bottom: 20px;">
                <h3 id="hero-name"></h3>
                <p>N√≠vel: <span id="power-level">1</span></p>
            </div>
            <nav class="sidebar-menu">
                <button id="btn-training" onclick="showPanel('training-panel')" class="active">Quartel-General</button>
                <button id="btn-adventure" onclick="showPanel('adventure-panel')">Aventura</button>
                <button id="btn-upgrades" onclick="showPanel('upgrades-panel')">Upgrades</button>
                <button id="btn-equipment" onclick="showPanel('equipment-panel')">Equipamento</button>
                <button id="btn-inventory" onclick="showPanel('inventory-panel')">Invent√°rio</button>
                <button id="btn-status" onclick="showPanel('status-panel')">Status</button>
                <button id="btn-expedition" onclick="showPanel('expedition-panel')">Expedi√ß√£o</button>
            </nav>
        </div>

        <div id="main-content">
            
            <div style="position: absolute; top: 10px; right: 10px; z-index: 10; text-align: right;">
                <button id="audio-control-button" onclick="toggleMute()" style="margin-bottom: 5px;">
                    üîä Mute
                </button>
                
                <div class="volume-control-container" style="width: 150px; padding: 5px; margin-left: auto;">
                    <label for="volume-slider-game" style="font-size: 0.8em; margin: 0;">Volume: <span id="volume-label-game">100</span></label>
                    <input type="range" id="volume-slider-game" min="0" max="100" value="100" oninput="setVolume(this.value)">
                </div>
            </div>


            <div id="header">
                <h2></h2>
                <div class="resource-display">
                    <div class="resource-item" style="color: var(--color-energy);">‚ö° Energia: <span id="energy-count">0</span></div>
                    <div class="resource-item" style="color: var(--color-accent);">üí∞ Ouro: <span id="gold-count">0</span></div>
                    <div class="resource-item" style="color: var(--color-soul);">üíÄ Alma: <span id="soul-count">0</span></div>
                </div>
            </div>

            <div id="content-area">
                
                <div id="training-panel" style="display: none;">
                    
                    <div id="special-missions-panel" class="content-panel" style="text-align: center;">
                        <h3>Miss√µes Especiais</h3>
                        <p>Progresso r√°pido e recompensas raras!</p>

                        <div id="daily-missions" style="margin-bottom: 15px;">
                            <h4>Di√°rias (Reseta em 24h)</h4>
                            <button id="daily-scouting" class="mission-button mission-daily" onclick="startDailyMission('scouting')">
                                Fazer Patrulha (Recompensa: 100 EXP | 50 üí∞)
                            </button>
                            <button id="daily-training-drills" class="mission-button mission-daily" onclick="startDailyMission('drills')">
                                Exerc√≠cios de Treinamento (Recompensa: 200 EXP | +2 ATK B√¥nus!)
                            </button>
                        </div>

                        <div id="unique-missions">
                            <h4>√önicas (Desaparecem ap√≥s concluir)</h4>
                            <button id="unique-first-quest" class="mission-button mission-unique" onclick="startUniqueMission('firstQuest')">
                                Provar o Valor (Recompensa: 500 EXP | +10 HP B√¥nus!)
                            </button>
                            <button id="unique-tutorial-complete" class="mission-button mission-unique" onclick="startUniqueMission('tutorialComplete')">
                                Finalizar Tutorial B√°sico (Recompensa: 100 üí∞ | 100 ‚ö°)
                            </button>
                        </div>
                    </div>

                    <div id="resource-missions-panel" class="content-panel" style="text-align: center;">
                        <h3>Obten√ß√£o de Recursos (Cooldowns)</h3>
                        
                        <button id="provisions-button" onclick="startMission('provisions')" style="background-color: var(--color-energy); color: black; padding: 10px; margin: 5px;">
                            Coletar Provis√µes (30s | Ganho: 50 ‚ö°)
                        </button>
                        
                        <button id="work-gold-button" onclick="startMission('workGold')" style="background-color: var(--color-accent); color: black; padding: 10px; margin: 5px;">
                            Trabalhar por Ouro (60s | Ganho: 20 üí∞)
                        </button>
                    </div>

                    <div id="hero-training-panel" class="content-panel" style="text-align: center;">
                        <h3>Treinamento & Progresso</h3>
                        <p>Gaste Energia para aumentar sua EXP e preparo.</p>

                        <button onclick="trainForStats('attack')" style="background-color: var(--color-combat); color: white; padding: 10px; margin: 5px;">
                            Estudar T√°ticas (Custo: 25 ‚ö° | Ganho: 10 EXP)
                        </button>
                        
                        <button onclick="trainForStats('defense')" style="background-color: var(--color-hp); color: white; padding: 10px; margin: 5px;">
                            Preparar Defesas (Custo: 25 ‚ö° | Ganho: 10 EXP)
                        </button>

                        <div style="margin-top: 20px;">
                            <p>üåü N√≠vel de Poder: <span id="power-level-display">1</span></p>
                            <p>‚ú® EXP: <span id="exp-count">0</span> / <span id="exp-required">50</span></p>
                            <button id="level-up-button" onclick="levelUp()" disabled style="background-color: var(--color-evolve); color: white;">
                                SUBIR DE N√çVEL (Falta: 50 EXP)
                            </button>
                        </div>
                    </div>
                </div>

                <div id="adventure-panel" style="display: none;">
                    
                    <img src="assets/adventure.png" alt="ADVENTURE" id="adventure-title-logo">
                    
                    <div class="content-panel" style="display: flex; justify-content: space-between;">
                        
                        <div style="flex: 1; margin-right: 20px;">
                            <h2 id="monster-name">Monstro</h2>
                            <div id="monster-image" style="background-color: #7f8c8d; width: 150px; height: 150px; border-radius: 8px; margin-bottom: 10px;">
                                </div>
                            <p>‚ù§Ô∏è HP: <span id="monster-hp-display">0</span> / 0</p>
                            <p>‚öîÔ∏è ATK: <span id="monster-atk-display">0</span></p>
                            <p style="font-size: 0.9em;">Recompensa: <span id="monster-reward-exp">0</span> EXP, <span id="monster-reward-gold">0</span> üí∞</p>
                            
                            <button id="start-battle-button" onclick="startBattle()" style="background-color: var(--color-combat); color: white; padding: 10px 20px; margin-top: 15px;">
                                Iniciar Batalha! (Custo: 5 ‚ö°)
                            </button>
                        </div>

                        <div style="flex: 2; background-color: #2c3e50; padding: 15px; border-radius: 5px; height: 250px; overflow-y: auto;">
                            <h3>üìù Log de Combate</h3>
                            <div id="combat-log">
                                <p>A batalha come√ßar√° aqui. Selecione um monstro.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="content-panel">
                        <h3>Estat√≠sticas de Batalha do Her√≥i</h3>
                        <div id="hero-battle-stats" style="display: flex; justify-content: space-around; text-align: center;">
                            <p>‚ù§Ô∏è HP: <span id="hero-current-hp">10</span> / <span id="hero-max-hp">10</span></p>
                            <p>‚öîÔ∏è ATK: <span id="hero-total-atk">1</span></p>
                            <p>üí• Dano por N√≠vel: x<span id="hero-level-multiplier">1</span></p>
                        </div>
                    </div>

                    <div class="content-panel">
                        <h3>Skills Ativas</h3>
                        <p>Use a seu favor em combate! (Funcionalidade futura)</p>
                        <button disabled style="background-color: #3498db;">Ataque Forte (5 ‚ö°)</button>
                        <button disabled style="background-color: #2ecc71;">Cura R√°pida (10 üí∞)</button>
                    </div>
                </div>

                
                <div id="upgrades-panel" class="content-panel" style="display: none;">
                    <h2>‚ú® Upgrades de Batalha</h2>
                    <p>Gaste seu Ouro para melhorar permanentemente suas estat√≠sticas de combate!</p>
                    
                    <div style="display: flex; gap: 20px; margin-top: 20px;">
                        
                        <div class="content-panel" style="flex: 1; text-align: center;">
                            <h3>Aumento de Ataque</h3>
                            <p>‚öîÔ∏è Dano Base Atual: <span id="upgrade-atk-display">1</span></p>
                            <p>Pr√≥ximo N√≠vel: +1 ATK</p>
                            <button id="buy-atk-upgrade" onclick="buyUpgrade('atk')" style="background-color: var(--color-combat);">
                                Comprar (Custo: <span id="atk-cost">50</span> üí∞)
                            </button>
                        </div>

                        <div class="content-panel" style="flex: 1; text-align: center;">
                            <h3>Aumento de Vida</h3>
                            <p>‚ù§Ô∏è HP Base Atual: <span id="upgrade-hp-display">10</span></p>
                            <p>Pr√≥ximo N√≠vel: +10 HP</p>
                            <button id="buy-hp-upgrade" onclick="buyUpgrade('hp')" style="background-color: var(--color-hp);">
                                Comprar (Custo: <span id="hp-cost">50</span> üí∞)
                            </button>
                        </div>
                    </div>
                </div>

                <div id="equipment-panel" style="display: none;">
                    <h2>üõ°Ô∏è Equipamento & Estat√≠sticas</h2>
                    
                    <div id="equipment-layout" class="content-panel">
                        
                        <div id="hero-display-container">
                            <img id="hero-image-display" src="" alt="Hero Class Image">
                            
                            <div id="slot-helmet" class="equipment-slot-floating" onclick="handleSlotClick('helmet')"></div>
                            <div id="slot-weapon" class="equipment-slot-floating" onclick="handleSlotClick('weapon')"></div>
                            <div id="slot-gloves" class="equipment-slot-floating" onclick="handleSlotClick('gloves')"></div>
                            <div id="slot-boots" class="equipment-slot-floating" onclick="handleSlotClick('boots')"></div>
                            
                            <div id="slot-armor" class="equipment-slot-floating" onclick="handleSlotClick('armor')"></div>
                            <div id="slot-accessory" class="equipment-slot-floating" onclick="handleSlotClick('accessory')"></div>
                            <div id="slot-ring" class="equipment-slot-floating" onclick="handleSlotClick('ring')"></div>
                            <div id="slot-amulet" class="equipment-slot-floating" onclick="handleSlotClick('amulet')"></div>
                        </div>

                        <div class="content-panel" style="flex: 1;">
                            <h3>Estat√≠sticas Totais</h3>
                            <div id="hero-stats-equipment">
                                <p>‚ù§Ô∏è HP M√°ximo: <span id="eq-max-hp">0</span> (Base: <span id="eq-base-hp">0</span> + B√¥nus: <span id="eq-bonus-hp">0</span>)</p>
                                <p>‚öîÔ∏è ATK Total: <span id="eq-total-atk">0</span> (Base: <span id="eq-base-atk">0</span> + B√¥nus: <span id="eq-bonus-atk">0</span>)</p>
                                <p>‚ö° Energia M√°xima: <span id="eq-max-energy">0</span> (Base: <span id="eq-base-energy">0</span> + B√¥nus: <span id="eq-bonus-energy">0</span>)</p>
                                <hr>
                                <p style="font-style: italic;">Clique em um slot ou item no Invent√°rio para inspecionar/desequipar.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="inventory-panel" style="display: none;">
                    <div class="content-panel">
                        <h2>üéí Invent√°rio</h2>
                        <p>Seus itens e recursos. Clique em um item para inspecionar e equipar/usar.</p>
                        
                        <div id="inventory-list" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; margin-top: 15px;">
                            </div>
                    </div>
                    
                    <div id="item-details-panel" class="content-panel" style="margin-top: 20px; display: none;">
                        <h4>Detalhes do Item: <span id="detail-item-name"></span></h4>
                        <p>Tipo: <span id="detail-item-type"></span> | Raridade: <span id="detail-item-rarity"></span></p>
                        <p>Descri√ß√£o: <span id="detail-item-desc"></span></p>
                        <p id="detail-item-stats"></p>
                        
                        <button id="detail-action-button" onclick="handleItemAction()" style="padding: 10px 20px; margin-top: 10px; background-color: var(--color-evolve); color: white; border: none; border-radius: 5px;">
                            Equipar/Desequipar
                        </button>
                    </div>
                </div>


                <div id="status-panel" style="display: none;">
                    <div class="content-panel"><h2>üë§ Status do Her√≥i</h2><p>Estat√≠sticas detalhadas. (Em breve!)</p></div>
                </div>
                <div id="expedition-panel" style="display: none;">
                    <div class="content-panel"><h2>üß≠ Expedi√ß√£o</h2><p>Miss√µes de longa dura√ß√£o.</p></div>
                </div>

            </div>
        </div>

    </div>

    <script>
        // ====================================================================
        // I. VARI√ÅVEIS E DOM
        // ====================================================================

        // Vari√°veis do Jogo
        let heroName = "Novo Her√≥i";
        let powerLevel = 1;
        let gold = 0;
        let currentExp = 0;
        let expToNextLevel = 50; 
        let energy = 0; 
        let soul = 0;
        let energyPerClick = 1; 
        let heroImage = ""; // Vari√°vel para armazenar o caminho da imagem do her√≥i
        
        // Vari√°veis de UPGRADE (Bases que s√£o melhoradas por upgrades)
        let heroBaseATK = 1;
        let heroBaseHP = 10;
        let atkUpgradeCost = 50;
        let hpUpgradeCost = 50;

        // Vari√°veis de Combate
        let isFighting = false;
        let heroCurrentHP = 10;
        let heroMaxHP = 10; 
        let currentMonster = null; 
        
        // Vari√°vel da Classe
        let selectedClass = null; 
        let nextItemId = 1000; // ID para novos itens gerados

        // Estrutura de Equipamento (EXPANDIDA)
        const EQUIPMENT_SLOTS = {
            weapon: { name: "Arma", type: "weapon", currentItem: null },
            armor: { name: "Peitoral", type: "armor", currentItem: null },
            helmet: { name: "Capacete", type: "helmet", currentItem: null },
            gloves: { name: "Luvas", type: "gloves", currentItem: null },
            boots: { name: "Botas", type: "boots", currentItem: null },
            amulet: { name: "Amuleto", type: "amulet", currentItem: null },
            ring: { name: "Anel", type: "ring", currentItem: null },
            accessory: { name: "Acess√≥rio", type: "accessory", currentItem: null }
        };
        
        // Estrutura do Invent√°rio (Inicia Vazio para o Novo Jogo)
        let inventory = [];

        // Vari√°veis de √Åudio
        let currentVolume = 1.0; // 0.0 a 1.0
        let hasInteracted = false; // Para controlar o bloqueio de autoplay

        // Estrutura de Classes do Personagem (ATUALIZADA com novos itens e caminho da imagem)
        const CLASSES = {
            warrior: {
                name: "Guerreiro",
                description: "Especialista em combate corpo-a-corpo, focado em vida e dano balanceado.",
                initialHP: 15,
                initialATK: 2,
                initialEnergy: 50,
                imagePath: "assets/warrior_display.png", // Imagem de display (sem fundo)
                startingItems: [
                    { id: 1, name: "Espada Curta", type: "weapon", atk: 2, rarity: "Comum", description: "Uma l√¢mina b√°sica de treinamento." },
                    { id: 2, name: "Armadura de Couro", type: "armor", hpBonus: 10, rarity: "Comum", description: "Prote√ß√£o leve e confi√°vel." },
                    { id: 9, name: "Capacete Leve", type: "helmet", hpBonus: 5, rarity: "Comum", description: "Protege a cabe√ßa contra golpes fracos." },
                    { id: 10, name: "Luvas Simples", type: "gloves", atk: 1, rarity: "Comum", description: "Melhora a pegada." },
                    { id: 11, name: "Botas de Viagem", type: "boots", hpBonus: 3, rarity: "Comum", description: "Ideal para longas caminhadas." }
                ]
            },
            mage: {
                name: "Mago",
                description: "Fr√°gil, mas com alto potencial de dano m√°gico e grande reserva de energia.",
                initialHP: 8,
                initialATK: 1, 
                initialEnergy: 150,
                imagePath: "assets/mage_display.png", // Imagem de display (sem fundo)
                startingItems: [
                    { id: 3, name: "Cajado de Madeira", type: "weapon", atk: 1, energyBonus: 50, rarity: "Comum", description: "Um cajado simples para canalizar magia." },
                    { id: 4, name: "Manto de Pano", type: "armor", hpBonus: 5, rarity: "Comum", description: "Roupas leves que n√£o atrapalham o movimento." },
                    { id: 12, name: "Capuz de Mago", type: "helmet", energyBonus: 10, rarity: "Comum", description: "Concentra o pensamento." },
                    { id: 13, name: "Luvas de Seda", type: "gloves", energyBonus: 5, rarity: "Comum", description: "Mant√©m as m√£os aquecidas para conjura√ß√£o." },
                    { id: 14, name: "Sand√°lias", type: "boots", hpBonus: 1, rarity: "Comum", description: "Leves e silenciosas." }
                ]
            },
            archer: {
                name: "Arqueiro",
                description: "R√°pido e preciso, com bom equil√≠brio entre ataque e defesa.",
                initialHP: 10,
                initialATK: 1,
                initialEnergy: 75,
                imagePath: "assets/archer_display.png", // Imagem de display (sem fundo)
                startingItems: [
                    { id: 5, name: "Arco Curto", type: "weapon", atk: 3, rarity: "Comum", description: "Um arco simples para ca√ßa." },
                    { id: 6, name: "Malha Leve", type: "armor", hpBonus: 8, rarity: "Comum", description: "Oferece defesa sem restringir a agilidade." },
                    { id: 15, name: "Bandana", type: "helmet", atk: 1, rarity: "Comum", description: "Melhora o foco." },
                    { id: 16, name: "Bra√ßadeiras", type: "gloves", atk: 2, rarity: "Comum", description: "Protege o pulso do atrito da corda." },
                    { id: 17, name: "Botas de Couro Macio", type: "boots", hpBonus: 5, rarity: "Comum", description: "Permite movimentos furtivos." }
                ]
            },
            fighter: {
                name: "Lutador",
                description: "Focado em defesa e recupera√ß√£o, o lutador √© dif√≠cil de derrubar.",
                initialHP: 20,
                initialATK: 1,
                initialEnergy: 75,
                imagePath: "assets/fighter_display.png", // Imagem de display (sem fundo)
                startingItems: [
                    { id: 7, name: "Luvas de Couro", type: "weapon", atk: 1, rarity: "Comum", description: "Aumenta o dano dos seus punhos." },
                    { id: 8, name: "Cota de Malha", type: "armor", hpBonus: 15, rarity: "Comum", description: "Armadura pesada para maior resist√™ncia." },
                    { id: 18, name: "Elmo de Ferro", type: "helmet", hpBonus: 10, rarity: "Comum", description: "Prote√ß√£o robusta." },
                    { id: 19, name: "Ataduras", type: "gloves", hpBonus: 2, rarity: "Comum", description: "Protege as m√£os durante a luta." },
                    { id: 20, name: "Grevas de Ferro", type: "boots", hpBonus: 7, rarity: "Comum", description: "Protege as pernas." }
                ]
            }
        };


        // Vari√°veis de Miss√£o (para Cooldown)
        let missionCooldowns = { provisions: 0, workGold: 0 };
        const DAILY_COOLDOWN_MS = 24 * 60 * 60 * 1000;
        let dailyMissionStatus = {
            scouting: { completedAt: 0 },
            drills: { completedAt: 0 }
        };

        let uniqueMissionStatus = {
            firstQuest: { completed: false },
            tutorialComplete: { completed: false }
        };

        // Objeto central para a sele√ß√£o de monstros por N√≠vel
        const MONSTERS_BY_LEVEL = {
            1: [
                { name: "Slime Iniciante", baseHP: 20, atk: 2, expReward: 30, goldReward: 5, energyCost: 5 },
                { name: "Mosquito Mutante", baseHP: 15, atk: 3, expReward: 35, goldReward: 6, energyCost: 5 }
            ],
            2: [
                { name: "Lobo Faminto", baseHP: 45, atk: 8, expReward: 70, goldReward: 15, energyCost: 7 },
                { name: "Cogumelo Venenoso", baseHP: 60, atk: 5, expReward: 65, goldReward: 12, energyCost: 7 }
            ],
            3: [
                { name: "Bandido de Estrada", baseHP: 80, atk: 12, expReward: 120, goldReward: 25, energyCost: 10 },
                { name: "Golem de Pedra Pequeno", baseHP: 150, atk: 5, expReward: 110, goldReward: 20, energyCost: 10 }
            ]
        };


        // Refer√™ncias do DOM
        const startMenu = document.getElementById('start-menu');
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('main-content');
        
        // Display de Recursos e N√≠vel
        const powerLevelDisplay = document.getElementById('power-level-display');
        const energyCount = document.getElementById('energy-count');
        const goldCount = document.getElementById('gold-count');
        const soulCount = document.getElementById('soul-count');
        const expCount = document.getElementById('exp-count');
        const expRequired = document.getElementById('exp-required');
        const levelUpButton = document.getElementById('level-up-button');
        
        // Refer√™ncias de NOME e T√çTULO
        const heroNameInput = document.getElementById('hero-name-input');
        const heroNameDisplay = document.getElementById('hero-name');
        const headerTitle = document.querySelector('#header h2');
        
        // Refer√™ncias do Painel de Cria√ß√£o
        const characterCreationPanel = document.getElementById('character-creation-panel');
        const classContainer = document.getElementById('class-selection-container');
        const classDetailsPanel = document.getElementById('class-details');
        const confirmCreationButton = document.getElementById('confirm-creation-button');
        const classInitialEquipmentDisplay = document.getElementById('class-initial-equipment');


        // Refer√™ncias do Painel de Upgrades
        const upgradeAtkDisplay = document.getElementById('upgrade-atk-display');
        const atkCostDisplay = document.getElementById('atk-cost');
        const upgradeHpDisplay = document.getElementById('upgrade-hp-display');
        const hpCostDisplay = document.getElementById('hp-cost');
        const buyAtkUpgradeButton = document.getElementById('buy-atk-upgrade');
        const buyHpUpgradeButton = document.getElementById('buy-hp-upgrade');
        
        // Refer√™ncias do Painel Aventura
        const combatLog = document.getElementById('combat-log');
        const startBattleButton = document.getElementById('start-battle-button');
        const heroCurrentHPDisplay = document.getElementById('hero-current-hp');
        const heroMaxHPDisplay = document.getElementById('hero-max-hp');
        const heroTotalATKDisplay = document.getElementById('hero-total-atk');
        const heroLevelMultiplierDisplay = document.getElementById('hero-level-multiplier');
        const monsterHPDisplay = document.getElementById('monster-hp-display');
        const monsterATKDisplay = document.getElementById('monster-atk-display');

        // Refer√™ncias de √Åudio
        const gameThemeMusic = document.getElementById('game-theme-music');
        const audioControlButton = document.getElementById('audio-control-button');
        const volumeSliderStart = document.getElementById('volume-slider-start');
        const volumeLabelStart = document.getElementById('volume-label-start');
        const volumeSliderGame = document.getElementById('volume-slider-game');
        const volumeLabelGame = document.getElementById('volume-label-game');
        
        // Refer√™ncias do Painel de Equipamento/Invent√°rio
        const heroImageDisplay = document.getElementById('hero-image-display');
        const inventoryPanel = document.getElementById('inventory-list');
        let inspectedItem = null; // Item atualmente em inspe√ß√£o


        // ====================================================================
        // II. FUN√á√ïES DE DISPLAY E NAVEGA√á√ÉO
        // ====================================================================

        // Atualiza a exibi√ß√£o na tela
        function updateDisplay() {
            // NOME
            heroNameDisplay.textContent = heroName;
            headerTitle.textContent = heroName;
            
            // Recursos
            powerLevelDisplay.textContent = powerLevel;
            document.getElementById('power-level').textContent = powerLevel; 
            energyCount.textContent = energy;
            goldCount.textContent = gold;
            soulCount.textContent = soul;
            expCount.textContent = currentExp;
            expRequired.textContent = expToNextLevel;

            // Level Up
            if (currentExp >= expToNextLevel) {
                levelUpButton.disabled = false;
                levelUpButton.textContent = 'SUBIR DE N√çVEL';
            } else {
                levelUpButton.disabled = true;
                levelUpButton.textContent = `SUBIR DE N√çVEL (Falta: ${expToNextLevel - currentExp} EXP)`;
            }

            // Upgrades
            upgradeAtkDisplay.textContent = heroBaseATK;
            atkCostDisplay.textContent = atkUpgradeCost;
            upgradeHpDisplay.textContent = heroBaseHP;
            hpCostDisplay.textContent = hpUpgradeCost;

            buyAtkUpgradeButton.disabled = gold < atkUpgradeCost;
            buyHpUpgradeButton.disabled = gold < hpUpgradeCost;

            // Miss√µes
            updateMissionButtons();

            // === ATUALIZA√á√ÉO PARA COMBATE (CHAMA updateEquipmentStats) ===
            updateEquipmentStats(); // <-- Garante que o HP/ATK total reflita o equipamento
            
            // Define a imagem do her√≥i no painel de equipamento
            heroImageDisplay.src = heroImage; 

            // === ATUALIZA√á√ÉO DO PAINEL AVENTURA ===
            updateAdventurePanel();
            
            // === ATUALIZA√á√ÉO DO VOLUME E MUTE ===
            const volValue = Math.round(currentVolume * 100);
            if (volumeSliderStart) {
                volumeSliderStart.value = volValue;
                volumeLabelStart.textContent = volValue;
            }
            if (volumeSliderGame) {
                volumeSliderGame.value = volValue;
                volumeLabelGame.textContent = volValue;
            }
            
            audioControlButton.textContent = gameThemeMusic.muted ? 'üîá Unmute' : 'üîä Mute';
        }

        // Atualiza o estado dos bot√µes de Miss√µes Di√°rias e √önicas
        function updateMissionButtons() {
            const now = Date.now();
            
            // Miss√µes Di√°rias
            for (const key in dailyMissionStatus) {
                const btn = document.getElementById(`daily-${key}`);
                const status = dailyMissionStatus[key];
                
                if (!btn) continue;

                if (now < status.completedAt + DAILY_COOLDOWN_MS) {
                    const remainingTimeMs = status.completedAt + DAILY_COOLDOWN_MS - now;
                    const remainingHours = Math.ceil(remainingTimeMs / 3600000); 
                    btn.disabled = true;
                    btn.textContent = `Em Cooldown (${remainingHours}h restantes)`;
                } else {
                    btn.disabled = false;
                    btn.textContent = key === 'scouting' 
                        ? 'Fazer Patrulha (Recompensa: 100 EXP | 50 üí∞)' 
                        : 'Exerc√≠cios de Treinamento (Recompensa: 200 EXP | +2 ATK B√¥nus!)';
                }
            }

            // Miss√µes √önicas
            for (const key in uniqueMissionStatus) {
                const btn = document.getElementById(`unique-${key}`);
                const status = uniqueMissionStatus[key];
                
                if (!btn) continue;

                if (status.completed) {
                    btn.style.display = 'none'; 
                } else {
                    btn.style.display = 'inline-block';
                }
            }
        }

        // Fun√ß√£o para atualizar os displays espec√≠ficos do Painel Aventura
        function updateAdventurePanel() {
            // Se n√£o houver monstro selecionado, tenta selecionar um novo (se n√£o estiver lutando)
            if (!currentMonster && !isFighting) {
                selectMonsterByLevel();
            }

            if (!currentMonster) {
                // Estado de "Regi√£o Segura"
                document.getElementById('monster-name').textContent = "Regi√£o Segura";
                document.getElementById('monster-hp-display').textContent = "0";
                document.getElementById('monster-atk-display').textContent = "0";
                document.getElementById('monster-reward-exp').textContent = "0";
                document.getElementById('monster-reward-gold').textContent = "0";
                startBattleButton.textContent = "Nenhum Monstro Aqui";
                startBattleButton.disabled = true;
                return;
            }
            
            // Atualiza informa√ß√µes do monstro
            document.getElementById('monster-name').textContent = currentMonster.name;
            document.getElementById('monster-hp-display').textContent = currentMonster.currentHP;
            document.getElementById('monster-atk-display').textContent = currentMonster.atk;
            document.getElementById('monster-reward-exp').textContent = currentMonster.expReward;
            document.getElementById('monster-reward-gold').textContent = currentMonster.goldReward;
            startBattleButton.textContent = `Iniciar Batalha! (Custo: ${currentMonster.energyCost} ‚ö°)`;

            // Garante que o bot√£o de batalha esteja no estado correto
            startBattleButton.disabled = energy < currentMonster.energyCost || isFighting;
        }

        // Exibe o painel de Cria√ß√£o de Personagem
        function showCharacterCreation() {
            // *** A√á√ÉO DE CORRE√á√ÉO (√Åudio) ***
            hasInteracted = true; 
            checkAndPlayMusic();
            
            // Esconde o menu inicial
            startMenu.style.display = 'none'; 
            // Esconde a sidebar e o conte√∫do principal do jogo
            sidebar.style.display = 'none';
            mainContent.style.display = 'none';
            
            // Reseta a vari√°vel de classe para for√ßar a sele√ß√£o
            selectedClass = null;

            // Exibe APENAS a tela de cria√ß√£o
            characterCreationPanel.style.display = 'flex'; 
            generateClassButtons();
        }
        
        // Gera os bot√µes de sele√ß√£o de classe no painel
        function generateClassButtons() {
            classContainer.innerHTML = ''; 
            
            for (const key in CLASSES) {
                const cls = CLASSES[key];
                const button = document.createElement('button');
                button.textContent = cls.name;
                button.setAttribute('data-class-key', key);
                button.onclick = () => selectClass(key);
                
                // Adiciona a imagem
                if (cls.imagePath) {
                    const img = document.createElement('img');
                    img.src = cls.imagePath;
                    img.alt = cls.name;
                    button.prepend(img);
                }

                classContainer.appendChild(button);
            }
        }
        
        // Seleciona uma classe e atualiza os detalhes
        function selectClass(key) {
            selectedClass = key;
            const cls = CLASSES[key];
            
            // Atualiza o painel de detalhes
            document.getElementById('selected-class-name').textContent = cls.name;
            document.getElementById('class-base-hp').textContent = cls.initialHP;
            document.getElementById('class-base-atk').textContent = cls.initialATK;
            document.getElementById('class-initial-energy').textContent = cls.initialEnergy;
            classDetailsPanel.querySelector('p:last-of-type').textContent = `"${cls.description}"`; 
            
            // NOVO: Exibe o equipamento inicial
            const startingItemsNames = cls.startingItems.map(item => item.name).join(', ');
            classInitialEquipmentDisplay.textContent = startingItemsNames || "Nenhum";
            
            classDetailsPanel.style.display = 'block';
            
            confirmCreationButton.disabled = false;
            
            // Atualiza o estilo dos bot√µes para indicar a sele√ß√£o
            document.querySelectorAll('#class-selection-container button').forEach(btn => {
                btn.style.borderColor = btn.getAttribute('data-class-key') === key ? 'var(--color-accent)' : 'var(--color-primary)';
                btn.style.backgroundColor = btn.getAttribute('data-class-key') === key ? '#4f3655' : 'var(--color-secondary)';
            });
        }
        
        // Finaliza a cria√ß√£o e inicia o jogo com a classe escolhida (ATUALIZADA)
        function finalizeCreation() {
            if (!selectedClass) {
                alert("Por favor, selecione uma classe antes de come√ßar!");
                return;
            }
            
            const cls = CLASSES[selectedClass];
            
            // 1. Aplica atributos base da classe
            heroBaseHP = cls.initialHP;
            heroBaseATK = cls.initialATK;
            heroCurrentHP = cls.initialHP;
            heroMaxHP = cls.initialHP;
            energy = cls.initialEnergy;
            heroImage = cls.imagePath; // SALVA O CAMINHO DA IMAGEM
            
            // Reseta EXP, Ouro e N√≠vel para 1 (novo jogo)
            powerLevel = 1;
            currentExp = 0;
            expToNextLevel = 50;
            gold = 0;
            inventory = []; // Zera o invent√°rio
            
            // Zera slots de equipamento
            for (const slotKey in EQUIPMENT_SLOTS) {
                EQUIPMENT_SLOTS[slotKey].currentItem = null;
            }
            
            // 2. Define o nome do her√≥i
            const chosenName = heroNameInput.value.trim();
            if (chosenName) {
                heroName = chosenName;
            } else {
                heroName = `Her√≥i ${cls.name}`; 
            }

            // 3. Adiciona e Equipa os Itens Iniciais (NOVA L√ìGICA)
            cls.startingItems.forEach((starterItem, index) => {
                // Cria uma c√≥pia do item para que IDs de itens sejam √∫nicos em saves
                const newItem = { 
                    ...starterItem, 
                    id: nextItemId++, // Usa um ID incremental √∫nico para o item
                    rarity: starterItem.rarity || "B√°sico"
                }; 
                
                inventory.push(newItem); // Adiciona ao invent√°rio
                equipItem(newItem, false); // Equipa o item (sem alerta, para n√£o floodar)
            });
            
            // 4. Inicia o jogo
            characterCreationPanel.style.display = 'none'; // Esconde a tela de cria√ß√£o
            startGame(); // CHAMA A FUN√á√ÉO PARA INICIAR O JOGO
            saveGame(); // Salva o novo jogo
        }
        
        // Inicia o jogo ap√≥s cria√ß√£o ou carregamento
        function startGame() {
            sidebar.style.display = 'block';
            mainContent.style.display = 'block'; // Exibe o conte√∫do principal
            showPanel('training-panel'); 
            
            updateDisplay();
        }

        // Alterna entre os pain√©is de conte√∫do (ATUALIZADO)
        function showPanel(panelId) {
            const panels = document.querySelectorAll('#content-area > div');
            panels.forEach(panel => panel.style.display = 'none');
            document.getElementById(panelId).style.display = 'block';

            const sidebarButtons = document.querySelectorAll('.sidebar-menu button');
            sidebarButtons.forEach(btn => btn.classList.remove('active'));
            document.getElementById('btn-' + panelId.split('-')[0]).classList.add('active');
            
            // L√ìGICA DE RENDERIZA√á√ÉO DE EQUIPAMENTO/INVENT√ÅRIO
            if (panelId === 'equipment-panel') {
                renderEquipment();
            } else if (panelId === 'inventory-panel') {
                renderInventory();
            }
            
            // Seleciona um novo monstro ao entrar no Painel Aventura
            if (panelId === 'adventure-panel' && !isFighting) {
                selectMonsterByLevel();
            }

            updateDisplay();
        }

        // ====================================================================
        // III. FUN√á√ïES DE √ÅUDIO
        // ====================================================================

        // Tenta tocar o √°udio apenas se o usu√°rio interagiu. (CORRIGIDO)
        function checkAndPlayMusic() {
            if (hasInteracted) {
                // Se a m√∫sica estiver em pausa e n√£o estiver mutada
                if (gameThemeMusic.paused && !gameThemeMusic.muted) {
                    gameThemeMusic.play().then(() => {
                        console.log("M√∫sica iniciada com sucesso ap√≥s intera√ß√£o.");
                    }).catch(e => {
                        console.error("Falha ao tocar ap√≥s intera√ß√£o:", e);
                    });
                }
            }
        }

        // Define o volume e atualiza o estado
        function setVolume(value) {
            const vol = value / 100;
            currentVolume = vol;
            gameThemeMusic.volume = vol;
            
            // Se o volume for zero, mute o √°udio
            if (vol === 0) {
                gameThemeMusic.muted = true;
            } else if (gameThemeMusic.muted && vol > 0) {
                // Se estava mutado (pelo bot√£o) e aumentou o volume, desmute
                gameThemeMusic.muted = false;
                
                // Se aumentou o volume, tenta tocar
                hasInteracted = true;
                checkAndPlayMusic();
            }
            
            // Salva o volume e o estado do mute
            localStorage.setItem('gameVolume', vol); 
            localStorage.setItem('isMuted', gameThemeMusic.muted); 
            
            updateDisplay();
        }

        // Alterna entre Mute e Unmute
        function toggleMute() {
            // Se o volume estiver em 0, n√£o faz sentido desmutar
            if (currentVolume === 0 && gameThemeMusic.muted) {
                 alert("Volume est√° em 0. Por favor, aumente o volume para ouvir.");
                 return;
            }

            gameThemeMusic.muted = !gameThemeMusic.muted;
            
            // Se tentar desmutar e a m√∫sica n√£o estiver tocando, tenta dar play
            if (!gameThemeMusic.muted && gameThemeMusic.paused) {
                 hasInteracted = true; // Garante que a intera√ß√£o est√° registrada
                 checkAndPlayMusic();
            }
            
            localStorage.setItem('isMuted', gameThemeMusic.muted); 
            updateDisplay();
        }
        
        // ====================================================================
        // IV. FUN√á√ïES DE SALVAR/CARREGAR (localStorage)
        // ====================================================================

        // Salva o Estado do Jogo no Navegador (ATUALIZADO)
        function saveGame() {
            const gameData = {
                heroName: heroName, 
                selectedClass: selectedClass, 
                heroImage: heroImage, // SALVA A IMAGEM DO HER√ìI
                level: powerLevel,
                exp: currentExp,
                expRequired: expToNextLevel,
                energy: energy,
                gold: gold,
                soul: soul,
                energyPerClick: energyPerClick, 
                heroHP: heroBaseHP,
                heroATK: heroBaseATK,
                atkCost: atkUpgradeCost,
                hpCost: hpUpgradeCost,
                missionCooldowns: missionCooldowns,
                dailyStatus: dailyMissionStatus, 
                uniqueStatus: uniqueMissionStatus,
                heroCurrentHP: heroCurrentHP,
                
                // NOVO: Itens e Equipamento
                inventory: inventory,
                // Salva apenas as informa√ß√µes necess√°rias para recriar a liga√ß√£o
                equipment: JSON.parse(JSON.stringify(EQUIPMENT_SLOTS, (key, value) => {
                    if (key === 'currentItem' && value) {
                        return { id: value.id }; // Salva apenas o ID do item equipado
                    }
                    return value;
                })),
                nextItemId: nextItemId, 
                
                // Salva o estado do √°udio
                isMuted: gameThemeMusic.muted,
                gameVolume: currentVolume
            };
            localStorage.setItem('blazeAndSteelSave', JSON.stringify(gameData));
        }

        // Carrega o Estado do Jogo Salvo (ATUALIZADO)
        function loadGame(isFromButton = false) {
            const savedData = localStorage.getItem('blazeAndSteelSave');

            // 1. Carrega o estado do volume primeiro (independentemente de haver jogo salvo)
            const savedVolume = localStorage.getItem('gameVolume');
            if (savedVolume !== null) {
                currentVolume = parseFloat(savedVolume);
            } else {
                currentVolume = 1.0; // Padr√£o
            }
            gameThemeMusic.volume = currentVolume;
            
            // Carrega o estado de mute (tamb√©m separado)
            const isMuted = localStorage.getItem('isMuted') === 'true';
            gameThemeMusic.muted = isMuted;

            // *** A√á√ÉO DE CORRE√á√ÉO (Se o bot√£o 'Carregar Jogo' foi clicado) ***
            if (isFromButton) {
                hasInteracted = true;
                checkAndPlayMusic();
            }

            if (savedData) {
                const gameData = JSON.parse(savedData); 

                // Carrega Nome, Classe e Imagem
                heroName = gameData.heroName || "Her√≥i";
                selectedClass = gameData.selectedClass || null; 
                heroImage = gameData.heroImage || ""; // CARREGA A IMAGEM DO HER√ìI

                // Carrega Vari√°veis Principais
                powerLevel = gameData.level || 1;
                currentExp = gameData.exp || 0;
                expToNextLevel = gameData.expRequired || 50;
                energy = gameData.energy || 0;
                gold = gameData.gold || 0;
                soul = gameData.soul || 0;
                
                // Carrega Upgrades
                energyPerClick = gameData.energyPerClick || 1;
                heroBaseHP = gameData.heroHP || 10;
                heroBaseATK = gameData.heroATK || 1;
                atkUpgradeCost = gameData.atkCost || 50;
                hpUpgradeCost = gameData.hpCost || 50;

                // Carrega Status de Combate
                heroCurrentHP = gameData.heroCurrentHP || heroBaseHP;
                
                // Carrega Status de Miss√µes
                dailyMissionStatus = gameData.dailyStatus || dailyMissionStatus;
                uniqueMissionStatus = gameData.uniqueStatus || uniqueMissionStatus;

                // Carrega Cooldowns
                missionCooldowns = gameData.missionCooldowns || { provisions: 0, workGold: 0 };
                
                // NOVO: Carrega Itens e Equipamento
                inventory = gameData.inventory || [];
                nextItemId = gameData.nextItemId || 1000;
                
                if (gameData.equipment) {
                    for (const slotKey in gameData.equipment) {
                        if (EQUIPMENT_SLOTS[slotKey]) {
                            // Se o item foi carregado, verifica se h√° ID (o item completo n√£o √© salvo, apenas o ID)
                            const equippedItemId = gameData.equipment[slotKey].currentItem ? gameData.equipment[slotKey].currentItem.id : null;
                            if (equippedItemId) {
                                // Encontra a refer√™ncia do item COMPLETO no invent√°rio
                                const itemReference = inventory.find(item => item.id === equippedItemId);
                                EQUIPMENT_SLOTS[slotKey].currentItem = itemReference || null;
                            } else {
                                EQUIPMENT_SLOTS[slotKey].currentItem = null;
                            }
                        }
                    }
                }
                
                // Carrega Estado do √Åudio
                gameThemeMusic.muted = gameData.isMuted === true; 
                currentVolume = gameData.gameVolume !== undefined ? gameData.gameVolume : 1.0;
                gameThemeMusic.volume = currentVolume;


                updateDisplay();
                startGame(); 
                alert('Jogo Carregado com Sucesso!');
                
            } else if (isFromButton) {
                // Se tentou carregar do bot√£o mas n√£o tinha save
                alert('Nenhum jogo salvo encontrado. Comece um Novo Jogo!');
                startMenu.style.display = 'flex';
                sidebar.style.display = 'none';
                mainContent.style.display = 'none';
                updateDisplay();
            } else {
                 // Inicializa√ß√£o Padr√£o (carrega √°udio e exibe o menu)
                startMenu.style.display = 'flex';
                sidebar.style.display = 'none';
                mainContent.style.display = 'none';
                updateDisplay();
            }
        }

        // ====================================================================
        // V. FUN√á√ïES DE PROGRESS√ÉO E MISS√ïES
        // ====================================================================
        
        // 1. Level Up
        function levelUp() {
            let levelGained = 0;
            while (currentExp >= expToNextLevel) { 
                currentExp -= expToNextLevel;
                powerLevel++;
                expToNextLevel = Math.round(expToNextLevel * 1.5); 
                levelGained++;
            }
            
            if (levelGained > 0) {
                alert(`Parab√©ns! Voc√™ alcan√ßou o N√≠vel ${powerLevel}!`);
                // Garante que HP atual seja o m√°ximo depois de subir de n√≠vel
                heroCurrentHP = heroMaxHP; 
            }
            updateDisplay();
            saveGame(); // Salva ap√≥s Level Up
        }
        
        // 2. Compra de Upgrades (ATK/HP)
        function buyUpgrade(type) {
            if (type === 'atk' && gold >= atkUpgradeCost) {
                gold -= atkUpgradeCost;
                heroBaseATK += 1;
                atkUpgradeCost = Math.round(atkUpgradeCost * 1.5); 
                alert(`‚öîÔ∏è Ataque Base (Upgrade) aumentado para ${heroBaseATK}!`);
            
            } else if (type === 'hp' && gold >= hpUpgradeCost) {
                gold -= hpUpgradeCost;
                heroBaseHP += 10;
                hpUpgradeCost = Math.round(hpUpgradeCost * 1.5); 
                alert(`‚ù§Ô∏è HP Base (Upgrade) aumentado para ${heroBaseHP}!`);
            
            } else {
                alert("Voc√™ n√£o tem Ouro suficiente para este upgrade!");
                return;
            }

            updateDisplay();
            saveGame();
        }

        // 3. In√≠cio de Miss√µes Recorrentes (Cooldowns de Tempo)
        function startMission(missionType, initialDuration = 0) {
            if (missionCooldowns[missionType] > 0 && initialDuration === 0) {
                alert(`Espere! A miss√£o ainda est√° em cooldown.`);
                return;
            }

            let duration = initialDuration > 0 ? initialDuration : 0; 
            let rewards = {};
            let button = null;
            let buttonText = '';

            if (missionType === 'provisions') {
                duration = 30; 
                rewards = { energy: 50 };
                button = document.getElementById('provisions-button');
                buttonText = `Coletar Provis√µes (30s | Ganho: 50 ‚ö°)`;
            } else if (missionType === 'workGold') {
                duration = 60; 
                rewards = { gold: 20 };
                button = document.getElementById('work-gold-button');
                buttonText = `Trabalhar por Ouro (60s | Ganho: 20 üí∞)`;
            }

            missionCooldowns[missionType] = duration;
            button.disabled = true;

            const interval = setInterval(() => {
                missionCooldowns[missionType]--;
                button.textContent = `Em Progresso... (${missionCooldowns[missionType]}s restantes)`;

                if (missionCooldowns[missionType] <= 0) {
                    clearInterval(interval);
                    
                    // Ajuste a recompensa da energia para considerar o b√¥nus de energia do equipamento
                    const totalEnergyReward = rewards.energy ? (rewards.energy * energyPerClick) : 0;
                    if (totalEnergyReward > 0) energy += totalEnergyReward;
                    if (rewards.gold) gold += rewards.gold;

                    button.textContent = `Miss√£o Completa!`;
                    
                    setTimeout(() => {
                        button.textContent = buttonText;
                        button.disabled = false;
                    }, 5000);

                    updateDisplay();
                    saveGame();
                }
            }, 1000);
            updateDisplay();
        }

        // 4. Treinamento para EXP e Chance de B√¥nus de Status
        function trainForStats(type) {
            const costEnergy = 25;
            const expGain = 10;

            if (energy >= costEnergy) {
                energy -= costEnergy;
                currentExp += expGain;
                
                let message = `Voc√™ treinou. Ganhou ${expGain} EXP.`;

                if (Math.random() < 0.15) { 
                    if (type === 'attack') {
                        heroBaseATK += 1;
                        message += " E descobriu um novo golpe (+1 ATK B√¥nus Base)!";
                    } else if (type === 'defense') {
                        heroBaseHP += 5;
                        heroCurrentHP += 5; // Aumenta o HP atual tamb√©m
                        message += " E fortificou sua armadura (+5 HP B√¥nus Base)!";
                    }
                }
                
                alert(message);
                
                updateDisplay();
                levelUp(); 
            } else {
                alert("Energia insuficiente. Complete miss√µes para obter mais ‚ö°.");
            }
        }

        // 5. In√≠cio de Miss√µes Di√°rias (24h de Cooldown)
        function startDailyMission(key) {
            const status = dailyMissionStatus[key];
            const now = Date.now();

            if (now < status.completedAt + DAILY_COOLDOWN_MS) {
                alert("Essa miss√£o s√≥ pode ser feita uma vez por dia!");
                return;
            }

            status.completedAt = now; 
            let message = "Miss√£o Di√°ria completa!";

            if (key === 'scouting') {
                currentExp += 100;
                gold += 50;
                message += " Recompensa: 100 EXP e 50 üí∞!";
            } else if (key === 'drills') {
                currentExp += 200;
                heroBaseATK += 2;
                message += " Recompensa: 200 EXP e +2 ATK base!";
            }

            alert(message);
            updateDisplay();
            levelUp();
            saveGame(); 
        }

        // 6. In√≠cio de Miss√µes √önicas (Desaparecem ap√≥s concluir)
        function startUniqueMission(key) {
            const status = uniqueMissionStatus[key];

            if (status.completed) {
                return; 
            }

            status.completed = true; 
            let message = "Miss√£o √önica conclu√≠da!";

            if (key === 'firstQuest') {
                currentExp += 500;
                heroBaseHP += 10;
                heroCurrentHP += 10; // Aumenta o HP atual tamb√©m
                message += " Recompensa: 500 EXP e +10 HP base!";
            } else if (key === 'tutorialComplete') {
                gold += 100;
                energy += 100;
                message += " Recompensa: 100 üí∞ e 100 ‚ö°!";
            }

            alert(message);
            updateDisplay();
            levelUp();
            saveGame(); 
        }
        
        // ====================================================================
        // VI. FUN√á√ïES DE COMBATE E MONSTROS
        // ====================================================================

        // Fun√ß√£o para selecionar um monstro aleat√≥rio baseado no N√≠vel do Her√≥i
        function selectMonsterByLevel() {
            // Determina a regi√£o de n√≠vel do monstro com base no N√≠vel do Her√≥i
            const level = powerLevel;
            
            const availableLevels = Object.keys(MONSTERS_BY_LEVEL).map(Number).sort((a, b) => a - b);
            
            // Pega o n√≠vel mais alto dispon√≠vel para evitar erros se o her√≥i estiver muito forte
            let targetLevel = level;
            if (level > availableLevels[availableLevels.length - 1]) {
                targetLevel = availableLevels[availableLevels.length - 1];
            }
            
            // Garante que o n√≠vel de destino seja pelo menos 1
            if (targetLevel < 1) targetLevel = 1;

            const availableMonsters = MONSTERS_BY_LEVEL[targetLevel];

            if (!availableMonsters || availableMonsters.length === 0) {
                currentMonster = null;
                logToCombat("N√£o h√° monstros dispon√≠veis para lutar. Treine mais no Quartel-General!");
                updateAdventurePanel();
                return null;
            }
            
            const randomIndex = Math.floor(Math.random() * availableMonsters.length);
            const selectedMonster = availableMonsters[randomIndex];
            
            currentMonster = {
                ...selectedMonster,
                currentHP: selectedMonster.baseHP,
                level: targetLevel 
            };
            
            // Alerta o jogador sobre a √°rea de combate
            logToCombat(`<p style="color: var(--color-accent);">Voc√™ entrou na regi√£o de N√≠vel ${targetLevel}. Encontrado: ${currentMonster.name}.</p>`);

            updateAdventurePanel();
            
            return currentMonster;
        }

        // L√≥gica de Combate
        function startBattle() {
            if (!currentMonster) {
                logToCombat("N√£o h√° monstro para lutar. Tente mudar de painel e voltar!");
                return;
            }
            
            const energyCost = currentMonster.energyCost;

            if (isFighting) {
                alert("A batalha j√° est√° em andamento!");
                return;
            }
            
            if (energy < energyCost) {
                alert(`Energia insuficiente! Voc√™ precisa de ${energyCost} ‚ö° para entrar em combate.`);
                return;
            }

            // 1. Inicia Batalha
            energy -= energyCost;
            isFighting = true;
            startBattleButton.textContent = 'Em Combate...';
            startBattleButton.disabled = true;

            // Restaura HP do monstro para a base a cada nova luta
            currentMonster.currentHP = currentMonster.baseHP; 

            // Recalcula ATK Total do Her√≥i (buscando o valor do display, que j√° inclui equipamento)
            let heroATK = parseInt(document.getElementById('eq-total-atk').textContent) || heroBaseATK; 


            // Limpa Log
            combatLog.innerHTML = `<p style="font-weight: bold;">[Batalha Iniciada contra ${currentMonster.name}]</p>`;
            logToCombat(`<p style="color: var(--color-energy);">Her√≥i consome ${energyCost} ‚ö° e se prepara para lutar!</p>`);
            
            // 2. Loop de Turnos (Simula√ß√£o)
            let turn = 1;
            const battleInterval = setInterval(() => {
                
                // Fim da Batalha (Verificado no in√≠cio de cada turno)
                if (currentMonster.currentHP <= 0 || heroCurrentHP <= 0) {
                    clearInterval(battleInterval);
                    endBattle(currentMonster.currentHP <= 0);
                    return;
                }

                // --- Turno do Her√≥i ---
                // O dano base √© multiplicado pelo N√≠vel (o multiplicador xN√≠vel √© o nosso 'power curve')
                // Multiplicador de N√≠vel para a Curva de Poder (multiplica o ATK Total)
                const levelMultiplier = powerLevel > 0 ? (1 + (powerLevel - 1) * 0.2) : 1; 
                const heroDamage = Math.round(heroATK * levelMultiplier);
                
                currentMonster.currentHP -= heroDamage;
                currentMonster.currentHP = Math.max(0, currentMonster.currentHP); 
                
                logToCombat(`Turno ${turn}: <span style="color: var(--color-hp);">Seu her√≥i (ATK: ${heroATK}) causa ${heroDamage} de dano!</span>`);
                
                updateDisplay();

                if (currentMonster.currentHP <= 0) return; // Monstro morreu

                // --- Turno do Monstro ---
                const monsterDamage = currentMonster.atk;
                heroCurrentHP -= monsterDamage;
                heroCurrentHP = Math.max(0, heroCurrentHP);
                
                logToCombat(`<span style="color: var(--color-combat);">Turno ${turn}: O ${currentMonster.name} revida, causando ${monsterDamage} de dano.</span>`);

                updateDisplay();
                
                turn++;
            }, 1000); 
        }

        // Log de Combate
        function logToCombat(message) {
            const p = document.createElement('p');
            p.innerHTML = message;
            combatLog.prepend(p);
        }

        // Resolu√ß√£o da Batalha
        function endBattle(heroWon) {
            isFighting = false;
            startBattleButton.textContent = 'Iniciar Batalha! (Custo: 5 ‚ö°)';
            
            if (heroWon) {
                gold += currentMonster.goldReward;
                currentExp += currentMonster.expReward;
                logToCombat(`<p style="color: var(--color-hp); font-weight: bold;">[VIT√ìRIA!] Voc√™ derrotou o ${currentMonster.name}!</p>`);
                logToCombat(`+${currentMonster.expReward} EXP, +${currentMonster.goldReward} üí∞`);
                levelUp();
            } else {
                const goldLoss = 10;
                gold = Math.max(0, gold - goldLoss);
                heroCurrentHP = heroMaxHP; // Restaura HP do her√≥i ap√≥s derrota
                logToCombat(`<p style="color: var(--color-combat); font-weight: bold;">[DERROTA!] Seu her√≥i foi derrotado e perdeu ${goldLoss} üí∞.</p>`);
                logToCombat(`Her√≥i se recupera. HP restaurado para ${heroMaxHP}.`);
            }

            // Garante que o her√≥i tenha vida m√°xima para a pr√≥xima luta
            heroCurrentHP = heroMaxHP; 
            
            // Seleciona o pr√≥ximo monstro imediatamente ap√≥s a batalha
            selectMonsterByLevel();
            
            updateDisplay();
            saveGame();
        }
        
        // ====================================================================
        // VII. FUN√á√ïES DE EQUIPAMENTO E INVENT√ÅRIO
        // ====================================================================
        
        /**
         * 1. Renderiza o layout do equipamento com a imagem do her√≥i e slots.
         */
        function renderEquipment() {
            // Garante que a imagem do her√≥i esteja atualizada
            heroImageDisplay.src = heroImage;
            
            // Renderiza cada slot flutuante
            for (const key in EQUIPMENT_SLOTS) {
                const slot = EQUIPMENT_SLOTS[key];
                const item = slot.currentItem;
                const slotElement = document.getElementById(`slot-${key}`);

                if (!slotElement) continue;

                let content = '';
                if (item) {
                    let statText = '';
                    if (item.atk) statText = `+${item.atk} ATK`;
                    else if (item.hpBonus) statText = `+${item.hpBonus} HP`;
                    else if (item.energyBonus) statText = `+${item.energyBonus} EN`;
                    
                    content = `
                        <span class="slot-name">${slot.name.toUpperCase()}</span>
                        <span class="slot-item-name" style="color: var(--color-accent);">${item.name}</span>
                        <span style="font-size: 0.8em; color: var(--color-hp);">${statText}</span>
                    `;
                } else {
                    content = `
                        <span class="slot-name">${slot.name.toUpperCase()}</span>
                        <span class="slot-empty">Vazio</span>
                    `;
                }

                slotElement.innerHTML = content;
                slotElement.onclick = () => handleSlotClick(key);
            }
            
            updateEquipmentStats();
        }

        // Fun√ß√£o chamada ao clicar em um slot flutuante
        function handleSlotClick(slotKey) {
            const equippedItem = EQUIPMENT_SLOTS[slotKey].currentItem;
            if (equippedItem) {
                // Se houver um item, inspeciona ele para mostrar Desequipar
                showPanel('inventory-panel');
                inspectItem(equippedItem);
            } else {
                // Se o slot estiver vazio, pode-se abrir o invent√°rio filtrado (funcionalidade futura)
                alert(`Slot de ${EQUIPMENT_SLOTS[slotKey].name} vazio. Selecione um item no Invent√°rio para equipar.`);
                showPanel('inventory-panel');
            }
        }


        // 2. Calcula e exibe os b√¥nus de equipamento
        function updateEquipmentStats() {
            let bonusHP = 0;
            let bonusATK = 0;
            let bonusEnergy = 0;
            
            for (const key in EQUIPMENT_SLOTS) {
                const item = EQUIPMENT_SLOTS[key].currentItem;
                if (item) {
                    bonusHP += item.hpBonus || 0;
                    bonusATK += item.atk || 0;
                    bonusEnergy += item.energyBonus || 0;
                }
            }
            
            // Stats Base = Valor Base da Classe/Upgrades + B√¥nus por N√≠vel
            // (Para um crescimento exponencial)
            const hpPerLevel = 5;
            const atkPerLevel = 1;

            const heroStatsHP = heroBaseHP + (powerLevel - 1) * hpPerLevel; 
            const heroStatsATK = heroBaseATK + (powerLevel - 1) * atkPerLevel; 

            // Calcula o total (Base + B√¥nus de Equipamento)
            const totalMaxHP = heroStatsHP + bonusHP;
            const totalMaxATK = heroStatsATK + bonusATK;
            const totalMaxEnergy = CLASSES[selectedClass] ? CLASSES[selectedClass].initialEnergy + bonusEnergy : 0; 
            
            // Se selectedClass for null (pode acontecer no primeiro load), evita o erro
            if (!selectedClass) {
                // Reinicializa o display se selectedClass for nulo
                heroMaxHP = 10;
                return;
            }


            // Atualiza o DOM do Painel de Equipamento
            document.getElementById('eq-max-hp').textContent = totalMaxHP;
            document.getElementById('eq-base-hp').textContent = heroStatsHP;
            document.getElementById('eq-bonus-hp').textContent = bonusHP;

            document.getElementById('eq-total-atk').textContent = totalMaxATK;
            document.getElementById('eq-base-atk').textContent = heroStatsATK;
            document.getElementById('eq-bonus-atk').textContent = bonusATK;

            document.getElementById('eq-max-energy').textContent = totalMaxEnergy;
            document.getElementById('eq-base-energy').textContent = CLASSES[selectedClass].initialEnergy;
            document.getElementById('eq-bonus-energy').textContent = bonusEnergy;

            // Define o novo HP/ATK do her√≥i para o resto do jogo
            heroMaxHP = totalMaxHP;
            // Garante que o HP atual n√£o ultrapasse o m√°ximo
            heroCurrentHP = Math.min(heroCurrentHP, heroMaxHP);
            
            // Atualiza o display principal
            heroCurrentHPDisplay.textContent = heroCurrentHP;
            heroMaxHPDisplay.textContent = heroMaxHP;
            heroTotalATKDisplay.textContent = totalMaxATK;
            
            // Multiplicador de Dano (Exemplo: +20% por n√≠vel)
            const levelMultiplier = powerLevel > 0 ? (1 + (powerLevel - 1) * 0.2) : 1; 
            heroLevelMultiplierDisplay.textContent = levelMultiplier.toFixed(1);

            saveGame(); // Salva o novo estado ap√≥s o update
        }

        // 3. Renderiza os itens no invent√°rio
        function renderInventory() {
            inventoryPanel.innerHTML = '';
            
            // Marca quais itens est√£o equipados
            const equippedIds = Object.values(EQUIPMENT_SLOTS)
                                    .map(slot => slot.currentItem ? slot.currentItem.id : null)
                                    .filter(id => id !== null);

            inventory.forEach(item => {
                const card = document.createElement('div');
                // O tipo do item precisa ser um slot v√°lido para ser considerado "equip√°vel"
                const isEquippable = EQUIPMENT_SLOTS[item.type];

                card.className = `item-card ${isEquippable && equippedIds.includes(item.id) ? 'equipped' : ''}`;
                card.onclick = () => inspectItem(item);

                card.innerHTML = `
                    <p style="font-weight: bold;">${item.name}</p>
                    <p style="color: var(--color-energy);">${item.type ? item.type.toUpperCase() : 'CONSUM√çVEL'}</p>
                    ${isEquippable && equippedIds.includes(item.id) ? '<p style="color: var(--color-hp); font-size: 0.9em;">[E] EQUIPADO</p>' : ''}
                `;
                inventoryPanel.appendChild(card);
            });
            
            // Garante que o painel de detalhes esteja oculto se n√£o houver item inspecionado
            if (!inspectedItem) {
                 document.getElementById('item-details-panel').style.display = 'none';
            } else {
                 // Se o item inspecionado foi desequipado, atualiza o bot√£o
                 inspectItem(inspectedItem); 
            }
        }
        
        // 4. Exibe os detalhes de um item
        function inspectItem(item) {
            inspectedItem = item;
            
            // Atualiza os detalhes
            document.getElementById('detail-item-name').textContent = item.name;
            document.getElementById('detail-item-type').textContent = item.type ? item.type.toUpperCase() : 'CONSUM√çVEL';
            document.getElementById('detail-item-rarity').textContent = item.rarity;
            document.getElementById('detail-item-desc').textContent = item.description;
            
            let statsText = '';
            if (item.atk) statsText += `‚öîÔ∏è ATK B√¥nus: +${item.atk}<br>`;
            if (item.hpBonus) statsText += `‚ù§Ô∏è HP B√¥nus: +${item.hpBonus}<br>`;
            if (item.energyBonus) statsText += `‚ö° Energia B√¥nus: +${item.energyBonus}<br>`;
            document.getElementById('detail-item-stats').innerHTML = statsText;
            
            // Determina a a√ß√£o do bot√£o
            const actionButton = document.getElementById('detail-action-button');
            const isEquippable = EQUIPMENT_SLOTS[item.type];
            const isEquipped = isEquippable && EQUIPMENT_SLOTS[item.type].currentItem && EQUIPMENT_SLOTS[item.type].currentItem.id === item.id;
            
            if (isEquipped) {
                actionButton.textContent = "DESEQUIPAR";
                actionButton.onclick = () => unequipItem(item);
                actionButton.disabled = false;
            } else if (isEquippable) {
                actionButton.textContent = "EQUIPAR";
                actionButton.onclick = () => equipItem(item);
                actionButton.disabled = false;
            } else {
                actionButton.textContent = "USAR/VENDER"; 
                actionButton.disabled = true;
                actionButton.onclick = () => alert('Funcionalidade de Usar/Vender ainda n√£o implementada.');
            }

            document.getElementById('item-details-panel').style.display = 'block';
        }
        
        // 5. Equipa o item (Adicionado 'showAlert' para uso em inicializa√ß√£o)
        function equipItem(item, showAlert = true) {
            const slotKey = item.type;
            
            // Verifica se o tipo de item corresponde a um slot v√°lido
            if (!EQUIPMENT_SLOTS[slotKey]) {
                if (showAlert) alert(`N√£o √© poss√≠vel equipar ${item.name}. Tipo de item inv√°lido: ${slotKey}`);
                return;
            }
            
            // O item est√° sendo equipado, ent√£o ele substitui o item atual no slot
            EQUIPMENT_SLOTS[slotKey].currentItem = item;
            
            // Atualiza todos os pain√©is
            renderEquipment();
            renderInventory();
            if (showAlert) inspectItem(item); // Reinspeciona para mostrar "DESEQUIPAR"
            saveGame();
            if (showAlert) alert(`${item.name} equipado no slot de ${EQUIPMENT_SLOTS[slotKey].name}.`);
        }
        
        // 6. Desequipa o item
        function unequipItem(item) {
            const slotKey = item.type;
            
            if (EQUIPMENT_SLOTS[slotKey].currentItem && EQUIPMENT_SLOTS[slotKey].currentItem.id === item.id) {
                 EQUIPMENT_SLOTS[slotKey].currentItem = null;
                 alert(`${item.name} desequipado.`);
            }
            
            // Atualiza todos os pain√©is
            renderEquipment();
            renderInventory();
            // Reinspeciona para atualizar o bot√£o para "EQUIPAR"
            if (inspectedItem) {
                inspectItem(inspectedItem); 
            }
            saveGame();
        }


        // ====================================================================
        // VIII. INICIALIZA√á√ÉO
        // ====================================================================

        // Tenta carregar o jogo salvo ao iniciar a p√°gina. 
        loadGame();
        
    </script>

</body>
</html>
